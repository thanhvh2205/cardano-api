<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="annot"><span class="hs-comment">-- | Fee calculation</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Api.Fees</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Transaction fees</span></span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#evaluateTransactionFee"><span class="hs-identifier">evaluateTransactionFee</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#calculateMinTxFee"><span class="hs-identifier">calculateMinTxFee</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#estimateTransactionKeyWitnessCount"><span class="hs-identifier">estimateTransactionKeyWitnessCount</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Script execution units</span></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#evaluateTransactionExecutionUnits"><span class="hs-identifier">evaluateTransactionExecutionUnits</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#evaluateTransactionExecutionUnitsShelley"><span class="hs-identifier">evaluateTransactionExecutionUnitsShelley</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier">ScriptExecutionError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityError"><span class="hs-identifier">TransactionValidityError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Transaction balance</span></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#evaluateTransactionBalance"><span class="hs-identifier">evaluateTransactionBalance</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Automated transaction building</span></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#estimateBalancedTxBody"><span class="hs-identifier">estimateBalancedTxBody</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#estimateOrCalculateBalancedTxBody"><span class="hs-identifier">estimateOrCalculateBalancedTxBody</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#makeTransactionBodyAutoBalance"><span class="hs-identifier">makeTransactionBodyAutoBalance</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#AutoBalanceError"><span class="hs-identifier">AutoBalanceError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#BalancedTxBody"><span class="hs-identifier">BalancedTxBody</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#FeeEstimationMode"><span class="hs-identifier">FeeEstimationMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#RequiredShelleyKeyWitnesses"><span class="hs-identifier">RequiredShelleyKeyWitnesses</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#RequiredByronKeyWitnesses"><span class="hs-identifier">RequiredByronKeyWitnesses</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#TotalReferenceScriptsSize"><span class="hs-identifier">TotalReferenceScriptsSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationError"><span class="hs-identifier">TxFeeEstimationError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Minimum UTxO calculation</span></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#calculateMinimumUTxO"><span class="hs-identifier">calculateMinimumUTxO</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Internal helpers</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ResolvablePointers"><span class="hs-identifier">ResolvablePointers</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Address.html"><span class="hs-identifier">Cardano.Api.Address</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Certificate.html"><span class="hs-identifier">Cardano.Api.Certificate</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Eon.AlonzoEraOnwards.html"><span class="hs-identifier">Cardano.Api.Eon.AlonzoEraOnwards</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Eon.BabbageEraOnwards.html"><span class="hs-identifier">Cardano.Api.Eon.BabbageEraOnwards</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Eon.ConwayEraOnwards.html"><span class="hs-identifier">Cardano.Api.Eon.ConwayEraOnwards</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Eon.MaryEraOnwards.html"><span class="hs-identifier">Cardano.Api.Eon.MaryEraOnwards</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html"><span class="hs-identifier">Cardano.Api.Eon.ShelleyBasedEra</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyToAlonzoEra.html"><span class="hs-identifier">Cardano.Api.Eon.ShelleyToAlonzoEra</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Eras.Case.html"><span class="hs-identifier">Cardano.Api.Eras.Case</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Eras.Core.html"><span class="hs-identifier">Cardano.Api.Eras.Core</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Error.html"><span class="hs-identifier">Cardano.Api.Error</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Experimental.Eras.html"><span class="hs-identifier">Cardano.Api.Experimental.Eras</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Experimental.Eras.html#obtainShimConstraints"><span class="hs-identifier">obtainShimConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Experimental.Eras.html#sbeToEra"><span class="hs-identifier">sbeToEra</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Api.Experimental.Eras.html"><span class="hs-identifier">Cardano.Api.Experimental.Eras</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Exp</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Experimental.Tx.html"><span class="hs-identifier">Cardano.Api.Experimental.Tx</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Feature.html"><span class="hs-identifier">Cardano.Api.Feature</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Api.Ledger.Lens.html"><span class="hs-identifier">Cardano.Api.Ledger.Lens</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Pretty.html"><span class="hs-identifier">Cardano.Api.Pretty</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.ProtocolParameters.html"><span class="hs-identifier">Cardano.Api.ProtocolParameters</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Query.html"><span class="hs-identifier">Cardano.Api.Query</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Script.html"><span class="hs-identifier">Cardano.Api.Script</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Tx.Body.html"><span class="hs-identifier">Cardano.Api.Tx.Body</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Tx.Sign.html"><span class="hs-identifier">Cardano.Api.Tx.Sign</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Api.Value.html"><span class="hs-identifier">Cardano.Api.Value</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Core.html"><span class="hs-identifier">Cardano.Ledger.Alonzo.Core</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Context.html"><span class="hs-identifier">Cardano.Ledger.Alonzo.Plutus.Context</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html"><span class="hs-identifier">Cardano.Ledger.Alonzo.Scripts</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Alonzo</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-api-1.9.2.1-4844a0255d7b8fb2f0d16eaff712596a0ef2d0d592972f20c030f33c676c47ab/share/doc/html/src/Cardano.Ledger.Api.html"><span class="hs-identifier">Cardano.Ledger.Api</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html"><span class="hs-identifier">Cardano.Ledger.Coin</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-conway-1.16.0.0-1b52c433b0ad649d47773d184a3283a14eb81aa0d4a1b9ccb86693153e8b2daa/share/doc/html/src/Cardano.Ledger.Conway.Governance.html"><span class="hs-identifier">Cardano.Ledger.Conway.Governance</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.html"><span class="hs-identifier">Cardano.Ledger.Core</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Credential.html"><span class="hs-identifier">Cardano.Ledger.Credential</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier">Credential</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html"><span class="hs-identifier">Cardano.Ledger.Crypto</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Keys.html"><span class="hs-identifier">Cardano.Ledger.Keys</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Plutus.Language.html"><span class="hs-identifier">Cardano.Ledger.Plutus.Language</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/ouroboros-consensus-0.20.0.0-34ac19209df95b018b93a9c558ab9784e274c06bd37480b7ee7319d80bbfbf03/share/doc/html/src/Ouroboros.Consensus.HardFork.History.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Consensus</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/plutus-ledger-api-1.31.0.0-db9af58aeade3ac39fff3e4e303e3a49b50eea6e94a3e5bc6a9a3a9a39a4b221/share/doc/html/src/PlutusLedgerApi.V1.html"><span class="hs-identifier">PlutusLedgerApi.V1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html"><span class="hs-identifier">Data.Bifunctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#bimap"><span class="hs-identifier">bimap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier">first</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#second"><span class="hs-identifier">second</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/bytestring-0.12.1.0-inplace/src/Data.ByteString.Short.html"><span class="hs-identifier">Data.ByteString.Short</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/bytestring-0.12.1.0-inplace/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier">ShortByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html#%26"><span class="hs-operator">(&amp;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-data-1.2.3.0-68d8f64dcb52ece78a57583c4cd609aa56eefca9cd16729b8b35fecbedf1c523/share/doc/html/src/Data.OSet.Strict.html"><span class="hs-identifier">Data.OSet.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OSet</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Ratio.html"><span class="hs-identifier">Data.Ratio</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Set.Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/text-2.1.1-inplace/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/text-2.1.1-inplace/src/Data.Text.Internal.html#Text"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/text-2.1.1-inplace/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Exts.html"><span class="hs-identifier">GHC.Exts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#IsList"><span class="hs-identifier">IsList</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Lens.Micro</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(.~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | Type synonym for logs returned by the ledger's @evalTxExUnitsWithLogs@ function.</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- for scripts in transactions.</span><span>
</span><span id="line-107"></span><span class="hs-keyword">type</span><span> </span><span id="EvalTxExecutionUnitsLog"><span class="annot"><a href="Cardano.Api.Fees.html#EvalTxExecutionUnitsLog"><span class="hs-identifier hs-var">EvalTxExecutionUnitsLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/text-2.1.1-inplace/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-keyword">data</span><span> </span><span id="AutoBalanceError"><span class="annot"><a href="Cardano.Api.Fees.html#AutoBalanceError"><span class="hs-identifier hs-var">AutoBalanceError</span></a></span></span><span> </span><span id="local-6989586621681700757"><span class="annot"><a href="#local-6989586621681700757"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="AutoBalanceEstimationError"><span class="annot"><a href="Cardano.Api.Fees.html#AutoBalanceEstimationError"><span class="hs-identifier hs-var">AutoBalanceEstimationError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationError"><span class="hs-identifier hs-type">TxFeeEstimationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700757"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AutoBalanceCalculationError"><span class="annot"><a href="Cardano.Api.Fees.html#AutoBalanceCalculationError"><span class="hs-identifier hs-var">AutoBalanceCalculationError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700757"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621681701406"><span id="local-6989586621681701414"><span id="local-6989586621681701418"><span class="annot"><span class="annottext">Int -&gt; AutoBalanceError era -&gt; ShowS
[AutoBalanceError era] -&gt; ShowS
AutoBalanceError era -&gt; String
(Int -&gt; AutoBalanceError era -&gt; ShowS)
-&gt; (AutoBalanceError era -&gt; String)
-&gt; ([AutoBalanceError era] -&gt; ShowS)
-&gt; Show (AutoBalanceError era)
forall era. Int -&gt; AutoBalanceError era -&gt; ShowS
forall era. [AutoBalanceError era] -&gt; ShowS
forall era. AutoBalanceError era -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall era. Int -&gt; AutoBalanceError era -&gt; ShowS
showsPrec :: Int -&gt; AutoBalanceError era -&gt; ShowS
$cshow :: forall era. AutoBalanceError era -&gt; String
show :: AutoBalanceError era -&gt; String
$cshowList :: forall era. [AutoBalanceError era] -&gt; ShowS
showList :: [AutoBalanceError era] -&gt; ShowS
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681700733"><span class="annot"><a href="Cardano.Api.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#AutoBalanceError"><span class="hs-identifier hs-type">AutoBalanceError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700733"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>  </span><span id="local-6989586621681701428"><span class="annot"><span class="annottext">prettyError :: forall ann. AutoBalanceError era -&gt; Doc ann
</span><a href="#local-6989586621681701428"><span class="hs-identifier hs-var hs-var hs-var hs-var">prettyError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#AutoBalanceEstimationError"><span class="hs-identifier hs-type">AutoBalanceEstimationError</span></a></span><span> </span><span id="local-6989586621681701430"><span class="annot"><span class="annottext">TxFeeEstimationError era
</span><a href="#local-6989586621681701430"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxFeeEstimationError era -&gt; Doc ann
forall e ann. Error e =&gt; e -&gt; Doc ann
forall ann. TxFeeEstimationError era -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var">prettyError</span></a></span><span> </span><span class="annot"><span class="annottext">TxFeeEstimationError era
</span><a href="#local-6989586621681701430"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#AutoBalanceCalculationError"><span class="hs-identifier hs-type">AutoBalanceCalculationError</span></a></span><span> </span><span id="local-6989586621681701431"><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681701431"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era -&gt; Doc ann
forall e ann. Error e =&gt; e -&gt; Doc ann
forall ann. TxBodyErrorAutoBalance era -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var">prettyError</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681701431"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span id="local-6989586621681700737"><span class="annot"><a href="Cardano.Api.Fees.html#estimateOrCalculateBalancedTxBody"><span class="hs-identifier hs-type">estimateOrCalculateBalancedTxBody</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700737"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#FeeEstimationMode"><span class="hs-identifier hs-type">FeeEstimationMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700737"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">L.PParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700737"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700737"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Certificate.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#StakeCredential"><span class="hs-identifier hs-type">StakeCredential</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Ledger.Credential</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Keys.Internal.html#DRepRole"><span class="hs-identifier hs-type">Ledger.DRepRole</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">Ledger.StandardCrypto</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#AddressInEra"><span class="hs-identifier hs-type">AddressInEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700737"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#AutoBalanceError"><span class="hs-identifier hs-type">AutoBalanceError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700737"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#BalancedTxBody"><span class="hs-identifier hs-type">BalancedTxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700737"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-129"></span><span id="estimateOrCalculateBalancedTxBody"><span class="annot"><span class="annottext">estimateOrCalculateBalancedTxBody :: forall era.
ShelleyBasedEra era
-&gt; FeeEstimationMode era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; TxBodyContent BuildTx era
-&gt; Set (Hash StakePoolKey)
-&gt; Map StakeCredential Coin
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; AddressInEra era
-&gt; Either (AutoBalanceError era) (BalancedTxBody era)
</span><a href="Cardano.Api.Fees.html#estimateOrCalculateBalancedTxBody"><span class="hs-identifier hs-var hs-var">estimateOrCalculateBalancedTxBody</span></a></span></span><span> </span><span id="local-6989586621681701438"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701438"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621681701439"><span class="annot"><span class="annottext">FeeEstimationMode era
</span><a href="#local-6989586621681701439"><span class="hs-identifier hs-var">feeEstMode</span></a></span></span><span> </span><span id="local-6989586621681701440"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701440"><span class="hs-identifier hs-var">pparams</span></a></span></span><span> </span><span id="local-6989586621681701441"><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701441"><span class="hs-identifier hs-var">txBodyContent</span></a></span></span><span> </span><span id="local-6989586621681701442"><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681701442"><span class="hs-identifier hs-var">poolids</span></a></span></span><span> </span><span id="local-6989586621681701443"><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681701443"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span></span><span> </span><span id="local-6989586621681701444"><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681701444"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span></span><span> </span><span id="local-6989586621681701445"><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681701445"><span class="hs-identifier hs-var">changeAddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FeeEstimationMode era
</span><a href="#local-6989586621681701439"><span class="hs-identifier hs-var">feeEstMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#CalculateWithSpendableUTxO"><span class="hs-identifier hs-type">CalculateWithSpendableUTxO</span></a></span><span> </span><span id="local-6989586621681701447"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681701447"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621681701448"><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621681701448"><span class="hs-identifier hs-var">systemstart</span></a></span></span><span> </span><span id="local-6989586621681701449"><span class="annot"><span class="annottext">LedgerEpochInfo
</span><a href="#local-6989586621681701449"><span class="hs-identifier hs-var">ledgerEpochInfo</span></a></span></span><span> </span><span id="local-6989586621681701450"><span class="annot"><span class="annottext">Maybe Word
</span><a href="#local-6989586621681701450"><span class="hs-identifier hs-var">mOverride</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>      </span><span class="annot"><span class="annottext">(TxBodyErrorAutoBalance era -&gt; AutoBalanceError era)
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
-&gt; Either (AutoBalanceError era) (BalancedTxBody era)
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era -&gt; AutoBalanceError era
forall era. TxBodyErrorAutoBalance era -&gt; AutoBalanceError era
</span><a href="Cardano.Api.Fees.html#AutoBalanceCalculationError"><span class="hs-identifier hs-var">AutoBalanceCalculationError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
 -&gt; Either (AutoBalanceError era) (BalancedTxBody era))
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
-&gt; Either (AutoBalanceError era) (BalancedTxBody era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; SystemStart
-&gt; LedgerEpochInfo
-&gt; LedgerProtocolParameters era
-&gt; Set (Hash StakePoolKey)
-&gt; Map StakeCredential Coin
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; UTxO era
-&gt; TxBodyContent BuildTx era
-&gt; AddressInEra era
-&gt; Maybe Word
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
forall era.
ShelleyBasedEra era
-&gt; SystemStart
-&gt; LedgerEpochInfo
-&gt; LedgerProtocolParameters era
-&gt; Set (Hash StakePoolKey)
-&gt; Map StakeCredential Coin
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; UTxO era
-&gt; TxBodyContent BuildTx era
-&gt; AddressInEra era
-&gt; Maybe Word
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
</span><a href="Cardano.Api.Fees.html#makeTransactionBodyAutoBalance"><span class="hs-identifier hs-var">makeTransactionBodyAutoBalance</span></a></span><span>
</span><span id="line-134"></span><span>          </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701438"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-135"></span><span>          </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621681701448"><span class="hs-identifier hs-var">systemstart</span></a></span><span>
</span><span id="line-136"></span><span>          </span><span class="annot"><span class="annottext">LedgerEpochInfo
</span><a href="#local-6989586621681701449"><span class="hs-identifier hs-var">ledgerEpochInfo</span></a></span><span>
</span><span id="line-137"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era) -&gt; LedgerProtocolParameters era
forall era.
PParams (ShelleyLedgerEra era) -&gt; LedgerProtocolParameters era
</span><a href="Cardano.Api.ProtocolParameters.html#LedgerProtocolParameters"><span class="hs-identifier hs-var">LedgerProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701440"><span class="hs-identifier hs-var">pparams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>          </span><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681701442"><span class="hs-identifier hs-var">poolids</span></a></span><span>
</span><span id="line-139"></span><span>          </span><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681701443"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span><span>
</span><span id="line-140"></span><span>          </span><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681701444"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span><span>
</span><span id="line-141"></span><span>          </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681701447"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-142"></span><span>          </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701441"><span class="hs-identifier hs-var">txBodyContent</span></a></span><span>
</span><span id="line-143"></span><span>          </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681701445"><span class="hs-identifier hs-var">changeAddr</span></a></span><span>
</span><span id="line-144"></span><span>          </span><span class="annot"><span class="annottext">Maybe Word
</span><a href="#local-6989586621681701450"><span class="hs-identifier hs-var">mOverride</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#EstimateWithoutSpendableUTxO"><span class="hs-identifier hs-type">EstimateWithoutSpendableUTxO</span></a></span><span>
</span><span id="line-146"></span><span>      </span><span id="local-6989586621681701453"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681701453"><span class="hs-identifier hs-var">totalPotentialCollateral</span></a></span></span><span>
</span><span id="line-147"></span><span>      </span><span id="local-6989586621681701454"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681701454"><span class="hs-identifier hs-var">totalUTxOValue</span></a></span></span><span>
</span><span id="line-148"></span><span>      </span><span id="local-6989586621681701455"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681701455"><span class="hs-identifier hs-var">exUnitsMap</span></a></span></span><span>
</span><span id="line-149"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#RequiredShelleyKeyWitnesses"><span class="hs-identifier hs-type">RequiredShelleyKeyWitnesses</span></a></span><span> </span><span id="local-6989586621681701457"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701457"><span class="hs-identifier hs-var">numKeyWits</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#RequiredByronKeyWitnesses"><span class="hs-identifier hs-type">RequiredByronKeyWitnesses</span></a></span><span> </span><span id="local-6989586621681701459"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701459"><span class="hs-identifier hs-var">numByronWits</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TotalReferenceScriptsSize"><span class="hs-identifier hs-type">TotalReferenceScriptsSize</span></a></span><span> </span><span id="local-6989586621681701461"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701461"><span class="hs-identifier hs-var">totalRefScriptsSize</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; Either (AutoBalanceError era) (BalancedTxBody era)
-&gt; (MaryEraOnwards era
    -&gt; Either (AutoBalanceError era) (BalancedTxBody era))
-&gt; Either (AutoBalanceError era) (BalancedTxBody era)
forall (eon :: * -&gt; *) era a.
Eon eon =&gt;
ShelleyBasedEra era -&gt; a -&gt; (eon era -&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#forShelleyBasedEraInEon"><span class="hs-identifier hs-var">forShelleyBasedEraInEon</span></a></span><span>
</span><span id="line-153"></span><span>          </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701438"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-154"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutoBalanceError era
-&gt; Either (AutoBalanceError era) (BalancedTxBody era)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(AutoBalanceError era
 -&gt; Either (AutoBalanceError era) (BalancedTxBody era))
-&gt; AutoBalanceError era
-&gt; Either (AutoBalanceError era) (BalancedTxBody era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxFeeEstimationError era -&gt; AutoBalanceError era
forall era. TxFeeEstimationError era -&gt; AutoBalanceError era
</span><a href="Cardano.Api.Fees.html#AutoBalanceEstimationError"><span class="hs-identifier hs-var">AutoBalanceEstimationError</span></a></span><span> </span><span class="annot"><span class="annottext">TxFeeEstimationError era
forall era. TxFeeEstimationError era
</span><a href="Cardano.Api.Fees.html#TxFeeEstimationOnlyMaryOnwardsSupportedError"><span class="hs-identifier hs-var">TxFeeEstimationOnlyMaryOnwardsSupportedError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681701464"><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701464"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-156"></span><span>              </span><span class="annot"><span class="annottext">(TxFeeEstimationError era -&gt; AutoBalanceError era)
-&gt; Either (TxFeeEstimationError era) (BalancedTxBody era)
-&gt; Either (AutoBalanceError era) (BalancedTxBody era)
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxFeeEstimationError era -&gt; AutoBalanceError era
forall era. TxFeeEstimationError era -&gt; AutoBalanceError era
</span><a href="Cardano.Api.Fees.html#AutoBalanceEstimationError"><span class="hs-identifier hs-var">AutoBalanceEstimationError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (TxFeeEstimationError era) (BalancedTxBody era)
 -&gt; Either (AutoBalanceError era) (BalancedTxBody era))
-&gt; Either (TxFeeEstimationError era) (BalancedTxBody era)
-&gt; Either (AutoBalanceError era) (BalancedTxBody era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-157"></span><span>                </span><span class="annot"><span class="annottext">MaryEraOnwards era
-&gt; TxBodyContent BuildTx era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Set (Hash StakePoolKey)
-&gt; Map StakeCredential Coin
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; Map ScriptWitnessIndex ExecutionUnits
-&gt; Coin
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; AddressInEra era
-&gt; Value
-&gt; Either (TxFeeEstimationError era) (BalancedTxBody era)
forall era.
MaryEraOnwards era
-&gt; TxBodyContent BuildTx era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Set (Hash StakePoolKey)
-&gt; Map StakeCredential Coin
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; Map ScriptWitnessIndex ExecutionUnits
-&gt; Coin
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; AddressInEra era
-&gt; Value
-&gt; Either (TxFeeEstimationError era) (BalancedTxBody era)
</span><a href="Cardano.Api.Fees.html#estimateBalancedTxBody"><span class="hs-identifier hs-var">estimateBalancedTxBody</span></a></span><span>
</span><span id="line-158"></span><span>                  </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701464"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-159"></span><span>                  </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701441"><span class="hs-identifier hs-var">txBodyContent</span></a></span><span>
</span><span id="line-160"></span><span>                  </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701440"><span class="hs-identifier hs-var">pparams</span></a></span><span>
</span><span id="line-161"></span><span>                  </span><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681701442"><span class="hs-identifier hs-var">poolids</span></a></span><span>
</span><span id="line-162"></span><span>                  </span><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681701443"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span><span>
</span><span id="line-163"></span><span>                  </span><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681701444"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span><span>
</span><span id="line-164"></span><span>                  </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681701455"><span class="hs-identifier hs-var">exUnitsMap</span></a></span><span>
</span><span id="line-165"></span><span>                  </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681701453"><span class="hs-identifier hs-var">totalPotentialCollateral</span></a></span><span>
</span><span id="line-166"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701457"><span class="hs-identifier hs-var">numKeyWits</span></a></span><span>
</span><span id="line-167"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701459"><span class="hs-identifier hs-var">numByronWits</span></a></span><span>
</span><span id="line-168"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701461"><span class="hs-identifier hs-var">totalRefScriptsSize</span></a></span><span>
</span><span id="line-169"></span><span>                  </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681701445"><span class="hs-identifier hs-var">changeAddr</span></a></span><span>
</span><span id="line-170"></span><span>                  </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681701454"><span class="hs-identifier hs-var">totalUTxOValue</span></a></span><span>
</span><span id="line-171"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-keyword">data</span><span> </span><span id="TxFeeEstimationError"><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationError"><span class="hs-identifier hs-var">TxFeeEstimationError</span></a></span></span><span> </span><span id="local-6989586621681700776"><span class="annot"><a href="#local-6989586621681700776"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TxFeeEstimationTransactionTranslationError"><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationTransactionTranslationError"><span class="hs-identifier hs-var">TxFeeEstimationTransactionTranslationError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityError"><span class="hs-identifier hs-type">TransactionValidityError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700776"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TxFeeEstimationScriptExecutionError"><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationScriptExecutionError"><span class="hs-identifier hs-var">TxFeeEstimationScriptExecutionError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700776"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TxFeeEstimationBalanceError"><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationBalanceError"><span class="hs-identifier hs-var">TxFeeEstimationBalanceError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700776"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TxFeeEstimationxBodyError"><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationxBodyError"><span class="hs-identifier hs-var">TxFeeEstimationxBodyError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyError"><span class="hs-identifier hs-type">TxBodyError</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TxFeeEstimationFinalConstructionError"><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationFinalConstructionError"><span class="hs-identifier hs-var">TxFeeEstimationFinalConstructionError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyError"><span class="hs-identifier hs-type">TxBodyError</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TxFeeEstimationOnlyMaryOnwardsSupportedError"><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationOnlyMaryOnwardsSupportedError"><span class="hs-identifier hs-var">TxFeeEstimationOnlyMaryOnwardsSupportedError</span></a></span></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621681701471"><span id="local-6989586621681701485"><span id="local-6989586621681701488"><span class="annot"><span class="annottext">Int -&gt; TxFeeEstimationError era -&gt; ShowS
[TxFeeEstimationError era] -&gt; ShowS
TxFeeEstimationError era -&gt; String
(Int -&gt; TxFeeEstimationError era -&gt; ShowS)
-&gt; (TxFeeEstimationError era -&gt; String)
-&gt; ([TxFeeEstimationError era] -&gt; ShowS)
-&gt; Show (TxFeeEstimationError era)
forall era. Int -&gt; TxFeeEstimationError era -&gt; ShowS
forall era. [TxFeeEstimationError era] -&gt; ShowS
forall era. TxFeeEstimationError era -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall era. Int -&gt; TxFeeEstimationError era -&gt; ShowS
showsPrec :: Int -&gt; TxFeeEstimationError era -&gt; ShowS
$cshow :: forall era. TxFeeEstimationError era -&gt; String
show :: TxFeeEstimationError era -&gt; String
$cshowList :: forall era. [TxFeeEstimationError era] -&gt; ShowS
showList :: [TxFeeEstimationError era] -&gt; ShowS
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681700735"><span class="annot"><a href="Cardano.Api.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationError"><span class="hs-identifier hs-type">TxFeeEstimationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700735"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621681701500"><span class="annot"><span class="annottext">prettyError :: forall ann. TxFeeEstimationError era -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var hs-var hs-var hs-var">prettyError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationTransactionTranslationError"><span class="hs-identifier hs-type">TxFeeEstimationTransactionTranslationError</span></a></span><span> </span><span id="local-6989586621681701501"><span class="annot"><span class="annottext">TransactionValidityError era
</span><a href="#local-6989586621681701501"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TransactionValidityError era -&gt; Doc ann
forall e ann. Error e =&gt; e -&gt; Doc ann
forall ann. TransactionValidityError era -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var">prettyError</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionValidityError era
</span><a href="#local-6989586621681701501"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationScriptExecutionError"><span class="hs-identifier hs-type">TxFeeEstimationScriptExecutionError</span></a></span><span> </span><span id="local-6989586621681701502"><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681701502"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era -&gt; Doc ann
forall e ann. Error e =&gt; e -&gt; Doc ann
forall ann. TxBodyErrorAutoBalance era -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var">prettyError</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681701502"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationBalanceError"><span class="hs-identifier hs-type">TxFeeEstimationBalanceError</span></a></span><span> </span><span id="local-6989586621681701503"><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681701503"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era -&gt; Doc ann
forall e ann. Error e =&gt; e -&gt; Doc ann
forall ann. TxBodyErrorAutoBalance era -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var">prettyError</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681701503"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationxBodyError"><span class="hs-identifier hs-type">TxFeeEstimationxBodyError</span></a></span><span> </span><span id="local-6989586621681701504"><span class="annot"><span class="annottext">TxBodyError
</span><a href="#local-6989586621681701504"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; Doc ann
forall e ann. Error e =&gt; e -&gt; Doc ann
forall ann. TxBodyError -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var">prettyError</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError
</span><a href="#local-6989586621681701504"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationFinalConstructionError"><span class="hs-identifier hs-type">TxFeeEstimationFinalConstructionError</span></a></span><span> </span><span id="local-6989586621681701505"><span class="annot"><span class="annottext">TxBodyError
</span><a href="#local-6989586621681701505"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; Doc ann
forall e ann. Error e =&gt; e -&gt; Doc ann
forall ann. TxBodyError -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var">prettyError</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError
</span><a href="#local-6989586621681701505"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">TxFeeEstimationError era
</span><a href="Cardano.Api.Fees.html#TxFeeEstimationOnlyMaryOnwardsSupportedError"><span class="hs-identifier hs-var">TxFeeEstimationOnlyMaryOnwardsSupportedError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-190"></span><span>      </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Only mary era onwards supported.&quot;</span></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="annot"><span class="hs-comment">-- | Use when you do not have access to the UTxOs you intend to spend</span></span><span>
</span><span id="line-193"></span><span class="annot"><a href="Cardano.Api.Fees.html#estimateBalancedTxBody"><span class="hs-identifier hs-type">estimateBalancedTxBody</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681700777"><span class="annot"><a href="#local-6989586621681700777"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-195"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.MaryEraOnwards.html#MaryEraOnwards"><span class="hs-identifier hs-type">MaryEraOnwards</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700777"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700777"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">L.PParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700777"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Certificate.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-comment">-- ^ The set of registered stake pools, that are being</span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-comment">--   unregistered in this transaction.</span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#StakeCredential"><span class="hs-identifier hs-type">StakeCredential</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-comment">-- ^ Map of all deposits for stake credentials that are being</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-comment">--   unregistered in this transaction</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Ledger.Credential</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Keys.Internal.html#DRepRole"><span class="hs-identifier hs-type">Ledger.DRepRole</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">Ledger.StandardCrypto</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-comment">-- ^ Map of all deposits for drep credentials that are being</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-comment">--   unregistered in this transaction</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ExecutionUnits"><span class="hs-identifier hs-type">ExecutionUnits</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Plutus script execution units</span></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Total potential collateral amount</span></span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The number of key witnesses still to be added to the transaction.</span></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The number of Byron key witnesses still to be added to the transaction.</span></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Size of all reference scripts in bytes</span></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#AddressInEra"><span class="hs-identifier hs-type">AddressInEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700777"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Change address</span></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Total value of UTxOs being spent</span></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxFeeEstimationError"><span class="hs-identifier hs-type">TxFeeEstimationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700777"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#BalancedTxBody"><span class="hs-identifier hs-type">BalancedTxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700777"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span id="estimateBalancedTxBody"><span class="annot"><span class="annottext">estimateBalancedTxBody :: forall era.
MaryEraOnwards era
-&gt; TxBodyContent BuildTx era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Set (Hash StakePoolKey)
-&gt; Map StakeCredential Coin
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; Map ScriptWitnessIndex ExecutionUnits
-&gt; Coin
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; AddressInEra era
-&gt; Value
-&gt; Either (TxFeeEstimationError era) (BalancedTxBody era)
</span><a href="Cardano.Api.Fees.html#estimateBalancedTxBody"><span class="hs-identifier hs-var hs-var">estimateBalancedTxBody</span></a></span></span><span>
</span><span id="line-223"></span><span>  </span><span id="local-6989586621681701535"><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701535"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621681701536"><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701536"><span class="hs-identifier hs-var">txbodycontent</span></a></span></span><span>
</span><span id="line-225"></span><span>  </span><span id="local-6989586621681701537"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701537"><span class="hs-identifier hs-var">pparams</span></a></span></span><span>
</span><span id="line-226"></span><span>  </span><span id="local-6989586621681701538"><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681701538"><span class="hs-identifier hs-var">poolids</span></a></span></span><span>
</span><span id="line-227"></span><span>  </span><span id="local-6989586621681701539"><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681701539"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span></span><span>
</span><span id="line-228"></span><span>  </span><span id="local-6989586621681701540"><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681701540"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span></span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621681701541"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681701541"><span class="hs-identifier hs-var">exUnitsMap</span></a></span></span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621681701542"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681701542"><span class="hs-identifier hs-var">totalPotentialCollateral</span></a></span></span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621681701543"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701543"><span class="hs-identifier hs-var">intendedKeyWits</span></a></span></span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621681701544"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701544"><span class="hs-identifier hs-var">byronwits</span></a></span></span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621681701545"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701545"><span class="hs-identifier hs-var">sizeOfAllReferenceScripts</span></a></span></span><span>
</span><span id="line-234"></span><span>  </span><span id="local-6989586621681701546"><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681701546"><span class="hs-identifier hs-var">changeaddr</span></a></span></span><span>
</span><span id="line-235"></span><span>  </span><span id="local-6989586621681701547"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681701547"><span class="hs-identifier hs-var">totalUTxOValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- Step 1. Substitute those execution units into the tx</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681701548"><span class="annot"><span class="annottext">sbe :: ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var hs-var">sbe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era -&gt; ShelleyBasedEra era
forall era. MaryEraOnwards era -&gt; ShelleyBasedEra era
</span><a href="Cardano.Api.Eon.MaryEraOnwards.html#maryEraOnwardsToShelleyBasedEra"><span class="hs-identifier hs-var">maryEraOnwardsToShelleyBasedEra</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701535"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621681701550"><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701550"><span class="hs-identifier hs-var">txbodycontent1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-240"></span><span>      </span><span class="annot"><span class="annottext">MaryEraOnwards era
-&gt; (MaryEraOnwardsConstraints era =&gt;
    Either (TxFeeEstimationError era) (TxBodyContent BuildTx era))
-&gt; Either (TxFeeEstimationError era) (TxBodyContent BuildTx era)
forall era a.
MaryEraOnwards era -&gt; (MaryEraOnwardsConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.MaryEraOnwards.html#maryEraOnwardsConstraints"><span class="hs-identifier hs-var">maryEraOnwardsConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701535"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((MaryEraOnwardsConstraints era =&gt;
  Either (TxFeeEstimationError era) (TxBodyContent BuildTx era))
 -&gt; Either (TxFeeEstimationError era) (TxBodyContent BuildTx era))
-&gt; (MaryEraOnwardsConstraints era =&gt;
    Either (TxFeeEstimationError era) (TxBodyContent BuildTx era))
-&gt; Either (TxFeeEstimationError era) (TxBodyContent BuildTx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><span class="annottext">(TxBodyErrorAutoBalance era -&gt; TxFeeEstimationError era)
-&gt; Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era)
-&gt; Either (TxFeeEstimationError era) (TxBodyContent BuildTx era)
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era -&gt; TxFeeEstimationError era
forall era. TxBodyErrorAutoBalance era -&gt; TxFeeEstimationError era
</span><a href="Cardano.Api.Fees.html#TxFeeEstimationScriptExecutionError"><span class="hs-identifier hs-var">TxFeeEstimationScriptExecutionError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era)
 -&gt; Either (TxFeeEstimationError era) (TxBodyContent BuildTx era))
-&gt; Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era)
-&gt; Either (TxFeeEstimationError era) (TxBodyContent BuildTx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-242"></span><span>          </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
-&gt; TxBodyContent BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era)
forall era.
Map ScriptWitnessIndex ExecutionUnits
-&gt; TxBodyContent BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era)
</span><a href="Cardano.Api.Fees.html#substituteExecutionUnits"><span class="hs-identifier hs-var">substituteExecutionUnits</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681701541"><span class="hs-identifier hs-var">exUnitsMap</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701536"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-comment">-- Step 2. We need to calculate the current balance of the tx. The user</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-comment">-- must at least provide the total value of the UTxOs they intend to spend</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-comment">-- for us to calulate the balance. NB: We must:</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-comment">--  1. Subtract certificate and proposal deposits</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-comment">-- from the total available Ada value!</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-comment">-- Page 24 Shelley ledger spec</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681701555"><span class="annot"><span class="annottext">certificates :: [TxCert (ShelleyLedgerEra era)]
</span><a href="#local-6989586621681701555"><span class="hs-identifier hs-var hs-var">certificates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; TxCertificates BuildTx era
forall build era.
TxBodyContent build era -&gt; TxCertificates build era
</span><a href="Cardano.Api.Tx.Body.html#txCertificates"><span class="hs-identifier hs-var">txCertificates</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701550"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-252"></span><span>            </span><span class="annot"><span class="annottext">TxCertificates BuildTx era
</span><a href="Cardano.Api.Tx.Body.html#TxCertificatesNone"><span class="hs-identifier hs-var">TxCertificatesNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-253"></span><span>            </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxCertificates"><span class="hs-identifier hs-type">TxCertificates</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681701559"><span class="annot"><span class="annottext">[Certificate era]
</span><a href="#local-6989586621681701559"><span class="hs-identifier hs-var">certs</span></a></span></span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx [(StakeCredential, Witness WitCtxStake era)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Certificate era -&gt; TxCert (ShelleyLedgerEra era))
-&gt; [Certificate era] -&gt; [TxCert (ShelleyLedgerEra era)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate era -&gt; TxCert (ShelleyLedgerEra era)
forall era. Certificate era -&gt; TxCert (ShelleyLedgerEra era)
</span><a href="Cardano.Api.Certificate.html#toShelleyCertificate"><span class="hs-identifier hs-var">toShelleyCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">[Certificate era]
</span><a href="#local-6989586621681701559"><span class="hs-identifier hs-var">certs</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><a href="#local-6989586621681701561"><span class="hs-identifier hs-type">proposalProcedures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-data-1.2.3.0-68d8f64dcb52ece78a57583c4cd609aa56eefca9cd16729b8b35fecbedf1c523/share/doc/html/src/Data.OSet.Strict.html#OSet"><span class="hs-identifier hs-type">OSet.OSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-conway-1.16.0.0-1b52c433b0ad649d47773d184a3283a14eb81aa0d4a1b9ccb86693153e8b2daa/share/doc/html/src/Cardano.Ledger.Conway.Governance.Procedures.html#ProposalProcedure"><span class="hs-identifier hs-type">L.ProposalProcedure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700777"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>        </span><span id="local-6989586621681701561"><span class="annot"><span class="annottext">proposalProcedures :: OSet (ProposalProcedure (ShelleyLedgerEra era))
</span><a href="#local-6989586621681701561"><span class="hs-identifier hs-var hs-var">proposalProcedures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>          </span><span class="annot"><span class="annottext">MaryEraOnwards era
-&gt; (MaryEraOnwardsConstraints era =&gt;
    OSet (ProposalProcedure (ShelleyLedgerEra era)))
-&gt; OSet (ProposalProcedure (ShelleyLedgerEra era))
forall era a.
MaryEraOnwards era -&gt; (MaryEraOnwardsConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.MaryEraOnwards.html#maryEraOnwardsConstraints"><span class="hs-identifier hs-var">maryEraOnwardsConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701535"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((MaryEraOnwardsConstraints era =&gt;
  OSet (ProposalProcedure (ShelleyLedgerEra era)))
 -&gt; OSet (ProposalProcedure (ShelleyLedgerEra era)))
-&gt; (MaryEraOnwardsConstraints era =&gt;
    OSet (ProposalProcedure (ShelleyLedgerEra era)))
-&gt; OSet (ProposalProcedure (ShelleyLedgerEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-258"></span><span>            </span><span class="annot"><span class="annottext">OSet (ProposalProcedure (ShelleyLedgerEra era))
-&gt; (Featured
      ConwayEraOnwards era (TxProposalProcedures BuildTx era)
    -&gt; OSet (ProposalProcedure (ShelleyLedgerEra era)))
-&gt; Maybe
     (Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era))
-&gt; OSet (ProposalProcedure (ShelleyLedgerEra era))
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">OSet (ProposalProcedure (ShelleyLedgerEra era))
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxProposalProcedures BuildTx era
-&gt; OSet (ProposalProcedure (ShelleyLedgerEra era))
forall build era.
TxProposalProcedures build era
-&gt; OSet (ProposalProcedure (ShelleyLedgerEra era))
</span><a href="Cardano.Api.Tx.Body.html#convProposalProcedures"><span class="hs-identifier hs-var">convProposalProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">(TxProposalProcedures BuildTx era
 -&gt; OSet (ProposalProcedure (ShelleyLedgerEra era)))
-&gt; (Featured
      ConwayEraOnwards era (TxProposalProcedures BuildTx era)
    -&gt; TxProposalProcedures BuildTx era)
-&gt; Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era)
-&gt; OSet (ProposalProcedure (ShelleyLedgerEra era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era)
-&gt; TxProposalProcedures BuildTx era
forall (eon :: * -&gt; *) era a. Featured eon era a -&gt; a
</span><a href="Cardano.Api.Feature.html#unFeatured"><span class="hs-identifier hs-var">unFeatured</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
-&gt; Maybe
     (Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era))
forall build era.
TxBodyContent build era
-&gt; Maybe
     (Featured ConwayEraOnwards era (TxProposalProcedures build era))
</span><a href="Cardano.Api.Tx.Body.html#txProposalProcedures"><span class="hs-identifier hs-var">txProposalProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701550"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><a href="#local-6989586621681701573"><span class="hs-identifier hs-type">totalDeposits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span id="local-6989586621681701573"><span class="annot"><span class="annottext">totalDeposits :: Coin
</span><a href="#local-6989586621681701573"><span class="hs-identifier hs-var hs-var">totalDeposits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-262"></span><span>          </span><span class="hs-comment">-- Because we do not have access to the ledger state and to reduce the complexity of this function's</span><span>
</span><span id="line-263"></span><span>          </span><span class="hs-comment">-- type signature, we assume the user is trying to register a stake pool that has not been</span><span>
</span><span id="line-264"></span><span>          </span><span class="hs-comment">-- registered before and has not included duplicate stake pool registration certificates.</span><span>
</span><span id="line-265"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681701574"><span class="annot"><span class="annottext">assumeStakePoolHasNotBeenRegistered :: b -&gt; Bool
</span><a href="#local-6989586621681701574"><span class="hs-identifier hs-var hs-var">assumeStakePoolHasNotBeenRegistered</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; b -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-266"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Coin] -&gt; Coin
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span>
</span><span id="line-267"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
-&gt; (MaryEraOnwardsConstraints era =&gt; Coin) -&gt; Coin
forall era a.
MaryEraOnwards era -&gt; (MaryEraOnwardsConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.MaryEraOnwards.html#maryEraOnwardsConstraints"><span class="hs-identifier hs-var">maryEraOnwardsConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701535"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((MaryEraOnwardsConstraints era =&gt; Coin) -&gt; Coin)
-&gt; (MaryEraOnwardsConstraints era =&gt; Coin) -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-268"></span><span>                    </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
-&gt; (KeyHash 'StakePool (EraCrypto (ShelleyLedgerEra era)) -&gt; Bool)
-&gt; [TxCert (ShelleyLedgerEra era)]
-&gt; Coin
forall era (f :: * -&gt; *).
(EraTxCert era, Foldable f) =&gt;
PParams era
-&gt; (KeyHash 'StakePool (EraCrypto era) -&gt; Bool)
-&gt; f (TxCert era)
-&gt; Coin
forall (f :: * -&gt; *).
Foldable f =&gt;
PParams (ShelleyLedgerEra era)
-&gt; (KeyHash 'StakePool (EraCrypto (ShelleyLedgerEra era)) -&gt; Bool)
-&gt; f (TxCert (ShelleyLedgerEra era))
-&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.TxCert.html#getTotalDepositsTxCerts"><span class="hs-identifier hs-var">L.getTotalDepositsTxCerts</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701537"><span class="hs-identifier hs-var">pparams</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool (EraCrypto (ShelleyLedgerEra era)) -&gt; Bool
KeyHash 'StakePool StandardCrypto -&gt; Bool
forall {b}. b -&gt; Bool
</span><a href="#local-6989586621681701574"><span class="hs-identifier hs-var">assumeStakePoolHasNotBeenRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">[TxCert (ShelleyLedgerEra era)]
</span><a href="#local-6989586621681701555"><span class="hs-identifier hs-var">certificates</span></a></span><span>
</span><span id="line-269"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
-&gt; (MaryEraOnwardsConstraints era =&gt; Coin) -&gt; Coin
forall era a.
MaryEraOnwards era -&gt; (MaryEraOnwardsConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.MaryEraOnwards.html#maryEraOnwardsConstraints"><span class="hs-identifier hs-var">maryEraOnwardsConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701535"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((MaryEraOnwardsConstraints era =&gt; Coin) -&gt; Coin)
-&gt; (MaryEraOnwardsConstraints era =&gt; Coin) -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-270"></span><span>                    </span><span class="annot"><span class="annottext">[Coin] -&gt; Coin
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Coin] -&gt; Coin) -&gt; [Coin] -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-271"></span><span>                      </span><span class="annot"><span class="annottext">(ProposalProcedure (ShelleyLedgerEra era) -&gt; Coin)
-&gt; [ProposalProcedure (ShelleyLedgerEra era)] -&gt; [Coin]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProposalProcedure (ShelleyLedgerEra era)
-&gt; Getting Coin (ProposalProcedure (ShelleyLedgerEra era)) Coin
-&gt; Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Coin (ProposalProcedure (ShelleyLedgerEra era)) Coin
forall era (f :: * -&gt; *).
Functor f =&gt;
(Coin -&gt; f Coin)
-&gt; ProposalProcedure era -&gt; f (ProposalProcedure era)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-conway-1.16.0.0-1b52c433b0ad649d47773d184a3283a14eb81aa0d4a1b9ccb86693153e8b2daa/share/doc/html/src/Cardano.Ledger.Conway.Governance.Procedures.html#pProcDepositL"><span class="hs-identifier hs-var">L.pProcDepositL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ProposalProcedure (ShelleyLedgerEra era)] -&gt; [Coin])
-&gt; [ProposalProcedure (ShelleyLedgerEra era)] -&gt; [Coin]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-272"></span><span>                        </span><span class="annot"><span class="annottext">OSet (ProposalProcedure (ShelleyLedgerEra era))
-&gt; [Item (OSet (ProposalProcedure (ShelleyLedgerEra era)))]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">OSet (ProposalProcedure (ShelleyLedgerEra era))
</span><a href="#local-6989586621681701561"><span class="hs-identifier hs-var">proposalProcedures</span></a></span><span>
</span><span id="line-273"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>        </span><span id="local-6989586621681701602"><span class="annot"><span class="annottext">availableUTxOValue :: Value
</span><a href="#local-6989586621681701602"><span class="hs-identifier hs-var hs-var">availableUTxOValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-276"></span><span>          </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-277"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681701547"><span class="hs-identifier hs-var">totalUTxOValue</span></a></span><span>
</span><span id="line-278"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="Cardano.Api.Value.html#negateValue"><span class="hs-identifier hs-var">negateValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Value
</span><a href="Cardano.Api.Value.html#lovelaceToValue"><span class="hs-identifier hs-var">lovelaceToValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681701573"><span class="hs-identifier hs-var">totalDeposits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681701605"><span class="annot"><span class="annottext">change :: Value (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701605"><span class="hs-identifier hs-var hs-var">change</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era -&gt; Value -&gt; Value (ShelleyLedgerEra era)
forall era.
MaryEraOnwards era -&gt; Value -&gt; Value (ShelleyLedgerEra era)
</span><a href="Cardano.Api.Value.html#toLedgerValue"><span class="hs-identifier hs-var">toLedgerValue</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701535"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value (ShelleyLedgerEra era))
-&gt; Value -&gt; Value (ShelleyLedgerEra era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; Value -&gt; TxBodyContent BuildTx era -&gt; Value
forall era build.
ShelleyBasedEra era -&gt; Value -&gt; TxBodyContent build era -&gt; Value
</span><a href="Cardano.Api.Fees.html#calculateChangeValue"><span class="hs-identifier hs-var">calculateChangeValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681701602"><span class="hs-identifier hs-var">availableUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701550"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span>
</span><span id="line-282"></span><span>        </span><span id="local-6989586621681701615"><span class="annot"><span class="annottext">maxLovelaceChange :: Coin
</span><a href="#local-6989586621681701615"><span class="hs-identifier hs-var hs-var">maxLovelaceChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">L.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#%5E"><span class="hs-operator hs-var">^</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">64</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-bignum-1.3-inplace/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-number">1</span></span><span>
</span><span id="line-283"></span><span>        </span><span id="local-6989586621681701618"><span class="annot"><span class="annottext">changeWithMaxLovelace :: Value (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701618"><span class="hs-identifier hs-var hs-var">changeWithMaxLovelace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701605"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="annot"><span class="annottext">Value (ShelleyLedgerEra era)
-&gt; (Value (ShelleyLedgerEra era) -&gt; Value (ShelleyLedgerEra era))
-&gt; Value (ShelleyLedgerEra era)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; Lens' (Value (ShelleyLedgerEra era)) Coin
forall era.
ShelleyBasedEra era -&gt; Lens' (Value (ShelleyLedgerEra era)) Coin
</span><a href="Cardano.Api.Ledger.Lens.html#adaAssetL"><span class="hs-identifier hs-var">A.adaAssetL</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin)
 -&gt; Value (ShelleyLedgerEra era)
 -&gt; Identity (Value (ShelleyLedgerEra era)))
-&gt; Coin
-&gt; Value (ShelleyLedgerEra era)
-&gt; Value (ShelleyLedgerEra era)
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681701615"><span class="hs-identifier hs-var">maxLovelaceChange</span></a></span><span>
</span><span id="line-284"></span><span>        </span><span id="local-6989586621681701620"><span class="annot"><span class="annottext">changeTxOut :: TxOutValue era
</span><a href="#local-6989586621681701620"><span class="hs-identifier hs-var hs-var">changeTxOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-285"></span><span>          </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxOutValue era
-&gt; (MaryEraOnwards era -&gt; TxOutValue era)
-&gt; TxOutValue era
forall (eon :: * -&gt; *) era a.
Eon eon =&gt;
ShelleyBasedEra era -&gt; a -&gt; (eon era -&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#forShelleyBasedEraInEon"><span class="hs-identifier hs-var">forShelleyBasedEraInEon</span></a></span><span>
</span><span id="line-286"></span><span>            </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-287"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; Coin -&gt; TxOutValue era
forall era. ShelleyBasedEra era -&gt; Coin -&gt; TxOutValue era
</span><a href="Cardano.Api.Tx.Body.html#lovelaceToTxOutValue"><span class="hs-identifier hs-var">lovelaceToTxOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681701615"><span class="hs-identifier hs-var">maxLovelaceChange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681701622"><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701622"><span class="hs-identifier hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
-&gt; (MaryEraOnwardsConstraints era =&gt; TxOutValue era)
-&gt; TxOutValue era
forall era a.
MaryEraOnwards era -&gt; (MaryEraOnwardsConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.MaryEraOnwards.html#maryEraOnwardsConstraints"><span class="hs-identifier hs-var">maryEraOnwardsConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681701622"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">((MaryEraOnwardsConstraints era =&gt; TxOutValue era)
 -&gt; TxOutValue era)
-&gt; (MaryEraOnwardsConstraints era =&gt; TxOutValue era)
-&gt; TxOutValue era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
forall era.
(Eq (Value (ShelleyLedgerEra era)),
 Show (Value (ShelleyLedgerEra era))) =&gt;
ShelleyBasedEra era
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
</span><a href="Cardano.Api.Tx.Body.html#TxOutValueShelleyBased"><span class="hs-identifier hs-var">TxOutValueShelleyBased</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">Value (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701618"><span class="hs-identifier hs-var">changeWithMaxLovelace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681701638"><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681701638"><span class="hs-identifier hs-var">dummyCollRet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681701639"><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681701639"><span class="hs-identifier hs-var">dummyTotColl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era
-&gt; AddressInEra era
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era
-&gt; AddressInEra era
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
</span><a href="Cardano.Api.Fees.html#maybeDummyTotalCollAndCollReturnOutput"><span class="hs-identifier hs-var">maybeDummyTotalCollAndCollReturnOutput</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701536"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681701546"><span class="hs-identifier hs-var">changeaddr</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-comment">-- Step 3. Create a tx body with out max lovelace fee. This is strictly for</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-comment">-- calculating our fee with evaluateTransactionFee.</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681701646"><span class="annot"><span class="annottext">maxLovelaceFee :: Coin
</span><a href="#local-6989586621681701646"><span class="hs-identifier hs-var hs-var">maxLovelaceFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">L.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#%5E"><span class="hs-operator hs-var">^</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-bignum-1.3-inplace/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621681701647"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701647"><span class="hs-identifier hs-var">txbody1ForFeeEstimateOnly</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-296"></span><span>      </span><span class="annot"><span class="annottext">(TxBodyError -&gt; TxFeeEstimationError era)
-&gt; Either TxBodyError (TxBody era)
-&gt; Either (TxFeeEstimationError era) (TxBody era)
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; TxFeeEstimationError era
forall era. TxBodyError -&gt; TxFeeEstimationError era
</span><a href="Cardano.Api.Fees.html#TxFeeEstimationxBodyError"><span class="hs-identifier hs-var">TxFeeEstimationxBodyError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TxBodyError (TxBody era)
 -&gt; Either (TxFeeEstimationError era) (TxBody era))
-&gt; Either TxBodyError (TxBody era)
-&gt; Either (TxFeeEstimationError era) (TxBody era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- TODO: impossible to fail now</span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
</span><a href="Cardano.Api.Tx.Body.html#createTransactionBody"><span class="hs-identifier hs-var">createTransactionBody</span></a></span><span>
</span><span id="line-298"></span><span>          </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-299"></span><span>          </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701550"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span>
</span><span id="line-300"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txFee"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxFeeExplicit"><span class="hs-identifier hs-type">TxFeeExplicit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701548"><span class="hs-identifier hs-type">sbe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701646"><span class="hs-identifier hs-type">maxLovelaceFee</span></a></span><span>
</span><span id="line-301"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>                </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701546"><span class="hs-identifier hs-type">changeaddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701620"><span class="hs-identifier hs-type">changeTxOut</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-type">TxOutDatumNone</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-type">ReferenceScriptNone</span></a></span><span>
</span><span id="line-303"></span><span>                  </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701536"><span class="hs-identifier hs-type">txbodycontent</span></a></span><span>
</span><span id="line-304"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txReturnCollateral"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681701638"><span class="hs-identifier hs-type">dummyCollRet</span></a></span><span>
</span><span id="line-305"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txTotalCollateral"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681701639"><span class="hs-identifier hs-type">dummyTotColl</span></a></span><span>
</span><span id="line-306"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681701657"><span class="annot"><span class="annottext">fee :: Coin
</span><a href="#local-6989586621681701657"><span class="hs-identifier hs-var hs-var">fee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>          </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; TxBody era
-&gt; Word
-&gt; Word
-&gt; Int
-&gt; Coin
forall era.
ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; TxBody era
-&gt; Word
-&gt; Word
-&gt; Int
-&gt; Coin
</span><a href="Cardano.Api.Fees.html#evaluateTransactionFee"><span class="hs-identifier hs-var">evaluateTransactionFee</span></a></span><span>
</span><span id="line-309"></span><span>            </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-310"></span><span>            </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701537"><span class="hs-identifier hs-var">pparams</span></a></span><span>
</span><span id="line-311"></span><span>            </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701647"><span class="hs-identifier hs-var">txbody1ForFeeEstimateOnly</span></a></span><span>
</span><span id="line-312"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701543"><span class="hs-identifier hs-var">intendedKeyWits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701544"><span class="hs-identifier hs-var">byronwits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>            </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701545"><span class="hs-identifier hs-var">sizeOfAllReferenceScripts</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-comment">-- Step 4. We use the fee to calculate the required collateral</span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681701658"><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681701658"><span class="hs-identifier hs-var">retColl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681701659"><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681701659"><span class="hs-identifier hs-var">reqCol</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>          </span><span class="annot"><span class="annottext">(ShelleyToAlonzoEraConstraints era =&gt;
 ShelleyToAlonzoEra era
 -&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era))
-&gt; (BabbageEraOnwardsConstraints era =&gt;
    BabbageEraOnwards era
    -&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era))
-&gt; ShelleyBasedEra era
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
forall era a.
(ShelleyToAlonzoEraConstraints era =&gt; ShelleyToAlonzoEra era -&gt; a)
-&gt; (BabbageEraOnwardsConstraints era =&gt; BabbageEraOnwards era -&gt; a)
-&gt; ShelleyBasedEra era
-&gt; a
</span><a href="Cardano.Api.Eras.Case.html#caseShelleyToAlonzoOrBabbageEraOnwards"><span class="hs-identifier hs-var">caseShelleyToAlonzoOrBabbageEraOnwards</span></a></span><span>
</span><span id="line-319"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxReturnCollateral CtxTx era, TxTotalCollateral era)
-&gt; ShelleyToAlonzoEra era
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
forall ctx era. TxReturnCollateral ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
forall era. TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681701669"><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681701669"><span class="hs-identifier hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-321"></span><span>                </span><span class="annot"><span class="annottext">BabbageEraOnwards era
-&gt; Coin
-&gt; PParams (ShelleyLedgerEra era)
-&gt; TxInsCollateral era
-&gt; TxReturnCollateral CtxTx era
-&gt; TxTotalCollateral era
-&gt; AddressInEra era
-&gt; Coin
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
forall era.
AlonzoEraPParams (ShelleyLedgerEra era) =&gt;
BabbageEraOnwards era
-&gt; Coin
-&gt; PParams (ShelleyLedgerEra era)
-&gt; TxInsCollateral era
-&gt; TxReturnCollateral CtxTx era
-&gt; TxTotalCollateral era
-&gt; AddressInEra era
-&gt; Coin
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
</span><a href="Cardano.Api.Fees.html#calcReturnAndTotalCollateral"><span class="hs-identifier hs-var">calcReturnAndTotalCollateral</span></a></span><span>
</span><span id="line-322"></span><span>                  </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681701669"><span class="hs-identifier hs-var">w'</span></a></span><span>
</span><span id="line-323"></span><span>                  </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681701657"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-324"></span><span>                  </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701537"><span class="hs-identifier hs-var">pparams</span></a></span><span>
</span><span id="line-325"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; TxInsCollateral era
forall build era. TxBodyContent build era -&gt; TxInsCollateral era
</span><a href="Cardano.Api.Tx.Body.html#txInsCollateral"><span class="hs-identifier hs-var">txInsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701536"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; TxReturnCollateral CtxTx era
forall build era.
TxBodyContent build era -&gt; TxReturnCollateral CtxTx era
</span><a href="Cardano.Api.Tx.Body.html#txReturnCollateral"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701536"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; TxTotalCollateral era
forall build era. TxBodyContent build era -&gt; TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#txTotalCollateral"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701536"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>                  </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681701546"><span class="hs-identifier hs-var">changeaddr</span></a></span><span>
</span><span id="line-329"></span><span>                  </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681701542"><span class="hs-identifier hs-var">totalPotentialCollateral</span></a></span><span>
</span><span id="line-330"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>            </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-comment">-- Step 5. Now we can calculate the balance of the tx. What matter here are:</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-comment">--  1. The original outputs</span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-comment">--  2. Tx fee</span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-comment">--  3. Return and total collateral</span><span>
</span><span id="line-337"></span><span>    </span><span id="local-6989586621681701672"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701672"><span class="hs-identifier hs-var">txbody2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-338"></span><span>      </span><span class="annot"><span class="annottext">(TxBodyError -&gt; TxFeeEstimationError era)
-&gt; Either TxBodyError (TxBody era)
-&gt; Either (TxFeeEstimationError era) (TxBody era)
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; TxFeeEstimationError era
forall era. TxBodyError -&gt; TxFeeEstimationError era
</span><a href="Cardano.Api.Fees.html#TxFeeEstimationxBodyError"><span class="hs-identifier hs-var">TxFeeEstimationxBodyError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TxBodyError (TxBody era)
 -&gt; Either (TxFeeEstimationError era) (TxBody era))
-&gt; Either TxBodyError (TxBody era)
-&gt; Either (TxFeeEstimationError era) (TxBody era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- TODO: impossible to fail now</span><span>
</span><span id="line-339"></span><span>        </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
</span><a href="Cardano.Api.Tx.Body.html#createTransactionBody"><span class="hs-identifier hs-var">createTransactionBody</span></a></span><span>
</span><span id="line-340"></span><span>          </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-341"></span><span>          </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701550"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span>
</span><span id="line-342"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txFee"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxFeeExplicit"><span class="hs-identifier hs-type">TxFeeExplicit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701548"><span class="hs-identifier hs-type">sbe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701657"><span class="hs-identifier hs-type">fee</span></a></span><span>
</span><span id="line-343"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txReturnCollateral"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681701658"><span class="hs-identifier hs-type">retColl</span></a></span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txTotalCollateral"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681701659"><span class="hs-identifier hs-type">reqCol</span></a></span><span>
</span><span id="line-345"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681701673"><span class="annot"><span class="annottext">fakeUTxO :: UTxO era
</span><a href="#local-6989586621681701673"><span class="hs-identifier hs-var hs-var">fakeUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Coin -&gt; UTxO era
forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Coin -&gt; UTxO era
</span><a href="Cardano.Api.Fees.html#createFakeUTxO"><span class="hs-identifier hs-var">createFakeUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701550"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; UTxO era) -&gt; Coin -&gt; UTxO era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin
</span><a href="Cardano.Api.Value.html#selectLovelace"><span class="hs-identifier hs-var">selectLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681701602"><span class="hs-identifier hs-var">availableUTxOValue</span></a></span><span>
</span><span id="line-348"></span><span>        </span><span id="local-6989586621681701676"><span class="annot"><span class="annottext">balance :: TxOutValue era
</span><a href="#local-6989586621681701676"><span class="hs-identifier hs-var hs-var">balance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-349"></span><span>          </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Set (Hash StakePoolKey)
-&gt; Map StakeCredential Coin
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; UTxO era
-&gt; TxBody era
-&gt; TxOutValue era
forall era.
ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Set (Hash StakePoolKey)
-&gt; Map StakeCredential Coin
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; UTxO era
-&gt; TxBody era
-&gt; TxOutValue era
</span><a href="Cardano.Api.Fees.html#evaluateTransactionBalance"><span class="hs-identifier hs-var">evaluateTransactionBalance</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701537"><span class="hs-identifier hs-var">pparams</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681701538"><span class="hs-identifier hs-var">poolids</span></a></span><span> </span><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681701539"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681701540"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681701673"><span class="hs-identifier hs-var">fakeUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701672"><span class="hs-identifier hs-var">txbody2</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-comment">-- check if the balance is positive or negative</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-comment">-- in one case we can produce change, in the other the inputs are insufficient</span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><span class="annottext">(TxBodyErrorAutoBalance era -&gt; TxFeeEstimationError era)
-&gt; Either (TxBodyErrorAutoBalance era) ()
-&gt; Either (TxFeeEstimationError era) ()
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era -&gt; TxFeeEstimationError era
forall era. TxBodyErrorAutoBalance era -&gt; TxFeeEstimationError era
</span><a href="Cardano.Api.Fees.html#TxFeeEstimationBalanceError"><span class="hs-identifier hs-var">TxFeeEstimationBalanceError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (TxBodyErrorAutoBalance era) ()
 -&gt; Either (TxFeeEstimationError era) ())
-&gt; Either (TxBodyErrorAutoBalance era) ()
-&gt; Either (TxFeeEstimationError era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; AddressInEra era
-&gt; TxOutValue era
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall era.
ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; AddressInEra era
-&gt; TxOutValue era
-&gt; Either (TxBodyErrorAutoBalance era) ()
</span><a href="Cardano.Api.Fees.html#balanceCheck"><span class="hs-identifier hs-var">balanceCheck</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701537"><span class="hs-identifier hs-var">pparams</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681701546"><span class="hs-identifier hs-var">changeaddr</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681701676"><span class="hs-identifier hs-var">balance</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-comment">-- Step 6. Check all txouts have the min required UTxO value</span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><span class="annottext">[TxOut CtxTx era]
-&gt; (TxOut CtxTx era -&gt; Either (TxFeeEstimationError era) ())
-&gt; Either (TxFeeEstimationError era) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; [TxOut CtxTx era]
forall build era. TxBodyContent build era -&gt; [TxOut CtxTx era]
</span><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701550"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TxOut CtxTx era -&gt; Either (TxFeeEstimationError era) ())
 -&gt; Either (TxFeeEstimationError era) ())
-&gt; (TxOut CtxTx era -&gt; Either (TxFeeEstimationError era) ())
-&gt; Either (TxFeeEstimationError era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-glyph">\</span><span id="local-6989586621681701679"><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621681701679"><span class="hs-identifier hs-var">txout</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxBodyErrorAutoBalance era -&gt; TxFeeEstimationError era)
-&gt; Either (TxBodyErrorAutoBalance era) ()
-&gt; Either (TxFeeEstimationError era) ()
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era -&gt; TxFeeEstimationError era
forall era. TxBodyErrorAutoBalance era -&gt; TxFeeEstimationError era
</span><a href="Cardano.Api.Fees.html#TxFeeEstimationBalanceError"><span class="hs-identifier hs-var">TxFeeEstimationBalanceError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (TxBodyErrorAutoBalance era) ()
 -&gt; Either (TxFeeEstimationError era) ())
-&gt; Either (TxBodyErrorAutoBalance era) ()
-&gt; Either (TxFeeEstimationError era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxOut CtxTx era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall era.
ShelleyBasedEra era
-&gt; TxOut CtxTx era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Either (TxBodyErrorAutoBalance era) ()
</span><a href="Cardano.Api.Fees.html#checkMinUTxOValue"><span class="hs-identifier hs-var">checkMinUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621681701679"><span class="hs-identifier hs-var">txout</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701537"><span class="hs-identifier hs-var">pparams</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-comment">-- Step 7.</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-comment">-- Create the txbody with the final fee and change output. This should work</span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-comment">-- provided that the fee and change are less than 2^32-1, and so will</span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-comment">-- fit within the encoding size we picked above when calculating the fee.</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-comment">-- Yes this could be an over-estimate by a few bytes if the fee or change</span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-comment">-- would fit within 2^16-1. That's a possible optimisation.</span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681701681"><span class="annot"><span class="annottext">finalTxBodyContent :: TxBodyContent BuildTx era
</span><a href="#local-6989586621681701681"><span class="hs-identifier hs-var hs-var">finalTxBodyContent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-366"></span><span>          </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701550"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span>
</span><span id="line-367"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txFee"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxFeeExplicit"><span class="hs-identifier hs-type">TxFeeExplicit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701548"><span class="hs-identifier hs-type">sbe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701657"><span class="hs-identifier hs-type">fee</span></a></span><span>
</span><span id="line-368"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-369"></span><span>                </span><span class="annot"><a href="Cardano.Api.Fees.html#accountForNoChange"><span class="hs-identifier hs-type">accountForNoChange</span></a></span><span>
</span><span id="line-370"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701546"><span class="hs-identifier hs-type">changeaddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701676"><span class="hs-identifier hs-type">balance</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-type">TxOutDatumNone</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-type">ReferenceScriptNone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701536"><span class="hs-identifier hs-type">txbodycontent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txReturnCollateral"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681701658"><span class="hs-identifier hs-type">retColl</span></a></span><span>
</span><span id="line-373"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txTotalCollateral"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681701659"><span class="hs-identifier hs-type">reqCol</span></a></span><span>
</span><span id="line-374"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-375"></span><span>    </span><span id="local-6989586621681701683"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701683"><span class="hs-identifier hs-var">txbody3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-376"></span><span>      </span><span class="annot"><span class="annottext">(TxBodyError -&gt; TxFeeEstimationError era)
-&gt; Either TxBodyError (TxBody era)
-&gt; Either (TxFeeEstimationError era) (TxBody era)
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; TxFeeEstimationError era
forall era. TxBodyError -&gt; TxFeeEstimationError era
</span><a href="Cardano.Api.Fees.html#TxFeeEstimationFinalConstructionError"><span class="hs-identifier hs-var">TxFeeEstimationFinalConstructionError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TxBodyError (TxBody era)
 -&gt; Either (TxFeeEstimationError era) (TxBody era))
-&gt; Either TxBodyError (TxBody era)
-&gt; Either (TxFeeEstimationError era) (TxBody era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- TODO: impossible to fail now. We need to implement a function</span><span>
</span><span id="line-377"></span><span>      </span><span class="hs-comment">-- that simply creates a transaction body because we have already</span><span>
</span><span id="line-378"></span><span>      </span><span class="hs-comment">-- validated the transaction body earlier within makeTransactionBodyAutoBalance</span><span>
</span><span id="line-379"></span><span>        </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
</span><a href="Cardano.Api.Tx.Body.html#createTransactionBody"><span class="hs-identifier hs-var">createTransactionBody</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701681"><span class="hs-identifier hs-var">finalTxBodyContent</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="annot"><span class="annottext">BalancedTxBody era
-&gt; Either (TxFeeEstimationError era) (BalancedTxBody era)
forall a. a -&gt; Either (TxFeeEstimationError era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-381"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
-&gt; UnsignedTx (ApiEraToExperimentalEra era)
-&gt; TxOut CtxTx era
-&gt; Coin
-&gt; BalancedTxBody era
forall era.
TxBodyContent BuildTx era
-&gt; UnsignedTx (ApiEraToExperimentalEra era)
-&gt; TxOut CtxTx era
-&gt; Coin
-&gt; BalancedTxBody era
</span><a href="Cardano.Api.Fees.html#BalancedTxBody"><span class="hs-identifier hs-var">BalancedTxBody</span></a></span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681701681"><span class="hs-identifier hs-var">finalTxBodyContent</span></a></span><span>
</span><span id="line-383"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxBody era -&gt; UnsignedTx (ApiEraToExperimentalEra era)
forall era.
ShelleyBasedEra era
-&gt; TxBody era -&gt; UnsignedTx (ApiEraToExperimentalEra era)
</span><a href="Cardano.Api.Experimental.Tx.html#convertTxBodyToUnsignedTx"><span class="hs-identifier hs-var">convertTxBodyToUnsignedTx</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701548"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701683"><span class="hs-identifier hs-var">txbody3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum CtxTx era
-&gt; ReferenceScript era
-&gt; TxOut CtxTx era
forall ctx era.
AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum ctx era
-&gt; ReferenceScript era
-&gt; TxOut ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681701546"><span class="hs-identifier hs-var">changeaddr</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681701676"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
forall ctx era. TxOutDatum ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-var">TxOutDatumNone</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript era
forall era. ReferenceScript era
</span><a href="Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-var">ReferenceScriptNone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>          </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681701657"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-386"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="hs-comment">--- ----------------------------------------------------------------------------</span><span>
</span><span id="line-389"></span><span class="hs-comment">--- Transaction fees</span><span>
</span><span id="line-390"></span><span class="hs-comment">---</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="hs-comment">-- | Compute the transaction fee for a proposed transaction, with the</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- assumption that there will be the given number of key witnesses (i.e.</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- signatures).</span><span>
</span><span id="line-395"></span><span class="hs-comment">--</span><span>
</span><span id="line-396"></span><span class="hs-comment">-- Use 'calculateMinTxFee' if possible as that function is more accurate.</span><span>
</span><span id="line-397"></span><span class="annot"><a href="Cardano.Api.Fees.html#evaluateTransactionFee"><span class="hs-identifier hs-type">evaluateTransactionFee</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681700922"><span class="annot"><a href="#local-6989586621681700922"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-399"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700922"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">Ledger.PParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700922"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Sign.html#TxBody"><span class="hs-identifier hs-type">TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700922"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The number of Shelley key witnesses</span></span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The number of Byron key witnesses</span></span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-408"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Reference script size in bytes</span></span><span>
</span><span id="line-409"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-410"></span><span id="evaluateTransactionFee"><span class="annot"><span class="annottext">evaluateTransactionFee :: forall era.
ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; TxBody era
-&gt; Word
-&gt; Word
-&gt; Int
-&gt; Coin
</span><a href="Cardano.Api.Fees.html#evaluateTransactionFee"><span class="hs-identifier hs-var hs-var">evaluateTransactionFee</span></a></span></span><span> </span><span id="local-6989586621681701686"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701686"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681701687"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701687"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621681701688"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701688"><span class="hs-identifier hs-var">txbody</span></a></span></span><span> </span><span id="local-6989586621681701689"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681701689"><span class="hs-identifier hs-var">keywitcount</span></a></span></span><span> </span><span id="local-6989586621681701690"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681701690"><span class="hs-identifier hs-var">byronwitcount</span></a></span></span><span> </span><span id="local-6989586621681701691"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701691"><span class="hs-identifier hs-var">refScriptsSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-411"></span><span>  </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; (ShelleyBasedEraConstraints era =&gt; Coin) -&gt; Coin
forall era a.
ShelleyBasedEra era -&gt; (ShelleyBasedEraConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#shelleyBasedEraConstraints"><span class="hs-identifier hs-var">shelleyBasedEraConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701686"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyBasedEraConstraints era =&gt; Coin) -&gt; Coin)
-&gt; (ShelleyBasedEraConstraints era =&gt; Coin) -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; [KeyWitness era] -&gt; TxBody era -&gt; Tx era
forall era.
CardanoEra era -&gt; [KeyWitness era] -&gt; TxBody era -&gt; Tx era
</span><a href="Cardano.Api.Tx.Sign.html#makeSignedTransaction%27"><span class="hs-identifier hs-var">makeSignedTransaction'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; CardanoEra era
forall era. ShelleyBasedEra era -&gt; CardanoEra era
forall (eon :: * -&gt; *) era.
ToCardanoEra eon =&gt;
eon era -&gt; CardanoEra era
</span><a href="Cardano.Api.Eras.Core.html#toCardanoEra"><span class="hs-identifier hs-var">toCardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701686"><span class="hs-identifier hs-var">sbe</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701688"><span class="hs-identifier hs-var">txbody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-413"></span><span>      </span><span class="annot"><a href="Cardano.Api.Tx.Sign.html#ShelleyTx"><span class="hs-identifier hs-type">ShelleyTx</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681701707"><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701707"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-414"></span><span>        </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
-&gt; Tx (ShelleyLedgerEra era) -&gt; Int -&gt; Int -&gt; Int -&gt; Coin
forall era.
EraTx era =&gt;
PParams era -&gt; Tx era -&gt; Int -&gt; Int -&gt; Int -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Tools.html#estimateMinFeeTx"><span class="hs-identifier hs-var">L.estimateMinFeeTx</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701687"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701707"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681701689"><span class="hs-identifier hs-var">keywitcount</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681701690"><span class="hs-identifier hs-var">byronwitcount</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681701691"><span class="hs-identifier hs-var">refScriptsSize</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="hs-comment">-- | Estimate minimum transaction fee for a proposed transaction by looking</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- into the transaction and figuring out how many and what kind of key</span><span>
</span><span id="line-418"></span><span class="hs-comment">-- witnesses this transaction needs.</span><span>
</span><span id="line-419"></span><span class="hs-comment">--</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- It requires access to the portion of the `UTxO` that is relevant for this</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- transaction in order to lookup any txins included in the transaction.</span><span>
</span><span id="line-422"></span><span class="hs-comment">--</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- The only type of witnesses that it cannot figure out reliably is the</span><span>
</span><span id="line-424"></span><span class="hs-comment">-- witnesses needed for satisfying native scripts included in the transaction.</span><span>
</span><span id="line-425"></span><span class="hs-comment">--</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- For this reason number of witnesses needed for native scripts must be</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- supplied as an extra argument.</span><span>
</span><span id="line-428"></span><span class="annot"><a href="Cardano.Api.Fees.html#calculateMinTxFee"><span class="hs-identifier hs-type">calculateMinTxFee</span></a></span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681700981"><span class="annot"><a href="#local-6989586621681700981"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-430"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700981"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">Ledger.PParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700981"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Query.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700981"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Sign.html#TxBody"><span class="hs-identifier hs-type">TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700981"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>
</span><span id="line-436"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The number of Shelley key witnesses</span></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-438"></span><span id="calculateMinTxFee"><span class="annot"><span class="annottext">calculateMinTxFee :: forall era.
ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; UTxO era
-&gt; TxBody era
-&gt; Word
-&gt; Coin
</span><a href="Cardano.Api.Fees.html#calculateMinTxFee"><span class="hs-identifier hs-var hs-var">calculateMinTxFee</span></a></span></span><span> </span><span id="local-6989586621681701710"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701710"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681701711"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701711"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621681701712"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681701712"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621681701713"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701713"><span class="hs-identifier hs-var">txbody</span></a></span></span><span> </span><span id="local-6989586621681701714"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681701714"><span class="hs-identifier hs-var">keywitcount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-439"></span><span>  </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; (ShelleyBasedEraConstraints era =&gt; Coin) -&gt; Coin
forall era a.
ShelleyBasedEra era -&gt; (ShelleyBasedEraConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#shelleyBasedEraConstraints"><span class="hs-identifier hs-var">shelleyBasedEraConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701710"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyBasedEraConstraints era =&gt; Coin) -&gt; Coin)
-&gt; (ShelleyBasedEraConstraints era =&gt; Coin) -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; [KeyWitness era] -&gt; TxBody era -&gt; Tx era
forall era.
CardanoEra era -&gt; [KeyWitness era] -&gt; TxBody era -&gt; Tx era
</span><a href="Cardano.Api.Tx.Sign.html#makeSignedTransaction%27"><span class="hs-identifier hs-var">makeSignedTransaction'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; CardanoEra era
forall era. ShelleyBasedEra era -&gt; CardanoEra era
forall (eon :: * -&gt; *) era.
ToCardanoEra eon =&gt;
eon era -&gt; CardanoEra era
</span><a href="Cardano.Api.Eras.Core.html#toCardanoEra"><span class="hs-identifier hs-var">toCardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701710"><span class="hs-identifier hs-var">sbe</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701713"><span class="hs-identifier hs-var">txbody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-441"></span><span>      </span><span class="annot"><a href="Cardano.Api.Tx.Sign.html#ShelleyTx"><span class="hs-identifier hs-type">ShelleyTx</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681701721"><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701721"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-442"></span><span>        </span><span class="annot"><span class="annottext">UTxO (ShelleyLedgerEra era)
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Tx (ShelleyLedgerEra era)
-&gt; Int
-&gt; Coin
forall era.
EraUTxO era =&gt;
UTxO era -&gt; PParams era -&gt; Tx era -&gt; Int -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Tools.html#calcMinFeeTx"><span class="hs-identifier hs-var">L.calcMinFeeTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; UTxO era -&gt; UTxO (ShelleyLedgerEra era)
forall era.
ShelleyBasedEra era -&gt; UTxO era -&gt; UTxO (ShelleyLedgerEra era)
</span><a href="Cardano.Api.Query.html#toLedgerUTxO"><span class="hs-identifier hs-var">toLedgerUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701710"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681701712"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701711"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701721"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681701714"><span class="hs-identifier hs-var">keywitcount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-comment">-- | Give an approximate count of the number of key witnesses (i.e. signatures)</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- a transaction will need.</span><span>
</span><span id="line-446"></span><span class="hs-comment">--</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- This is an estimate not a precise count in that it can over-estimate: it</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- makes conservative assumptions such as all inputs are from distinct</span><span>
</span><span id="line-449"></span><span class="hs-comment">-- addresses, but in principle multiple inputs can use the same address and we</span><span>
</span><span id="line-450"></span><span class="hs-comment">-- only need a witness per address.</span><span>
</span><span id="line-451"></span><span class="hs-comment">--</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- Similarly there can be overlap between the regular and collateral inputs,</span><span>
</span><span id="line-453"></span><span class="hs-comment">-- but we conservatively assume they are distinct.</span><span>
</span><span id="line-454"></span><span class="hs-comment">--</span><span>
</span><span id="line-455"></span><span class="hs-comment">-- TODO: it is worth us considering a more precise count that relies on the</span><span>
</span><span id="line-456"></span><span class="hs-comment">-- UTxO to resolve which inputs are for distinct addresses, and also to count</span><span>
</span><span id="line-457"></span><span class="hs-comment">-- the number of Shelley vs Byron style witnesses.</span><span>
</span><span id="line-458"></span><span id="local-6989586621681700987"><span class="annot"><a href="Cardano.Api.Fees.html#estimateTransactionKeyWitnessCount"><span class="hs-identifier hs-type">estimateTransactionKeyWitnessCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700987"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span></span><span>
</span><span id="line-459"></span><span id="estimateTransactionKeyWitnessCount"><span class="annot"><span class="annottext">estimateTransactionKeyWitnessCount :: forall era. TxBodyContent BuildTx era -&gt; Word
</span><a href="Cardano.Api.Fees.html#estimateTransactionKeyWitnessCount"><span class="hs-identifier hs-var hs-var">estimateTransactionKeyWitnessCount</span></a></span></span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681701741"><span class="annot"><span class="annottext">TxIns BuildTx era
txIns :: TxIns BuildTx era
txIns :: forall build era. TxBodyContent build era -&gt; TxIns build era
</span><a href="#local-6989586621681701741"><span class="hs-identifier hs-var hs-var">txIns</span></a></span></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681701743"><span class="annot"><span class="annottext">TxInsCollateral era
txInsCollateral :: forall build era. TxBodyContent build era -&gt; TxInsCollateral era
txInsCollateral :: TxInsCollateral era
</span><a href="Cardano.Api.Tx.Body.html#txInsCollateral"><span class="hs-identifier hs-var hs-var">txInsCollateral</span></a></span></span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681701744"><span class="annot"><span class="annottext">TxExtraKeyWitnesses era
txExtraKeyWits :: TxExtraKeyWitnesses era
txExtraKeyWits :: forall build era.
TxBodyContent build era -&gt; TxExtraKeyWitnesses era
</span><a href="#local-6989586621681701744"><span class="hs-identifier hs-var hs-var">txExtraKeyWits</span></a></span></span><span>
</span><span id="line-464"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681701746"><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
txWithdrawals :: TxWithdrawals BuildTx era
txWithdrawals :: forall build era.
TxBodyContent build era -&gt; TxWithdrawals build era
</span><a href="#local-6989586621681701746"><span class="hs-identifier hs-var hs-var">txWithdrawals</span></a></span></span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681701748"><span class="annot"><span class="annottext">TxCertificates BuildTx era
txCertificates :: forall build era.
TxBodyContent build era -&gt; TxCertificates build era
txCertificates :: TxCertificates BuildTx era
</span><a href="Cardano.Api.Tx.Body.html#txCertificates"><span class="hs-identifier hs-var hs-var">txCertificates</span></a></span></span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681701749"><span class="annot"><span class="annottext">TxUpdateProposal era
txUpdateProposal :: TxUpdateProposal era
txUpdateProposal :: forall build era. TxBodyContent build era -&gt; TxUpdateProposal era
</span><a href="#local-6989586621681701749"><span class="hs-identifier hs-var hs-var">txUpdateProposal</span></a></span></span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-468"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word) -&gt; Int -&gt; Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-469"></span><span>      </span><span class="annot"><span class="annottext">[()] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681701752"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681701752"><span class="hs-identifier hs-var">_txin</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#KeyWitness"><span class="hs-identifier hs-type">KeyWitness</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx era
</span><a href="#local-6989586621681701741"><span class="hs-identifier hs-var">txIns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><a href="#local-6989586621681701743"><span class="hs-identifier hs-var">txInsCollateral</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxInsCollateral"><span class="hs-identifier hs-type">TxInsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681701758"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621681701758"><span class="hs-identifier hs-var">txins</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-472"></span><span>            </span><span class="annot"><span class="annottext">[TxIn] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621681701758"><span class="hs-identifier hs-var">txins</span></a></span><span>
</span><span id="line-473"></span><span>          </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses era
</span><a href="#local-6989586621681701744"><span class="hs-identifier hs-var">txExtraKeyWits</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-475"></span><span>          </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxExtraKeyWitnesses"><span class="hs-identifier hs-type">TxExtraKeyWitnesses</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681701760"><span class="annot"><span class="annottext">[Hash PaymentKey]
</span><a href="#local-6989586621681701760"><span class="hs-identifier hs-var">khs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-476"></span><span>            </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey]
</span><a href="#local-6989586621681701760"><span class="hs-identifier hs-var">khs</span></a></span><span>
</span><span id="line-477"></span><span>          </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-478"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
</span><a href="#local-6989586621681701746"><span class="hs-identifier hs-var">txWithdrawals</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-479"></span><span>          </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxWithdrawals"><span class="hs-identifier hs-type">TxWithdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681701762"><span class="annot"><span class="annottext">[(StakeAddress, Coin,
  BuildTxWith BuildTx (Witness WitCtxStake era))]
</span><a href="#local-6989586621681701762"><span class="hs-identifier hs-var">withdrawals</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-480"></span><span>            </span><span class="annot"><span class="annottext">[()] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakeAddress
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#KeyWitness"><span class="hs-identifier hs-type">KeyWitness</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(StakeAddress, Coin,
  BuildTxWith BuildTx (Witness WitCtxStake era))]
</span><a href="#local-6989586621681701762"><span class="hs-identifier hs-var">withdrawals</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-481"></span><span>          </span><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-482"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxCertificates BuildTx era
</span><a href="#local-6989586621681701748"><span class="hs-identifier hs-var">txCertificates</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-483"></span><span>          </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxCertificates"><span class="hs-identifier hs-type">TxCertificates</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Certificate era]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span id="local-6989586621681701766"><span class="annot"><span class="annottext">[(StakeCredential, Witness WitCtxStake era)]
</span><a href="#local-6989586621681701766"><span class="hs-identifier hs-var">witnesses</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-484"></span><span>            </span><span class="annot"><span class="annottext">[()] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakeCredential
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#KeyWitness"><span class="hs-identifier hs-type">KeyWitness</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(StakeCredential, Witness WitCtxStake era)]
</span><a href="#local-6989586621681701766"><span class="hs-identifier hs-var">witnesses</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-485"></span><span>          </span><span class="annot"><span class="annottext">TxCertificates BuildTx era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-486"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxUpdateProposal era
</span><a href="#local-6989586621681701749"><span class="hs-identifier hs-var">txUpdateProposal</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-487"></span><span>          </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxUpdateProposal"><span class="hs-identifier hs-type">TxUpdateProposal</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyToBabbageEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.ProtocolParameters.html#UpdateProposal"><span class="hs-identifier hs-type">UpdateProposal</span></a></span><span> </span><span id="local-6989586621681701769"><span class="annot"><span class="annottext">Map (Hash GenesisKey) ProtocolParametersUpdate
</span><a href="#local-6989586621681701769"><span class="hs-identifier hs-var">updatePerGenesisKey</span></a></span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-488"></span><span>            </span><span class="annot"><span class="annottext">Map (Hash GenesisKey) ProtocolParametersUpdate -&gt; Int
forall k a. Map k a -&gt; Int
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#size"><span class="hs-identifier hs-var">Map.size</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Hash GenesisKey) ProtocolParametersUpdate
</span><a href="#local-6989586621681701769"><span class="hs-identifier hs-var">updatePerGenesisKey</span></a></span><span>
</span><span id="line-489"></span><span>          </span><span class="annot"><span class="annottext">TxUpdateProposal era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- Script execution units</span><span>
</span><span id="line-493"></span><span class="hs-comment">--</span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span class="hs-keyword">type</span><span> </span><span id="PlutusScriptBytes"><span class="annot"><a href="Cardano.Api.Fees.html#PlutusScriptBytes"><span class="hs-identifier hs-var">PlutusScriptBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/bytestring-0.12.1.0-inplace/src/Data.ByteString.Short.Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-keyword">data</span><span> </span><span id="ResolvablePointers"><span class="annot"><a href="Cardano.Api.Fees.html#ResolvablePointers"><span class="hs-identifier hs-var">ResolvablePointers</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-498"></span><span>  </span><span id="local-6989586621681701771"><span id="ResolvablePointers"><span class="annot"><a href="Cardano.Api.Fees.html#ResolvablePointers"><span class="hs-identifier hs-var">ResolvablePointers</span></a></span></span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.Era.html#Era"><span class="hs-identifier hs-type">Ledger.Era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701771"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#PlutusPurpose"><span class="hs-identifier hs-type">L.PlutusPurpose</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AsIx"><span class="hs-identifier hs-type">L.AsIx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701771"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#PlutusPurpose"><span class="hs-identifier hs-type">L.PlutusPurpose</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AsItem"><span class="hs-identifier hs-type">L.AsItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701771"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#PlutusScript"><span class="hs-identifier hs-type">Alonzo.PlutusScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701771"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701771"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-505"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span>
</span><span id="line-506"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#PlutusPurpose"><span class="hs-identifier hs-type">L.PlutusPurpose</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AsIx"><span class="hs-identifier hs-type">L.AsIx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701771"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#PlutusPurpose"><span class="hs-identifier hs-type">L.PlutusPurpose</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AsItem"><span class="hs-identifier hs-type">L.AsItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701771"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#PlutusScriptBytes"><span class="hs-identifier hs-type">PlutusScriptBytes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Plutus.Language.html#Language"><span class="hs-identifier hs-type">Plutus.Language</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">Ledger.ScriptHash</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">Ledger.StandardCrypto</span></a></span><span>
</span><span id="line-510"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ResolvablePointers"><span class="hs-identifier hs-type">ResolvablePointers</span></a></span></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span id="local-6989586621681701774"><span id="local-6989586621681701776"><span id="local-6989586621681701780"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ResolvablePointers"><span class="hs-identifier hs-type">ResolvablePointers</span></a></span></span></span></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="hs-comment">-- | The different possible reasons that executing a script can fail,</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- as reported by 'evaluateTransactionExecutionUnits'.</span><span>
</span><span id="line-518"></span><span class="hs-comment">--</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- The first three of these are about failures before we even get to execute</span><span>
</span><span id="line-520"></span><span class="hs-comment">-- the script, and two are the result of execution.</span><span>
</span><span id="line-521"></span><span class="hs-comment">--</span><span>
</span><span id="line-522"></span><span class="hs-comment">-- TODO: We should replace ScriptWitnessIndex with ledger's</span><span>
</span><span id="line-523"></span><span class="hs-comment">-- PlutusPurpose AsIx ledgerera. This would necessitate the</span><span>
</span><span id="line-524"></span><span class="hs-comment">-- parameterization of ScriptExecutionError.</span><span>
</span><span id="line-525"></span><span class="hs-keyword">data</span><span> </span><span id="ScriptExecutionError"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier hs-var">ScriptExecutionError</span></a></span></span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | The script depends on a 'TxIn' that has not been provided in the</span><span>
</span><span id="line-527"></span><span>    </span><span class="hs-comment">-- given 'UTxO' subset. The given 'UTxO' must cover all the inputs</span><span>
</span><span id="line-528"></span><span>    </span><span class="hs-comment">-- the transaction references.</span><span>
</span><span id="line-529"></span><span>    </span><span id="ScriptErrorMissingTxIn"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorMissingTxIn"><span class="hs-identifier hs-var">ScriptErrorMissingTxIn</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Api.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The 'TxIn' the script is spending does not have a 'ScriptDatum'.</span><span>
</span><span id="line-531"></span><span>    </span><span class="hs-comment">-- All inputs guarded by Plutus scripts need to have been created with</span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-comment">-- a 'ScriptDatum'.</span><span>
</span><span id="line-533"></span><span>    </span><span id="ScriptErrorTxInWithoutDatum"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorTxInWithoutDatum"><span class="hs-identifier hs-var">ScriptErrorTxInWithoutDatum</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Api.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The 'ScriptDatum' provided does not match the one from the 'UTxO'.</span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-comment">-- This means the wrong 'ScriptDatum' value has been provided.</span><span>
</span><span id="line-536"></span><span>    </span><span id="ScriptErrorWrongDatum"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorWrongDatum"><span class="hs-identifier hs-var">ScriptErrorWrongDatum</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Hash.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.ScriptData.html#ScriptData"><span class="hs-identifier hs-type">ScriptData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The script evaluation failed. This usually means it evaluated to an</span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-comment">-- error value. This is not a case of running out of execution units</span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-comment">-- (which is not possible for 'evaluateTransactionExecutionUnits' since</span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-comment">-- the whole point of it is to discover how many execution units are</span><span>
</span><span id="line-541"></span><span>    </span><span class="hs-comment">-- needed).</span><span>
</span><span id="line-542"></span><span>    </span><span id="ScriptErrorEvaluationFailed"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorEvaluationFailed"><span class="hs-identifier hs-var">ScriptErrorEvaluationFailed</span></a></span></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/plutus-ledger-api-1.31.0.0-db9af58aeade3ac39fff3e4e303e3a49b50eea6e94a3e5bc6a9a3a9a39a4b221/share/doc/html/src/PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">Plutus.EvaluationError</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/text-2.1.1-inplace/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text.Text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The execution units overflowed a 64bit word. Congratulations if</span><span>
</span><span id="line-544"></span><span>    </span><span class="hs-comment">-- you encounter this error. With the current style of cost model this</span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-comment">-- would need a script to run for over 7 months, which is somewhat more</span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-comment">-- than the expected maximum of a few milliseconds.</span><span>
</span><span id="line-547"></span><span>    </span><span id="ScriptErrorExecutionUnitsOverflow"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorExecutionUnitsOverflow"><span class="hs-identifier hs-var">ScriptErrorExecutionUnitsOverflow</span></a></span></span><span>
</span><span id="line-548"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | An attempt was made to spend a key witnessed tx input</span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-comment">-- with a script witness.</span><span>
</span><span id="line-550"></span><span>    </span><span id="ScriptErrorNotPlutusWitnessedTxIn"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorNotPlutusWitnessedTxIn"><span class="hs-identifier hs-var">ScriptErrorNotPlutusWitnessedTxIn</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ScriptHash"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span>
</span><span id="line-551"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The redeemer pointer points to a script hash that does not exist</span><span>
</span><span id="line-552"></span><span>    </span><span class="hs-comment">-- in the transaction nor in the UTxO as a reference script&quot;</span><span>
</span><span id="line-553"></span><span>    </span><span id="ScriptErrorRedeemerPointsToUnknownScriptHash"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorRedeemerPointsToUnknownScriptHash"><span class="hs-identifier hs-var">ScriptErrorRedeemerPointsToUnknownScriptHash</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | A redeemer pointer points to a script that does not exist.</span></span><span>
</span><span id="line-555"></span><span>    </span><span id="ScriptErrorMissingScript"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorMissingScript"><span class="hs-identifier hs-var">ScriptErrorMissingScript</span></a></span></span><span>
</span><span id="line-556"></span><span>      </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="hs-comment">-- The invalid pointer</span><span>
</span><span id="line-557"></span><span>      </span><span class="annot"><a href="Cardano.Api.Fees.html#ResolvablePointers"><span class="hs-identifier hs-type">ResolvablePointers</span></a></span><span> </span><span class="hs-comment">-- A mapping a pointers that are possible to resolve</span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | A cost model was missing for a language which was used.</span></span><span>
</span><span id="line-559"></span><span>    </span><span id="ScriptErrorMissingCostModel"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorMissingCostModel"><span class="hs-identifier hs-var">ScriptErrorMissingCostModel</span></a></span></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Plutus.Language.html#Language"><span class="hs-identifier hs-type">Plutus.Language</span></a></span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681701792"><span class="annot"><a href="#local-6989586621681701792"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-561"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Context.html#EraPlutusContext"><span class="hs-identifier hs-type">Plutus.EraPlutusContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701792"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Context.html#ContextError"><span class="hs-identifier hs-type">Plutus.ContextError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701792"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-564"></span><span>    </span><span id="ScriptErrorTranslationError"><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorTranslationError"><span class="hs-identifier hs-var">ScriptErrorTranslationError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Context.html#ContextError"><span class="hs-identifier hs-type">Plutus.ContextError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701792"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span id="local-6989586621681701795"><span id="local-6989586621681701822"><span id="local-6989586621681701826"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier hs-type">ScriptExecutionError</span></a></span></span></span></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Api.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier hs-type">ScriptExecutionError</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-569"></span><span>  </span><span id="local-6989586621681701889"><span class="annot"><span class="annottext">prettyError :: forall ann. ScriptExecutionError -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var hs-var hs-var hs-var">prettyError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-570"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorMissingTxIn"><span class="hs-identifier hs-type">ScriptErrorMissingTxIn</span></a></span><span> </span><span id="local-6989586621681701890"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681701890"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-571"></span><span>      </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The supplied UTxO is missing the txin &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc ann
forall ann. Text -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; Text
</span><a href="Cardano.Api.TxIn.html#renderTxIn"><span class="hs-identifier hs-var">renderTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681701890"><span class="hs-identifier hs-var">txin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorTxInWithoutDatum"><span class="hs-identifier hs-type">ScriptErrorTxInWithoutDatum</span></a></span><span> </span><span id="local-6989586621681701893"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681701893"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-573"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-574"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The Plutus script witness for the txin does not have a script datum &quot;</span></span><span>
</span><span id="line-575"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;(according to the UTxO). The txin in question is &quot;</span></span><span>
</span><span id="line-576"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc ann
forall ann. Text -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; Text
</span><a href="Cardano.Api.TxIn.html#renderTxIn"><span class="hs-identifier hs-var">renderTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681701893"><span class="hs-identifier hs-var">txin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorWrongDatum"><span class="hs-identifier hs-type">ScriptErrorWrongDatum</span></a></span><span> </span><span id="local-6989586621681701894"><span class="annot"><span class="annottext">Hash ScriptData
</span><a href="#local-6989586621681701894"><span class="hs-identifier hs-var">dh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-579"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-580"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The Plutus script witness has the wrong datum (according to the UTxO). &quot;</span></span><span>
</span><span id="line-581"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The expected datum value has hash &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Hash ScriptData -&gt; Doc ann
forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="Cardano.Api.Pretty.html#pshow"><span class="hs-identifier hs-var">pshow</span></a></span><span> </span><span class="annot"><span class="annottext">Hash ScriptData
</span><a href="#local-6989586621681701894"><span class="hs-identifier hs-var">dh</span></a></span><span>
</span><span id="line-582"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-583"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorEvaluationFailed"><span class="hs-identifier hs-type">ScriptErrorEvaluationFailed</span></a></span><span> </span><span id="local-6989586621681701896"><span class="annot"><span class="annottext">EvaluationError
</span><a href="#local-6989586621681701896"><span class="hs-identifier hs-var">evalErr</span></a></span></span><span> </span><span id="local-6989586621681701897"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621681701897"><span class="hs-identifier hs-var">logs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-584"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-585"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The Plutus script evaluation failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationError -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
forall ann. EvaluationError -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">EvaluationError
</span><a href="#local-6989586621681701896"><span class="hs-identifier hs-var">evalErr</span></a></span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;\nScript debugging logs: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Doc ann) -&gt; [Text] -&gt; [Doc ann]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681701898"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681701898"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc ann
forall ann. Text -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Doc ann) -&gt; Text -&gt; Doc ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681701898"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/text-2.1.1-inplace/src/Data.Text.Internal.html#append"><span class="hs-operator hs-var">`Text.append`</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621681701897"><span class="hs-identifier hs-var">logs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-588"></span><span>    </span><span class="annot"><span class="annottext">ScriptExecutionError
</span><a href="Cardano.Api.Fees.html#ScriptErrorExecutionUnitsOverflow"><span class="hs-identifier hs-var">ScriptErrorExecutionUnitsOverflow</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-589"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-590"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The execution units required by this Plutus script overflows a 64bit &quot;</span></span><span>
</span><span id="line-591"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;word. In a properly configured chain this should be practically &quot;</span></span><span>
</span><span id="line-592"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;impossible. So this probably indicates a chain configuration problem, &quot;</span></span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;perhaps with the values in the cost model.&quot;</span></span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-595"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorNotPlutusWitnessedTxIn"><span class="hs-identifier hs-type">ScriptErrorNotPlutusWitnessedTxIn</span></a></span><span> </span><span id="local-6989586621681701900"><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681701900"><span class="hs-identifier hs-var">scriptWitness</span></a></span></span><span> </span><span id="local-6989586621681701901"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621681701901"><span class="hs-identifier hs-var">scriptHash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-596"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc ann
forall ann. String -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptWitnessIndex -&gt; String
</span><a href="Cardano.Api.Tx.Body.html#renderScriptWitnessIndex"><span class="hs-identifier hs-var">renderScriptWitnessIndex</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681701900"><span class="hs-identifier hs-var">scriptWitness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot; is not a Plutus script witnessed tx input and cannot be spent using a &quot;</span></span><span>
</span><span id="line-599"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Plutus script witness.The script hash is &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; Doc ann
forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="Cardano.Api.Pretty.html#pshow"><span class="hs-identifier hs-var">pshow</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621681701901"><span class="hs-identifier hs-var">scriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-600"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-601"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorRedeemerPointsToUnknownScriptHash"><span class="hs-identifier hs-type">ScriptErrorRedeemerPointsToUnknownScriptHash</span></a></span><span> </span><span id="local-6989586621681701903"><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681701903"><span class="hs-identifier hs-var">scriptWitness</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-602"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc ann
forall ann. String -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptWitnessIndex -&gt; String
</span><a href="Cardano.Api.Tx.Body.html#renderScriptWitnessIndex"><span class="hs-identifier hs-var">renderScriptWitnessIndex</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681701903"><span class="hs-identifier hs-var">scriptWitness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot; points to a script hash that is not known.&quot;</span></span><span>
</span><span id="line-605"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorMissingScript"><span class="hs-identifier hs-type">ScriptErrorMissingScript</span></a></span><span> </span><span id="local-6989586621681701904"><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681701904"><span class="hs-identifier hs-var">rdmrPtr</span></a></span></span><span> </span><span id="local-6989586621681701905"><span class="annot"><span class="annottext">ResolvablePointers
</span><a href="#local-6989586621681701905"><span class="hs-identifier hs-var">resolveable</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-607"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-608"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The redeemer pointer: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex -&gt; Doc ann
forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="Cardano.Api.Pretty.html#pshow"><span class="hs-identifier hs-var">pshow</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681701904"><span class="hs-identifier hs-var">rdmrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot; points to a Plutus &quot;</span></span><span>
</span><span id="line-609"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;script that does not exist.\n&quot;</span></span><span>
</span><span id="line-610"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The pointers that can be resolved are: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvablePointers -&gt; Doc ann
forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="Cardano.Api.Pretty.html#pshow"><span class="hs-identifier hs-var">pshow</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvablePointers
</span><a href="#local-6989586621681701905"><span class="hs-identifier hs-var">resolveable</span></a></span><span>
</span><span id="line-611"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-612"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorMissingCostModel"><span class="hs-identifier hs-type">ScriptErrorMissingCostModel</span></a></span><span> </span><span id="local-6989586621681701906"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621681701906"><span class="hs-identifier hs-var">language</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-613"></span><span>      </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;No cost model was found for language &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Language -&gt; Doc ann
forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="Cardano.Api.Pretty.html#pshow"><span class="hs-identifier hs-var">pshow</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621681701906"><span class="hs-identifier hs-var">language</span></a></span><span>
</span><span id="line-614"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptErrorTranslationError"><span class="hs-identifier hs-type">ScriptErrorTranslationError</span></a></span><span> </span><span id="local-6989586621681701912"><span class="annot"><span class="annottext">ContextError (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701912"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-615"></span><span>      </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Error translating the transaction context: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ContextError (ShelleyLedgerEra era) -&gt; Doc ann
forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="Cardano.Api.Pretty.html#pshow"><span class="hs-identifier hs-var">pshow</span></a></span><span> </span><span class="annot"><span class="annottext">ContextError (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701912"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="hs-keyword">data</span><span> </span><span id="TransactionValidityError"><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityError"><span class="hs-identifier hs-var">TransactionValidityError</span></a></span></span><span> </span><span id="local-6989586621681701913"><span class="annot"><a href="#local-6989586621681701913"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-comment">-- | The transaction validity interval is too far into the future.</span><span>
</span><span id="line-619"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-620"></span><span>  </span><span class="hs-comment">-- Transactions with Plutus scripts need to have a validity interval that is</span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-comment">-- not so far in the future that we cannot reliably determine the UTC time</span><span>
</span><span id="line-622"></span><span>  </span><span class="hs-comment">-- corresponding to the validity interval expressed in slot numbers.</span><span>
</span><span id="line-623"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-comment">-- This is because the Plutus scripts get given the transaction validity</span><span>
</span><span id="line-625"></span><span>  </span><span class="hs-comment">-- interval in UTC time, so that they are not sensitive to slot lengths.</span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-627"></span><span>  </span><span class="hs-comment">-- If either end of the validity interval is beyond the so called \&quot;time</span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-comment">-- horizon\&quot; then the consensus algorithm is not able to reliably determine</span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-comment">-- the relationship between slots and time. This is this situation in which</span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-comment">-- this error is reported. For the Cardano mainnet the time horizon is 36</span><span>
</span><span id="line-631"></span><span>  </span><span class="hs-comment">-- hours beyond the current time. This effectively means we cannot submit</span><span>
</span><span id="line-632"></span><span>  </span><span class="hs-comment">-- check or submit transactions that use Plutus scripts that have the end</span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-comment">-- of their validity interval more than 36 hours into the future.</span><span>
</span><span id="line-634"></span><span>  </span><span id="local-6989586621681701914"><span id="TransactionValidityIntervalError"><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityIntervalError"><span class="hs-identifier hs-var">TransactionValidityIntervalError</span></a></span></span><span>
</span><span id="line-635"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/ouroboros-consensus-0.20.0.0-34ac19209df95b018b93a9c558ab9784e274c06bd37480b7ee7319d80bbfbf03/share/doc/html/src/Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">Consensus.PastHorizonException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityError"><span class="hs-identifier hs-type">TransactionValidityError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701914"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-636"></span><span>  </span><span id="local-6989586621681701916"><span id="TransactionValidityCostModelError"><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityCostModelError"><span class="hs-identifier hs-var">TransactionValidityCostModelError</span></a></span></span><span>
</span><span id="line-637"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#AnyPlutusScriptVersion"><span class="hs-identifier hs-type">AnyPlutusScriptVersion</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.ProtocolParameters.html#CostModel"><span class="hs-identifier hs-type">CostModel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityError"><span class="hs-identifier hs-type">TransactionValidityError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701916"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span id="local-6989586621681700781"><span id="local-6989586621681701919"><span id="local-6989586621681701930"><span id="local-6989586621681701933"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityError"><span class="hs-identifier hs-type">TransactionValidityError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700781"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681700785"><span class="annot"><a href="Cardano.Api.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityError"><span class="hs-identifier hs-type">TransactionValidityError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700785"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-642"></span><span>  </span><span id="local-6989586621681701964"><span class="annot"><span class="annottext">prettyError :: forall ann. TransactionValidityError era -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var hs-var hs-var hs-var">prettyError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-643"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityIntervalError"><span class="hs-identifier hs-type">TransactionValidityIntervalError</span></a></span><span> </span><span id="local-6989586621681701965"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621681701965"><span class="hs-identifier hs-var">pastTimeHorizon</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-644"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-645"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The transaction validity interval is too far in the future. &quot;</span></span><span>
</span><span id="line-646"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;For this network it must not be more than &quot;</span></span><span>
</span><span id="line-647"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Doc ann
forall ann. Word -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PastHorizonException -&gt; Word
</span><a href="#local-6989586621681701966"><span class="hs-identifier hs-var">timeHorizonSlots</span></a></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621681701965"><span class="hs-identifier hs-var">pastTimeHorizon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;slots ahead of the current time slot. &quot;</span></span><span>
</span><span id="line-649"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;(Transactions with Plutus scripts must have validity intervals that &quot;</span></span><span>
</span><span id="line-650"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;are close enough in the future that we can reliably turn the slot &quot;</span></span><span>
</span><span id="line-651"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;numbers into UTC wall clock times.)&quot;</span></span><span>
</span><span id="line-652"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-653"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-654"></span><span>      </span><span class="annot"><a href="#local-6989586621681701966"><span class="hs-identifier hs-type">timeHorizonSlots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/ouroboros-consensus-0.20.0.0-34ac19209df95b018b93a9c558ab9784e274c06bd37480b7ee7319d80bbfbf03/share/doc/html/src/Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">Consensus.PastHorizonException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>
</span><span id="line-655"></span><span>      </span><span id="local-6989586621681701966"><span class="annot"><span class="annottext">timeHorizonSlots :: PastHorizonException -&gt; Word
</span><a href="#local-6989586621681701966"><span class="hs-identifier hs-var hs-var">timeHorizonSlots</span></a></span></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/ouroboros-consensus-0.20.0.0-34ac19209df95b018b93a9c558ab9784e274c06bd37480b7ee7319d80bbfbf03/share/doc/html/src/Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizon"><span class="hs-identifier hs-type">Consensus.PastHorizon</span></a></span><span class="hs-special">{</span><span id="local-6989586621681701968"><span class="annot"><span class="annottext">[EraSummary]
pastHorizonSummary :: [EraSummary]
pastHorizonSummary :: PastHorizonException -&gt; [EraSummary]
</span><a href="#local-6989586621681701968"><span class="hs-identifier hs-var hs-var">Consensus.pastHorizonSummary</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-656"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681701970"><span class="annot"><span class="annottext">eraSummaries :: [EraSummary]
</span><a href="#local-6989586621681701970"><span class="hs-identifier hs-var">eraSummaries</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EraSummary
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[EraSummary]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[EraSummary]
</span><a href="#local-6989586621681701968"><span class="hs-identifier hs-var">pastHorizonSummary</span></a></span><span>
</span><span id="line-657"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/ouroboros-consensus-0.20.0.0-34ac19209df95b018b93a9c558ab9784e274c06bd37480b7ee7319d80bbfbf03/share/doc/html/src/Ouroboros.Consensus.HardFork.History.EraParams.html#StandardSafeZone"><span class="hs-identifier hs-type">Consensus.StandardSafeZone</span></a></span><span> </span><span id="local-6989586621681701972"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621681701972"><span class="hs-identifier hs-var">slots</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-658"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EraParams -&gt; SafeZone
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/ouroboros-consensus-0.20.0.0-34ac19209df95b018b93a9c558ab9784e274c06bd37480b7ee7319d80bbfbf03/share/doc/html/src/Ouroboros.Consensus.HardFork.History.EraParams.html#eraSafeZone"><span class="hs-identifier hs-var">Consensus.eraSafeZone</span></a></span><span> </span><span class="annot"><span class="annottext">(EraParams -&gt; SafeZone)
-&gt; ([EraSummary] -&gt; EraParams) -&gt; [EraSummary] -&gt; SafeZone
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">EraSummary -&gt; EraParams
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/ouroboros-consensus-0.20.0.0-34ac19209df95b018b93a9c558ab9784e274c06bd37480b7ee7319d80bbfbf03/share/doc/html/src/Ouroboros.Consensus.HardFork.History.Summary.html#eraParams"><span class="hs-identifier hs-var">Consensus.eraParams</span></a></span><span> </span><span class="annot"><span class="annottext">(EraSummary -&gt; EraParams)
-&gt; ([EraSummary] -&gt; EraSummary) -&gt; [EraSummary] -&gt; EraParams
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[EraSummary] -&gt; EraSummary
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EraSummary]
</span><a href="#local-6989586621681701970"><span class="hs-identifier hs-var">eraSummaries</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-659"></span><span>            </span><span class="annot"><span class="annottext">Word64 -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621681701972"><span class="hs-identifier hs-var">slots</span></a></span><span>
</span><span id="line-660"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-661"></span><span>            </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- This should be impossible.</span><span>
</span><span id="line-662"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityCostModelError"><span class="hs-identifier hs-type">TransactionValidityCostModelError</span></a></span><span> </span><span id="local-6989586621681701976"><span class="annot"><span class="annottext">Map AnyPlutusScriptVersion CostModel
</span><a href="#local-6989586621681701976"><span class="hs-identifier hs-var">cModels</span></a></span></span><span> </span><span id="local-6989586621681701977"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681701977"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-663"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-664"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;An error occurred while converting from the cardano-api cost&quot;</span></span><span>
</span><span id="line-665"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot; models to the cardano-ledger cost models. Error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc ann
forall ann. String -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681701977"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-666"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot; Cost models: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map AnyPlutusScriptVersion CostModel -&gt; Doc ann
forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="Cardano.Api.Pretty.html#pshow"><span class="hs-identifier hs-var">pshow</span></a></span><span> </span><span class="annot"><span class="annottext">Map AnyPlutusScriptVersion CostModel
</span><a href="#local-6989586621681701976"><span class="hs-identifier hs-var">cModels</span></a></span><span>
</span><span id="line-667"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span class="hs-comment">-- | Compute the 'ExecutionUnits' needed for each script in the transaction.</span><span>
</span><span id="line-670"></span><span class="hs-comment">--</span><span>
</span><span id="line-671"></span><span class="hs-comment">-- This works by running all the scripts and counting how many execution units</span><span>
</span><span id="line-672"></span><span class="hs-comment">-- are actually used.</span><span>
</span><span id="line-673"></span><span class="annot"><a href="Cardano.Api.Fees.html#evaluateTransactionExecutionUnits"><span class="hs-identifier hs-type">evaluateTransactionExecutionUnits</span></a></span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681701045"><span class="annot"><a href="#local-6989586621681701045"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-675"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Eras.Core.html#CardanoEra"><span class="hs-identifier hs-type">CardanoEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701045"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-slotting-0.2.0.0-d6cb9dd28348e9fcb07e21ccfbef6fa3fb3b94338728b796d31c774e57d616a9/share/doc/html/src/Cardano.Slotting.Time.html#SystemStart"><span class="hs-identifier hs-type">SystemStart</span></a></span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Query.html#LedgerEpochInfo"><span class="hs-identifier hs-type">LedgerEpochInfo</span></a></span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.ProtocolParameters.html#LedgerProtocolParameters"><span class="hs-identifier hs-type">LedgerProtocolParameters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701045"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-680"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Query.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701045"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-681"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Sign.html#TxBody"><span class="hs-identifier hs-type">TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701045"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-682"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span>
</span><span id="line-683"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityError"><span class="hs-identifier hs-type">TransactionValidityError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701045"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier hs-type">ScriptExecutionError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#EvalTxExecutionUnitsLog"><span class="hs-identifier hs-type">EvalTxExecutionUnitsLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ExecutionUnits"><span class="hs-identifier hs-type">ExecutionUnits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span id="evaluateTransactionExecutionUnits"><span class="annot"><span class="annottext">evaluateTransactionExecutionUnits :: forall era.
CardanoEra era
-&gt; SystemStart
-&gt; LedgerEpochInfo
-&gt; LedgerProtocolParameters era
-&gt; UTxO era
-&gt; TxBody era
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
</span><a href="Cardano.Api.Fees.html#evaluateTransactionExecutionUnits"><span class="hs-identifier hs-var hs-var">evaluateTransactionExecutionUnits</span></a></span></span><span> </span><span id="local-6989586621681701979"><span class="annot"><span class="annottext">CardanoEra era
</span><a href="#local-6989586621681701979"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621681701980"><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621681701980"><span class="hs-identifier hs-var">systemstart</span></a></span></span><span> </span><span id="local-6989586621681701981"><span class="annot"><span class="annottext">LedgerEpochInfo
</span><a href="#local-6989586621681701981"><span class="hs-identifier hs-var">epochInfo</span></a></span></span><span> </span><span id="local-6989586621681701982"><span class="annot"><span class="annottext">LedgerProtocolParameters era
</span><a href="#local-6989586621681701982"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621681701983"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681701983"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621681701984"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701984"><span class="hs-identifier hs-var">txbody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; [KeyWitness era] -&gt; TxBody era -&gt; Tx era
forall era.
CardanoEra era -&gt; [KeyWitness era] -&gt; TxBody era -&gt; Tx era
</span><a href="Cardano.Api.Tx.Sign.html#makeSignedTransaction%27"><span class="hs-identifier hs-var">makeSignedTransaction'</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
</span><a href="#local-6989586621681701979"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621681701984"><span class="hs-identifier hs-var">txbody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-687"></span><span>    </span><span class="annot"><a href="Cardano.Api.Tx.Sign.html#ShelleyTx"><span class="hs-identifier hs-type">ShelleyTx</span></a></span><span> </span><span id="local-6989586621681701985"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701985"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681701986"><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701986"><span class="hs-identifier hs-var">tx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; SystemStart
-&gt; LedgerEpochInfo
-&gt; LedgerProtocolParameters era
-&gt; UTxO era
-&gt; Tx (ShelleyLedgerEra era)
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall era.
ShelleyBasedEra era
-&gt; SystemStart
-&gt; LedgerEpochInfo
-&gt; LedgerProtocolParameters era
-&gt; UTxO era
-&gt; Tx (ShelleyLedgerEra era)
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
</span><a href="Cardano.Api.Fees.html#evaluateTransactionExecutionUnitsShelley"><span class="hs-identifier hs-var">evaluateTransactionExecutionUnitsShelley</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701985"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621681701980"><span class="hs-identifier hs-var">systemstart</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerEpochInfo
</span><a href="#local-6989586621681701981"><span class="hs-identifier hs-var">epochInfo</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerProtocolParameters era
</span><a href="#local-6989586621681701982"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681701983"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701986"><span class="hs-identifier hs-var">tx'</span></a></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="annot"><a href="Cardano.Api.Fees.html#evaluateTransactionExecutionUnitsShelley"><span class="hs-identifier hs-type">evaluateTransactionExecutionUnitsShelley</span></a></span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681701047"><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-691"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-slotting-0.2.0.0-d6cb9dd28348e9fcb07e21ccfbef6fa3fb3b94338728b796d31c774e57d616a9/share/doc/html/src/Cardano.Slotting.Time.html#SystemStart"><span class="hs-identifier hs-type">SystemStart</span></a></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Query.html#LedgerEpochInfo"><span class="hs-identifier hs-type">LedgerEpochInfo</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.ProtocolParameters.html#LedgerProtocolParameters"><span class="hs-identifier hs-type">LedgerProtocolParameters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Query.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">L.Tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span>
</span><span id="line-699"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityError"><span class="hs-identifier hs-type">TransactionValidityError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier hs-type">ScriptExecutionError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#EvalTxExecutionUnitsLog"><span class="hs-identifier hs-type">EvalTxExecutionUnitsLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ExecutionUnits"><span class="hs-identifier hs-type">ExecutionUnits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span id="evaluateTransactionExecutionUnitsShelley"><span class="annot"><span class="annottext">evaluateTransactionExecutionUnitsShelley :: forall era.
ShelleyBasedEra era
-&gt; SystemStart
-&gt; LedgerEpochInfo
-&gt; LedgerProtocolParameters era
-&gt; UTxO era
-&gt; Tx (ShelleyLedgerEra era)
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
</span><a href="Cardano.Api.Fees.html#evaluateTransactionExecutionUnitsShelley"><span class="hs-identifier hs-var hs-var">evaluateTransactionExecutionUnitsShelley</span></a></span></span><span> </span><span id="local-6989586621681701987"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701987"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681701988"><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621681701988"><span class="hs-identifier hs-var">systemstart</span></a></span></span><span> </span><span id="local-6989586621681701989"><span class="annot"><span class="annottext">LedgerEpochInfo
</span><a href="#local-6989586621681701989"><span class="hs-identifier hs-var">epochInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.ProtocolParameters.html#LedgerProtocolParameters"><span class="hs-identifier hs-type">LedgerProtocolParameters</span></a></span><span> </span><span id="local-6989586621681701990"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701990"><span class="hs-identifier hs-var">pp</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681701991"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681701991"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621681701992"><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701992"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-702"></span><span>  </span><span class="annot"><span class="annottext">(ShelleyToMaryEraConstraints era =&gt;
 ShelleyToMaryEra era
 -&gt; Either
      (TransactionValidityError era)
      (Map
         ScriptWitnessIndex
         (Either ScriptExecutionError ([Text], ExecutionUnits))))
-&gt; (AlonzoEraOnwardsConstraints era =&gt;
    AlonzoEraOnwards era
    -&gt; Either
         (TransactionValidityError era)
         (Map
            ScriptWitnessIndex
            (Either ScriptExecutionError ([Text], ExecutionUnits))))
-&gt; ShelleyBasedEra era
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall era a.
(ShelleyToMaryEraConstraints era =&gt; ShelleyToMaryEra era -&gt; a)
-&gt; (AlonzoEraOnwardsConstraints era =&gt; AlonzoEraOnwards era -&gt; a)
-&gt; ShelleyBasedEra era
-&gt; a
</span><a href="Cardano.Api.Eras.Case.html#caseShelleyToMaryOrAlonzoEraOnwards"><span class="hs-identifier hs-var">caseShelleyToMaryOrAlonzoEraOnwards</span></a></span><span>
</span><span id="line-703"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either
  (TransactionValidityError era)
  (Map
     ScriptWitnessIndex
     (Either ScriptExecutionError ([Text], ExecutionUnits)))
-&gt; ShelleyToMaryEra era
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map
  ScriptWitnessIndex
  (Either ScriptExecutionError ([Text], ExecutionUnits))
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  ScriptWitnessIndex
  (Either ScriptExecutionError ([Text], ExecutionUnits))
forall k a. Map k a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681702007"><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621681702007"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-705"></span><span>        </span><span class="annot"><span class="annottext">Map
  ScriptWitnessIndex
  (Either ScriptExecutionError ([Text], ExecutionUnits))
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall a. a -&gt; Either (TransactionValidityError era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Map
   ScriptWitnessIndex
   (Either ScriptExecutionError ([Text], ExecutionUnits))
 -&gt; Either
      (TransactionValidityError era)
      (Map
         ScriptWitnessIndex
         (Either ScriptExecutionError ([Text], ExecutionUnits))))
-&gt; (Map
      (PlutusPurpose AsIx (ShelleyLedgerEra era))
      (Either
         (TransactionScriptFailure (ShelleyLedgerEra era))
         ([Text], ExUnits))
    -&gt; Map
         ScriptWitnessIndex
         (Either ScriptExecutionError ([Text], ExecutionUnits)))
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (Either
        (TransactionScriptFailure (ShelleyLedgerEra era))
        ([Text], ExUnits))
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraScript (ShelleyLedgerEra era) =&gt;
AlonzoEraOnwards era
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (Either
        (TransactionScriptFailure (ShelleyLedgerEra era))
        ([Text], ExUnits))
-&gt; Map
     ScriptWitnessIndex
     (Either ScriptExecutionError ([Text], ExecutionUnits))
AlonzoEraOnwards era
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (Either
        (TransactionScriptFailure (ShelleyLedgerEra era))
        ([Text], ExUnits))
-&gt; Map
     ScriptWitnessIndex
     (Either ScriptExecutionError ([Text], ExecutionUnits))
</span><a href="#local-6989586621681702008"><span class="hs-identifier hs-var">fromLedgerScriptExUnitsMap</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621681702007"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(Map
   (PlutusPurpose AsIx (ShelleyLedgerEra era))
   (Either
      (TransactionScriptFailure (ShelleyLedgerEra era))
      ([Text], ExUnits))
 -&gt; Either
      (TransactionValidityError era)
      (Map
         ScriptWitnessIndex
         (Either ScriptExecutionError ([Text], ExecutionUnits))))
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (Either
        (TransactionScriptFailure (ShelleyLedgerEra era))
        ([Text], ExUnits))
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-706"></span><span>          </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
-&gt; (AlonzoEraOnwardsConstraints era =&gt;
    Map
      (PlutusPurpose AsIx (ShelleyLedgerEra era))
      (Either
         (TransactionScriptFailure (ShelleyLedgerEra era))
         ([Text], ExUnits)))
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (Either
        (TransactionScriptFailure (ShelleyLedgerEra era))
        ([Text], ExUnits))
forall era a.
AlonzoEraOnwards era -&gt; (AlonzoEraOnwardsConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.AlonzoEraOnwards.html#alonzoEraOnwardsConstraints"><span class="hs-identifier hs-var">alonzoEraOnwardsConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621681702007"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((AlonzoEraOnwardsConstraints era =&gt;
  Map
    (PlutusPurpose AsIx (ShelleyLedgerEra era))
    (Either
       (TransactionScriptFailure (ShelleyLedgerEra era))
       ([Text], ExUnits)))
 -&gt; Map
      (PlutusPurpose AsIx (ShelleyLedgerEra era))
      (Either
         (TransactionScriptFailure (ShelleyLedgerEra era))
         ([Text], ExUnits)))
-&gt; (AlonzoEraOnwardsConstraints era =&gt;
    Map
      (PlutusPurpose AsIx (ShelleyLedgerEra era))
      (Either
         (TransactionScriptFailure (ShelleyLedgerEra era))
         ([Text], ExUnits)))
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (Either
        (TransactionScriptFailure (ShelleyLedgerEra era))
        ([Text], ExUnits))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-707"></span><span>            </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
-&gt; Tx (ShelleyLedgerEra era)
-&gt; UTxO (ShelleyLedgerEra era)
-&gt; EpochInfo (Either Text)
-&gt; SystemStart
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (Either
        (TransactionScriptFailure (ShelleyLedgerEra era))
        ([Text], ExUnits))
forall era.
(AlonzoEraTx era, EraUTxO era, EraPlutusContext era,
 ScriptsNeeded era ~ AlonzoScriptsNeeded era) =&gt;
PParams era
-&gt; Tx era
-&gt; UTxO era
-&gt; EpochInfo (Either Text)
-&gt; SystemStart
-&gt; RedeemerReportWithLogs era
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#evalTxExUnitsWithLogs"><span class="hs-identifier hs-var">L.evalTxExUnitsWithLogs</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701990"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681701992"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; UTxO era -&gt; UTxO (ShelleyLedgerEra era)
forall era.
ShelleyBasedEra era -&gt; UTxO era -&gt; UTxO (ShelleyLedgerEra era)
</span><a href="Cardano.Api.Query.html#toLedgerUTxO"><span class="hs-identifier hs-var">toLedgerUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701987"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681701991"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EpochInfo (Either Text)
</span><a href="#local-6989586621681702016"><span class="hs-identifier hs-var">ledgerEpochInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621681701988"><span class="hs-identifier hs-var">systemstart</span></a></span><span>
</span><span id="line-708"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>    </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701987"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-710"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-711"></span><span>  </span><span class="annot"><a href="Cardano.Api.Query.html#LedgerEpochInfo"><span class="hs-identifier hs-type">LedgerEpochInfo</span></a></span><span> </span><span id="local-6989586621681702016"><span class="annot"><span class="annottext">EpochInfo (Either Text)
</span><a href="#local-6989586621681702016"><span class="hs-identifier hs-var">ledgerEpochInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerEpochInfo
</span><a href="#local-6989586621681701989"><span class="hs-identifier hs-var">epochInfo</span></a></span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span>  </span><span class="annot"><a href="#local-6989586621681702008"><span class="hs-identifier hs-type">fromLedgerScriptExUnitsMap</span></a></span><span>
</span><span id="line-714"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AlonzoEraScript"><span class="hs-identifier hs-type">Alonzo.AlonzoEraScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.AlonzoEraOnwards.html#AlonzoEraOnwards"><span class="hs-identifier hs-type">AlonzoEraOnwards</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span>
</span><span id="line-717"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#PlutusPurpose"><span class="hs-identifier hs-type">L.PlutusPurpose</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AsIx"><span class="hs-identifier hs-type">L.AsIx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#TransactionScriptFailure"><span class="hs-identifier hs-type">L.TransactionScriptFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#EvalTxExecutionUnitsLog"><span class="hs-identifier hs-type">EvalTxExecutionUnitsLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Plutus.ExUnits.html#ExUnits"><span class="hs-identifier hs-type">Alonzo.ExUnits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier hs-type">ScriptExecutionError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#EvalTxExecutionUnitsLog"><span class="hs-identifier hs-type">EvalTxExecutionUnitsLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ExecutionUnits"><span class="hs-identifier hs-type">ExecutionUnits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>  </span><span id="local-6989586621681702008"><span class="annot"><span class="annottext">fromLedgerScriptExUnitsMap :: AlonzoEraScript (ShelleyLedgerEra era) =&gt;
AlonzoEraOnwards era
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (Either
        (TransactionScriptFailure (ShelleyLedgerEra era))
        ([Text], ExUnits))
-&gt; Map
     ScriptWitnessIndex
     (Either ScriptExecutionError ([Text], ExecutionUnits))
</span><a href="#local-6989586621681702008"><span class="hs-identifier hs-var hs-var">fromLedgerScriptExUnitsMap</span></a></span></span><span> </span><span id="local-6989586621681702030"><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621681702030"><span class="hs-identifier hs-var">aOnwards</span></a></span></span><span> </span><span id="local-6989586621681702031"><span class="annot"><span class="annottext">Map
  (PlutusPurpose AsIx (ShelleyLedgerEra era))
  (Either
     (TransactionScriptFailure (ShelleyLedgerEra era))
     ([Text], ExUnits))
</span><a href="#local-6989586621681702031"><span class="hs-identifier hs-var">exmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-721"></span><span>    </span><span class="annot"><span class="annottext">[Item
   (Map
      ScriptWitnessIndex
      (Either ScriptExecutionError ([Text], ExecutionUnits)))]
-&gt; Map
     ScriptWitnessIndex
     (Either ScriptExecutionError ([Text], ExecutionUnits))
forall l. IsList l =&gt; [Item l] -&gt; l
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span>
</span><span id="line-722"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
-&gt; PlutusPurpose AsIx (ShelleyLedgerEra era) -&gt; ScriptWitnessIndex
forall era.
AlonzoEraOnwards era
-&gt; PlutusPurpose AsIx (ShelleyLedgerEra era) -&gt; ScriptWitnessIndex
</span><a href="Cardano.Api.Tx.Body.html#toScriptIndex"><span class="hs-identifier hs-var">toScriptIndex</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621681702030"><span class="hs-identifier hs-var">aOnwards</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusPurpose AsIx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702033"><span class="hs-identifier hs-var">rdmrptr</span></a></span><span>
</span><span id="line-723"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TransactionScriptFailure (ShelleyLedgerEra era)
 -&gt; ScriptExecutionError)
-&gt; (([Text], ExUnits) -&gt; ([Text], ExecutionUnits))
-&gt; Either
     (TransactionScriptFailure (ShelleyLedgerEra era)) ([Text], ExUnits)
-&gt; Either ScriptExecutionError ([Text], ExecutionUnits)
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Either a c -&gt; Either b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#bimap"><span class="hs-identifier hs-var">bimap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlonzoEraScript (ShelleyLedgerEra era) =&gt;
AlonzoEraOnwards era
-&gt; TransactionScriptFailure (ShelleyLedgerEra era)
-&gt; ScriptExecutionError
AlonzoEraOnwards era
-&gt; TransactionScriptFailure (ShelleyLedgerEra era)
-&gt; ScriptExecutionError
</span><a href="#local-6989586621681702034"><span class="hs-identifier hs-var">fromAlonzoScriptExecutionError</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621681702030"><span class="hs-identifier hs-var">aOnwards</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ExUnits -&gt; ExecutionUnits)
-&gt; ([Text], ExUnits) -&gt; ([Text], ExecutionUnits)
forall b c a. (b -&gt; c) -&gt; (a, b) -&gt; (a, c)
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#second"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="annot"><span class="annottext">ExUnits -&gt; ExecutionUnits
</span><a href="Cardano.Api.Script.html#fromAlonzoExUnits"><span class="hs-identifier hs-var">fromAlonzoExUnits</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either
  (TransactionScriptFailure (ShelleyLedgerEra era)) ([Text], ExUnits)
</span><a href="#local-6989586621681702036"><span class="hs-identifier hs-var">exunitsOrFailure</span></a></span><span>
</span><span id="line-724"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681702033"><span class="annot"><span class="annottext">PlutusPurpose AsIx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702033"><span class="hs-identifier hs-var">rdmrptr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702036"><span class="annot"><span class="annottext">Either
  (TransactionScriptFailure (ShelleyLedgerEra era)) ([Text], ExUnits)
</span><a href="#local-6989586621681702036"><span class="hs-identifier hs-var">exunitsOrFailure</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map
  (PlutusPurpose AsIx (ShelleyLedgerEra era))
  (Either
     (TransactionScriptFailure (ShelleyLedgerEra era))
     ([Text], ExUnits))
-&gt; [Item
      (Map
         (PlutusPurpose AsIx (ShelleyLedgerEra era))
         (Either
            (TransactionScriptFailure (ShelleyLedgerEra era))
            ([Text], ExUnits)))]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  (PlutusPurpose AsIx (ShelleyLedgerEra era))
  (Either
     (TransactionScriptFailure (ShelleyLedgerEra era))
     ([Text], ExUnits))
</span><a href="#local-6989586621681702031"><span class="hs-identifier hs-var">exmap</span></a></span><span>
</span><span id="line-726"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span>  </span><span class="annot"><a href="#local-6989586621681702034"><span class="hs-identifier hs-type">fromAlonzoScriptExecutionError</span></a></span><span>
</span><span id="line-729"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AlonzoEraScript"><span class="hs-identifier hs-type">Alonzo.AlonzoEraScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.AlonzoEraOnwards.html#AlonzoEraOnwards"><span class="hs-identifier hs-type">AlonzoEraOnwards</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-731"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#TransactionScriptFailure"><span class="hs-identifier hs-type">L.TransactionScriptFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701047"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier hs-type">ScriptExecutionError</span></a></span><span>
</span><span id="line-733"></span><span>  </span><span id="local-6989586621681702034"><span class="annot"><span class="annottext">fromAlonzoScriptExecutionError :: AlonzoEraScript (ShelleyLedgerEra era) =&gt;
AlonzoEraOnwards era
-&gt; TransactionScriptFailure (ShelleyLedgerEra era)
-&gt; ScriptExecutionError
</span><a href="#local-6989586621681702034"><span class="hs-identifier hs-var hs-var">fromAlonzoScriptExecutionError</span></a></span></span><span> </span><span id="local-6989586621681702048"><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621681702048"><span class="hs-identifier hs-var">aOnwards</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-734"></span><span>    </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; (ShelleyBasedEraConstraints era =&gt;
    TransactionScriptFailure (ShelleyLedgerEra era)
    -&gt; ScriptExecutionError)
-&gt; TransactionScriptFailure (ShelleyLedgerEra era)
-&gt; ScriptExecutionError
forall era a.
ShelleyBasedEra era -&gt; (ShelleyBasedEraConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#shelleyBasedEraConstraints"><span class="hs-identifier hs-var">shelleyBasedEraConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701987"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyBasedEraConstraints era =&gt;
  TransactionScriptFailure (ShelleyLedgerEra era)
  -&gt; ScriptExecutionError)
 -&gt; TransactionScriptFailure (ShelleyLedgerEra era)
 -&gt; ScriptExecutionError)
-&gt; (ShelleyBasedEraConstraints era =&gt;
    TransactionScriptFailure (ShelleyLedgerEra era)
    -&gt; ScriptExecutionError)
-&gt; TransactionScriptFailure (ShelleyLedgerEra era)
-&gt; ScriptExecutionError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-735"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#UnknownTxIn"><span class="hs-identifier hs-type">L.UnknownTxIn</span></a></span><span> </span><span id="local-6989586621681702068"><span class="annot"><span class="annottext">TxIn (EraCrypto (ShelleyLedgerEra era))
</span><a href="#local-6989586621681702068"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; ScriptExecutionError
</span><a href="Cardano.Api.Fees.html#ScriptErrorMissingTxIn"><span class="hs-identifier hs-var">ScriptErrorMissingTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681702069"><span class="hs-identifier hs-var">txin'</span></a></span><span>
</span><span id="line-736"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-737"></span><span>        </span><span id="local-6989586621681702069"><span class="annot"><span class="annottext">txin' :: TxIn
</span><a href="#local-6989586621681702069"><span class="hs-identifier hs-var hs-var">txin'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn StandardCrypto -&gt; TxIn
</span><a href="Cardano.Api.TxIn.html#fromShelleyTxIn"><span class="hs-identifier hs-var">fromShelleyTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn (EraCrypto (ShelleyLedgerEra era))
TxIn StandardCrypto
</span><a href="#local-6989586621681702068"><span class="hs-identifier hs-var">txin</span></a></span><span>
</span><span id="line-738"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#InvalidTxIn"><span class="hs-identifier hs-type">L.InvalidTxIn</span></a></span><span> </span><span id="local-6989586621681702072"><span class="annot"><span class="annottext">TxIn (EraCrypto (ShelleyLedgerEra era))
</span><a href="#local-6989586621681702072"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; ScriptExecutionError
</span><a href="Cardano.Api.Fees.html#ScriptErrorTxInWithoutDatum"><span class="hs-identifier hs-var">ScriptErrorTxInWithoutDatum</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681702073"><span class="hs-identifier hs-var">txin'</span></a></span><span>
</span><span id="line-739"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-740"></span><span>        </span><span id="local-6989586621681702073"><span class="annot"><span class="annottext">txin' :: TxIn
</span><a href="#local-6989586621681702073"><span class="hs-identifier hs-var hs-var">txin'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn StandardCrypto -&gt; TxIn
</span><a href="Cardano.Api.TxIn.html#fromShelleyTxIn"><span class="hs-identifier hs-var">fromShelleyTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn (EraCrypto (ShelleyLedgerEra era))
TxIn StandardCrypto
</span><a href="#local-6989586621681702072"><span class="hs-identifier hs-var">txin</span></a></span><span>
</span><span id="line-741"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#MissingDatum"><span class="hs-identifier hs-type">L.MissingDatum</span></a></span><span> </span><span id="local-6989586621681702075"><span class="annot"><span class="annottext">DataHash (EraCrypto (ShelleyLedgerEra era))
</span><a href="#local-6989586621681702075"><span class="hs-identifier hs-var">dh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hash ScriptData -&gt; ScriptExecutionError
</span><a href="Cardano.Api.Fees.html#ScriptErrorWrongDatum"><span class="hs-identifier hs-var">ScriptErrorWrongDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataHash StandardCrypto -&gt; Hash ScriptData
</span><a href="Cardano.Api.ScriptData.html#ScriptDataHash"><span class="hs-identifier hs-var">ScriptDataHash</span></a></span><span> </span><span class="annot"><span class="annottext">DataHash (EraCrypto (ShelleyLedgerEra era))
DataHash StandardCrypto
</span><a href="#local-6989586621681702075"><span class="hs-identifier hs-var">dh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#ValidationFailure"><span class="hs-identifier hs-type">L.ValidationFailure</span></a></span><span> </span><span class="annot"><span class="annottext">ExUnits
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681702078"><span class="annot"><span class="annottext">EvaluationError
</span><a href="#local-6989586621681702078"><span class="hs-identifier hs-var">evalErr</span></a></span></span><span> </span><span id="local-6989586621681702079"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621681702079"><span class="hs-identifier hs-var">logs</span></a></span></span><span> </span><span class="annot"><span class="annottext">PlutusWithContext (EraCrypto (ShelleyLedgerEra era))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-743"></span><span>        </span><span class="hs-comment">-- TODO: Include additional information from ValidationFailure</span><span>
</span><span id="line-744"></span><span>        </span><span class="annot"><span class="annottext">EvaluationError -&gt; [Text] -&gt; ScriptExecutionError
</span><a href="Cardano.Api.Fees.html#ScriptErrorEvaluationFailed"><span class="hs-identifier hs-var">ScriptErrorEvaluationFailed</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationError
</span><a href="#local-6989586621681702078"><span class="hs-identifier hs-var">evalErr</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621681702079"><span class="hs-identifier hs-var">logs</span></a></span><span>
</span><span id="line-745"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#IncompatibleBudget"><span class="hs-identifier hs-type">L.IncompatibleBudget</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudget
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptExecutionError
</span><a href="Cardano.Api.Fees.html#ScriptErrorExecutionUnitsOverflow"><span class="hs-identifier hs-var">ScriptErrorExecutionUnitsOverflow</span></a></span><span>
</span><span id="line-746"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#RedeemerPointsToUnknownScriptHash"><span class="hs-identifier hs-type">L.RedeemerPointsToUnknownScriptHash</span></a></span><span> </span><span id="local-6989586621681702082"><span class="annot"><span class="annottext">PlutusPurpose AsIx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702082"><span class="hs-identifier hs-var">rdmrPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-747"></span><span>        </span><span class="annot"><span class="annottext">ScriptWitnessIndex -&gt; ScriptExecutionError
</span><a href="Cardano.Api.Fees.html#ScriptErrorRedeemerPointsToUnknownScriptHash"><span class="hs-identifier hs-var">ScriptErrorRedeemerPointsToUnknownScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptWitnessIndex -&gt; ScriptExecutionError)
-&gt; ScriptWitnessIndex -&gt; ScriptExecutionError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
-&gt; PlutusPurpose AsIx (ShelleyLedgerEra era) -&gt; ScriptWitnessIndex
forall era.
AlonzoEraOnwards era
-&gt; PlutusPurpose AsIx (ShelleyLedgerEra era) -&gt; ScriptWitnessIndex
</span><a href="Cardano.Api.Tx.Body.html#toScriptIndex"><span class="hs-identifier hs-var">toScriptIndex</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621681702048"><span class="hs-identifier hs-var">aOnwards</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusPurpose AsIx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702082"><span class="hs-identifier hs-var">rdmrPtr</span></a></span><span>
</span><span id="line-748"></span><span>      </span><span class="hs-comment">-- This should not occur while using cardano-cli because we zip together</span><span>
</span><span id="line-749"></span><span>      </span><span class="hs-comment">-- the Plutus script and the use site (txin, certificate etc). Therefore</span><span>
</span><span id="line-750"></span><span>      </span><span class="hs-comment">-- the redeemer pointer will always point to a Plutus script.</span><span>
</span><span id="line-751"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#MissingScript"><span class="hs-identifier hs-type">L.MissingScript</span></a></span><span> </span><span id="local-6989586621681702084"><span class="annot"><span class="annottext">PlutusPurpose AsIx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702084"><span class="hs-identifier hs-var">indexOfScriptWitnessedItem</span></a></span></span><span> </span><span id="local-6989586621681702085"><span class="annot"><span class="annottext">Map
  (PlutusPurpose AsIx (ShelleyLedgerEra era))
  (PlutusPurpose AsItem (ShelleyLedgerEra era),
   Maybe (PlutusScript (ShelleyLedgerEra era)),
   ScriptHash (EraCrypto (ShelleyLedgerEra era)))
</span><a href="#local-6989586621681702085"><span class="hs-identifier hs-var">resolveable</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-752"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702086"><span class="annot"><span class="annottext">scriptWitnessedItemIndex :: ScriptWitnessIndex
</span><a href="#local-6989586621681702086"><span class="hs-identifier hs-var hs-var">scriptWitnessedItemIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
-&gt; PlutusPurpose AsIx (ShelleyLedgerEra era) -&gt; ScriptWitnessIndex
forall era.
AlonzoEraOnwards era
-&gt; PlutusPurpose AsIx (ShelleyLedgerEra era) -&gt; ScriptWitnessIndex
</span><a href="Cardano.Api.Tx.Body.html#toScriptIndex"><span class="hs-identifier hs-var">toScriptIndex</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621681702048"><span class="hs-identifier hs-var">aOnwards</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusPurpose AsIx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702084"><span class="hs-identifier hs-var">indexOfScriptWitnessedItem</span></a></span><span>
</span><span id="line-753"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex -&gt; ResolvablePointers -&gt; ScriptExecutionError
</span><a href="Cardano.Api.Fees.html#ScriptErrorMissingScript"><span class="hs-identifier hs-var">ScriptErrorMissingScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681702086"><span class="hs-identifier hs-var">scriptWitnessedItemIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(ResolvablePointers -&gt; ScriptExecutionError)
-&gt; ResolvablePointers -&gt; ScriptExecutionError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-754"></span><span>              </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (PlutusPurpose AsItem (ShelleyLedgerEra era),
      Maybe (PlutusScriptBytes, Language), ScriptHash StandardCrypto)
-&gt; ResolvablePointers
forall era.
(Era (ShelleyLedgerEra era),
 Show (PlutusPurpose AsIx (ShelleyLedgerEra era)),
 Show (PlutusPurpose AsItem (ShelleyLedgerEra era)),
 Show (PlutusScript (ShelleyLedgerEra era))) =&gt;
ShelleyBasedEra era
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (PlutusPurpose AsItem (ShelleyLedgerEra era),
      Maybe (PlutusScriptBytes, Language), ScriptHash StandardCrypto)
-&gt; ResolvablePointers
</span><a href="Cardano.Api.Fees.html#ResolvablePointers"><span class="hs-identifier hs-var">ResolvablePointers</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681701987"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">(Map
   (PlutusPurpose AsIx (ShelleyLedgerEra era))
   (PlutusPurpose AsItem (ShelleyLedgerEra era),
    Maybe (PlutusScriptBytes, Language), ScriptHash StandardCrypto)
 -&gt; ResolvablePointers)
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (PlutusPurpose AsItem (ShelleyLedgerEra era),
      Maybe (PlutusScriptBytes, Language), ScriptHash StandardCrypto)
-&gt; ResolvablePointers
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-755"></span><span>                </span><span class="annot"><span class="annottext">((PlutusPurpose AsItem (ShelleyLedgerEra era),
  Maybe (PlutusScript (ShelleyLedgerEra era)),
  ScriptHash StandardCrypto)
 -&gt; (PlutusPurpose AsItem (ShelleyLedgerEra era),
     Maybe (PlutusScriptBytes, Language), ScriptHash StandardCrypto))
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (PlutusPurpose AsItem (ShelleyLedgerEra era),
      Maybe (PlutusScript (ShelleyLedgerEra era)),
      ScriptHash StandardCrypto)
-&gt; Map
     (PlutusPurpose AsIx (ShelleyLedgerEra era))
     (PlutusPurpose AsItem (ShelleyLedgerEra era),
      Maybe (PlutusScriptBytes, Language), ScriptHash StandardCrypto)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Strict.Internal.html#map"><span class="hs-identifier hs-var">Map.map</span></a></span><span> </span><span class="annot"><span class="annottext">(PlutusPurpose AsItem (ShelleyLedgerEra era),
 Maybe (PlutusScript (ShelleyLedgerEra era)),
 ScriptHash StandardCrypto)
-&gt; (PlutusPurpose AsItem (ShelleyLedgerEra era),
    Maybe (PlutusScriptBytes, Language), ScriptHash StandardCrypto)
forall era.
AlonzoEraScript (ShelleyLedgerEra era) =&gt;
(PlutusPurpose AsItem (ShelleyLedgerEra era),
 Maybe (PlutusScript (ShelleyLedgerEra era)),
 ScriptHash StandardCrypto)
-&gt; (PlutusPurpose AsItem (ShelleyLedgerEra era),
    Maybe (PlutusScriptBytes, Language), ScriptHash StandardCrypto)
</span><a href="Cardano.Api.Fees.html#extractScriptBytesAndLanguage"><span class="hs-identifier hs-var">extractScriptBytesAndLanguage</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  (PlutusPurpose AsIx (ShelleyLedgerEra era))
  (PlutusPurpose AsItem (ShelleyLedgerEra era),
   Maybe (PlutusScript (ShelleyLedgerEra era)),
   ScriptHash (EraCrypto (ShelleyLedgerEra era)))
Map
  (PlutusPurpose AsIx (ShelleyLedgerEra era))
  (PlutusPurpose AsItem (ShelleyLedgerEra era),
   Maybe (PlutusScript (ShelleyLedgerEra era)),
   ScriptHash StandardCrypto)
</span><a href="#local-6989586621681702085"><span class="hs-identifier hs-var">resolveable</span></a></span><span>
</span><span id="line-756"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#NoCostModelInLedgerState"><span class="hs-identifier hs-type">L.NoCostModelInLedgerState</span></a></span><span> </span><span id="local-6989586621681702090"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621681702090"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Language -&gt; ScriptExecutionError
</span><a href="Cardano.Api.Fees.html#ScriptErrorMissingCostModel"><span class="hs-identifier hs-var">ScriptErrorMissingCostModel</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621681702090"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-757"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Plutus.Evaluate.html#ContextError"><span class="hs-identifier hs-type">L.ContextError</span></a></span><span> </span><span id="local-6989586621681702092"><span class="annot"><span class="annottext">ContextError (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702092"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-758"></span><span>        </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
-&gt; (AlonzoEraOnwardsConstraints era =&gt; ScriptExecutionError)
-&gt; ScriptExecutionError
forall era a.
AlonzoEraOnwards era -&gt; (AlonzoEraOnwardsConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.AlonzoEraOnwards.html#alonzoEraOnwardsConstraints"><span class="hs-identifier hs-var">alonzoEraOnwardsConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621681702048"><span class="hs-identifier hs-var">aOnwards</span></a></span><span> </span><span class="annot"><span class="annottext">((AlonzoEraOnwardsConstraints era =&gt; ScriptExecutionError)
 -&gt; ScriptExecutionError)
-&gt; (AlonzoEraOnwardsConstraints era =&gt; ScriptExecutionError)
-&gt; ScriptExecutionError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-759"></span><span>          </span><span class="annot"><span class="annottext">ContextError (ShelleyLedgerEra era) -&gt; ScriptExecutionError
forall era.
(EraPlutusContext (ShelleyLedgerEra era),
 Show (ContextError (ShelleyLedgerEra era))) =&gt;
ContextError (ShelleyLedgerEra era) -&gt; ScriptExecutionError
</span><a href="Cardano.Api.Fees.html#ScriptErrorTranslationError"><span class="hs-identifier hs-var">ScriptErrorTranslationError</span></a></span><span> </span><span class="annot"><span class="annottext">ContextError (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702092"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span id="local-6989586621681701098"><span class="annot"><a href="Cardano.Api.Fees.html#extractScriptBytesAndLanguage"><span class="hs-identifier hs-type">extractScriptBytesAndLanguage</span></a></span><span>
</span><span id="line-762"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AlonzoEraScript"><span class="hs-identifier hs-type">Alonzo.AlonzoEraScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701098"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#PlutusPurpose"><span class="hs-identifier hs-type">L.PlutusPurpose</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AsItem"><span class="hs-identifier hs-type">L.AsItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701098"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#PlutusScript"><span class="hs-identifier hs-type">Alonzo.PlutusScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701098"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">L.ScriptHash</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">Ledger.StandardCrypto</span></a></span><span>
</span><span id="line-766"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#PlutusPurpose"><span class="hs-identifier hs-type">L.PlutusPurpose</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AsItem"><span class="hs-identifier hs-type">L.AsItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701098"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#PlutusScriptBytes"><span class="hs-identifier hs-type">PlutusScriptBytes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Plutus.Language.html#Language"><span class="hs-identifier hs-type">Plutus.Language</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">Ledger.ScriptHash</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">Ledger.StandardCrypto</span></a></span><span>
</span><span id="line-770"></span><span>     </span><span class="hs-special">)</span></span><span>
</span><span id="line-771"></span><span id="extractScriptBytesAndLanguage"><span class="annot"><span class="annottext">extractScriptBytesAndLanguage :: forall era.
AlonzoEraScript (ShelleyLedgerEra era) =&gt;
(PlutusPurpose AsItem (ShelleyLedgerEra era),
 Maybe (PlutusScript (ShelleyLedgerEra era)),
 ScriptHash StandardCrypto)
-&gt; (PlutusPurpose AsItem (ShelleyLedgerEra era),
    Maybe (PlutusScriptBytes, Language), ScriptHash StandardCrypto)
</span><a href="Cardano.Api.Fees.html#extractScriptBytesAndLanguage"><span class="hs-identifier hs-var hs-var">extractScriptBytesAndLanguage</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681702104"><span class="annot"><span class="annottext">PlutusPurpose AsItem (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702104"><span class="hs-identifier hs-var">purpose</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702105"><span class="annot"><span class="annottext">Maybe (PlutusScript (ShelleyLedgerEra era))
</span><a href="#local-6989586621681702105"><span class="hs-identifier hs-var">mbScript</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702106"><span class="annot"><span class="annottext">ScriptHash StandardCrypto
</span><a href="#local-6989586621681702106"><span class="hs-identifier hs-var">scriptHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlutusPurpose AsItem (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702104"><span class="hs-identifier hs-var">purpose</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(PlutusScript (ShelleyLedgerEra era)
 -&gt; (PlutusScriptBytes, Language))
-&gt; Maybe (PlutusScript (ShelleyLedgerEra era))
-&gt; Maybe (PlutusScriptBytes, Language)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript (ShelleyLedgerEra era)
-&gt; (PlutusScriptBytes, Language)
forall era.
AlonzoEraScript (ShelleyLedgerEra era) =&gt;
PlutusScript (ShelleyLedgerEra era)
-&gt; (PlutusScriptBytes, Language)
</span><a href="Cardano.Api.Fees.html#extractPlutusScriptAndLanguage"><span class="hs-identifier hs-var">extractPlutusScriptAndLanguage</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (PlutusScript (ShelleyLedgerEra era))
</span><a href="#local-6989586621681702105"><span class="hs-identifier hs-var">mbScript</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptHash StandardCrypto
</span><a href="#local-6989586621681702106"><span class="hs-identifier hs-var">scriptHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span id="local-6989586621681701126"><span class="annot"><a href="Cardano.Api.Fees.html#extractPlutusScriptAndLanguage"><span class="hs-identifier hs-type">extractPlutusScriptAndLanguage</span></a></span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#AlonzoEraScript"><span class="hs-identifier hs-type">Alonzo.AlonzoEraScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701126"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-776"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#PlutusScript"><span class="hs-identifier hs-type">Alonzo.PlutusScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701126"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#PlutusScriptBytes"><span class="hs-identifier hs-type">PlutusScriptBytes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Plutus.Language.html#Language"><span class="hs-identifier hs-type">Plutus.Language</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-778"></span><span id="extractPlutusScriptAndLanguage"><span class="annot"><span class="annottext">extractPlutusScriptAndLanguage :: forall era.
AlonzoEraScript (ShelleyLedgerEra era) =&gt;
PlutusScript (ShelleyLedgerEra era)
-&gt; (PlutusScriptBytes, Language)
</span><a href="Cardano.Api.Fees.html#extractPlutusScriptAndLanguage"><span class="hs-identifier hs-var hs-var">extractPlutusScriptAndLanguage</span></a></span></span><span> </span><span id="local-6989586621681702111"><span class="annot"><span class="annottext">PlutusScript (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702111"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702112"><span class="annot"><span class="annottext">bin :: PlutusScriptBytes
</span><a href="#local-6989586621681702112"><span class="hs-identifier hs-var hs-var">bin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlutusBinary -&gt; PlutusScriptBytes
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Plutus.Language.html#unPlutusBinary"><span class="hs-identifier hs-var">Plutus.unPlutusBinary</span></a></span><span> </span><span class="annot"><span class="annottext">(PlutusBinary -&gt; PlutusScriptBytes)
-&gt; PlutusBinary -&gt; PlutusScriptBytes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript (ShelleyLedgerEra era) -&gt; PlutusBinary
forall era. AlonzoEraScript era =&gt; PlutusScript era -&gt; PlutusBinary
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#plutusScriptBinary"><span class="hs-identifier hs-var">Alonzo.plutusScriptBinary</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702111"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-780"></span><span>      </span><span id="local-6989586621681702115"><span class="annot"><span class="annottext">l :: Language
</span><a href="#local-6989586621681702115"><span class="hs-identifier hs-var hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlutusScript (ShelleyLedgerEra era) -&gt; Language
forall era. AlonzoEraScript era =&gt; PlutusScript era -&gt; Language
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.Scripts.html#plutusScriptLanguage"><span class="hs-identifier hs-var">Alonzo.plutusScriptLanguage</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702111"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-781"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlutusScriptBytes
</span><a href="#local-6989586621681702112"><span class="hs-identifier hs-var">bin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621681702115"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-784"></span><span class="hs-comment">-- Transaction balance</span><span>
</span><span id="line-785"></span><span class="hs-comment">--</span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span class="hs-comment">-- | Compute the total balance of the proposed transaction. Ultimately a valid</span><span>
</span><span id="line-788"></span><span class="hs-comment">-- transaction must be fully balanced: that is have a total value of zero.</span><span>
</span><span id="line-789"></span><span class="hs-comment">--</span><span>
</span><span id="line-790"></span><span class="hs-comment">-- Finding the (non-zero) balance of partially constructed transaction is</span><span>
</span><span id="line-791"></span><span class="hs-comment">-- useful for adjusting a transaction to be fully balanced.</span><span>
</span><span id="line-792"></span><span class="annot"><a href="Cardano.Api.Fees.html#evaluateTransactionBalance"><span class="hs-identifier hs-type">evaluateTransactionBalance</span></a></span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681700953"><span class="annot"><a href="#local-6989586621681700953"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-794"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700953"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">Ledger.PParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700953"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Certificate.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#StakeCredential"><span class="hs-identifier hs-type">StakeCredential</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-799"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Ledger.Credential</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Keys.Internal.html#DRepRole"><span class="hs-identifier hs-type">Ledger.DRepRole</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">Ledger.StandardCrypto</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-800"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Query.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700953"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Sign.html#TxBody"><span class="hs-identifier hs-type">TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700953"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-802"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutValue"><span class="hs-identifier hs-type">TxOutValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700953"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-803"></span><span id="evaluateTransactionBalance"><span class="annot"><span class="annottext">evaluateTransactionBalance :: forall era.
ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Set (Hash StakePoolKey)
-&gt; Map StakeCredential Coin
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; UTxO era
-&gt; TxBody era
-&gt; TxOutValue era
</span><a href="Cardano.Api.Fees.html#evaluateTransactionBalance"><span class="hs-identifier hs-var hs-var">evaluateTransactionBalance</span></a></span></span><span> </span><span id="local-6989586621681702117"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702117"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681702118"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702118"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621681702119"><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681702119"><span class="hs-identifier hs-var">poolids</span></a></span></span><span> </span><span id="local-6989586621681702120"><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681702120"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span></span><span> </span><span id="local-6989586621681702121"><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681702121"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span></span><span> </span><span id="local-6989586621681702122"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681702122"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Sign.html#ShelleyTxBody"><span class="hs-identifier hs-type">ShelleyTxBody</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681702124"><span class="annot"><span class="annottext">TxBody (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702124"><span class="hs-identifier hs-var">txbody</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Script (ShelleyLedgerEra era)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxBodyScriptData era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TxAuxData (ShelleyLedgerEra era))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-804"></span><span>  </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; (ShelleyBasedEraConstraints era =&gt; TxOutValue era)
-&gt; TxOutValue era
forall era a.
ShelleyBasedEra era -&gt; (ShelleyBasedEraConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#shelleyBasedEraConstraints"><span class="hs-identifier hs-var">shelleyBasedEraConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702117"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyBasedEraConstraints era =&gt; TxOutValue era)
 -&gt; TxOutValue era)
-&gt; (ShelleyBasedEraConstraints era =&gt; TxOutValue era)
-&gt; TxOutValue era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-805"></span><span>    </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
forall era.
(Eq (Value (ShelleyLedgerEra era)),
 Show (Value (ShelleyLedgerEra era))) =&gt;
ShelleyBasedEra era
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
</span><a href="Cardano.Api.Tx.Body.html#TxOutValueShelleyBased"><span class="hs-identifier hs-var">TxOutValueShelleyBased</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702117"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">(Value (ShelleyLedgerEra era) -&gt; TxOutValue era)
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-806"></span><span>      </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
-&gt; (Credential 'Staking (EraCrypto (ShelleyLedgerEra era))
    -&gt; Maybe Coin)
-&gt; (Credential 'DRepRole (EraCrypto (ShelleyLedgerEra era))
    -&gt; Maybe Coin)
-&gt; (KeyHash 'StakePool (EraCrypto (ShelleyLedgerEra era)) -&gt; Bool)
-&gt; UTxO (ShelleyLedgerEra era)
-&gt; TxBody (ShelleyLedgerEra era)
-&gt; Value (ShelleyLedgerEra era)
forall era.
EraUTxO era =&gt;
PParams era
-&gt; (Credential 'Staking (EraCrypto era) -&gt; Maybe Coin)
-&gt; (Credential 'DRepRole (EraCrypto era) -&gt; Maybe Coin)
-&gt; (KeyHash 'StakePool (EraCrypto era) -&gt; Bool)
-&gt; UTxO era
-&gt; TxBody era
-&gt; Value era
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-api-1.9.2.1-4844a0255d7b8fb2f0d16eaff712596a0ef2d0d592972f20c030f33c676c47ab/share/doc/html/src/Cardano.Ledger.Api.Tx.Body.html#evalBalanceTxBody"><span class="hs-identifier hs-var">L.evalBalanceTxBody</span></a></span><span>
</span><span id="line-807"></span><span>        </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702118"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-808"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map StakeCredential Coin
-&gt; Credential 'Staking StandardCrypto -&gt; Maybe Coin
</span><a href="Cardano.Api.Fees.html#lookupDelegDeposit"><span class="hs-identifier hs-var">lookupDelegDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681702120"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; Credential 'DRepRole StandardCrypto -&gt; Maybe Coin
</span><a href="Cardano.Api.Fees.html#lookupDRepDeposit"><span class="hs-identifier hs-var">lookupDRepDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681702121"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
-&gt; KeyHash 'StakePool StandardCrypto -&gt; Bool
</span><a href="Cardano.Api.Fees.html#isRegPool"><span class="hs-identifier hs-var">isRegPool</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681702119"><span class="hs-identifier hs-var">poolids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; UTxO era -&gt; UTxO (ShelleyLedgerEra era)
forall era.
ShelleyBasedEra era -&gt; UTxO era -&gt; UTxO (ShelleyLedgerEra era)
</span><a href="Cardano.Api.Query.html#toLedgerUTxO"><span class="hs-identifier hs-var">toLedgerUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702117"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681702122"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-812"></span><span>        </span><span class="annot"><span class="annottext">TxBody (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702124"><span class="hs-identifier hs-var">txbody</span></a></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="annot"><a href="Cardano.Api.Fees.html#isRegPool"><span class="hs-identifier hs-type">isRegPool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Certificate.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">Ledger.KeyHash</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">Ledger.StakePool</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">Ledger.StandardCrypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-815"></span><span id="isRegPool"><span class="annot"><span class="annottext">isRegPool :: Set (Hash StakePoolKey)
-&gt; KeyHash 'StakePool StandardCrypto -&gt; Bool
</span><a href="Cardano.Api.Fees.html#isRegPool"><span class="hs-identifier hs-var hs-var">isRegPool</span></a></span></span><span> </span><span id="local-6989586621681702145"><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681702145"><span class="hs-identifier hs-var">poolids</span></a></span></span><span> </span><span id="local-6989586621681702146"><span class="annot"><span class="annottext">KeyHash 'StakePool StandardCrypto
</span><a href="#local-6989586621681702146"><span class="hs-identifier hs-var">kh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool StandardCrypto -&gt; Hash StakePoolKey
</span><a href="Cardano.Api.Keys.Shelley.html#StakePoolKeyHash"><span class="hs-identifier hs-var">StakePoolKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool StandardCrypto
</span><a href="#local-6989586621681702146"><span class="hs-identifier hs-var">kh</span></a></span><span> </span><span class="annot"><span class="annottext">Hash StakePoolKey -&gt; Set (Hash StakePoolKey) -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681702145"><span class="hs-identifier hs-var">poolids</span></a></span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span class="annot"><a href="Cardano.Api.Fees.html#lookupDelegDeposit"><span class="hs-identifier hs-type">lookupDelegDeposit</span></a></span><span>
</span><span id="line-818"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#StakeCredential"><span class="hs-identifier hs-type">StakeCredential</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Ledger.Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Ledger.Staking</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">L.StandardCrypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-819"></span><span id="lookupDelegDeposit"><span class="annot"><span class="annottext">lookupDelegDeposit :: Map StakeCredential Coin
-&gt; Credential 'Staking StandardCrypto -&gt; Maybe Coin
</span><a href="Cardano.Api.Fees.html#lookupDelegDeposit"><span class="hs-identifier hs-var hs-var">lookupDelegDeposit</span></a></span></span><span> </span><span id="local-6989586621681702149"><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681702149"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span></span><span> </span><span id="local-6989586621681702150"><span class="annot"><span class="annottext">Credential 'Staking StandardCrypto
</span><a href="#local-6989586621681702150"><span class="hs-identifier hs-var">stakeCred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-820"></span><span>  </span><span class="annot"><span class="annottext">StakeCredential -&gt; Map StakeCredential Coin -&gt; Maybe Coin
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Credential 'Staking StandardCrypto -&gt; StakeCredential
</span><a href="Cardano.Api.Address.html#fromShelleyStakeCredential"><span class="hs-identifier hs-var">fromShelleyStakeCredential</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking StandardCrypto
</span><a href="#local-6989586621681702150"><span class="hs-identifier hs-var">stakeCred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681702149"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span><span>
</span><span id="line-821"></span><span>
</span><span id="line-822"></span><span class="annot"><a href="Cardano.Api.Fees.html#lookupDRepDeposit"><span class="hs-identifier hs-type">lookupDRepDeposit</span></a></span><span>
</span><span id="line-823"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Ledger.Credential</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Keys.Internal.html#DRepRole"><span class="hs-identifier hs-type">Ledger.DRepRole</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">Ledger.StandardCrypto</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Ledger.Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Keys.Internal.html#DRepRole"><span class="hs-identifier hs-type">Ledger.DRepRole</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">L.StandardCrypto</span></a></span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-826"></span><span id="lookupDRepDeposit"><span class="annot"><span class="annottext">lookupDRepDeposit :: Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; Credential 'DRepRole StandardCrypto -&gt; Maybe Coin
</span><a href="Cardano.Api.Fees.html#lookupDRepDeposit"><span class="hs-identifier hs-var hs-var">lookupDRepDeposit</span></a></span></span><span> </span><span id="local-6989586621681702153"><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681702153"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span></span><span> </span><span id="local-6989586621681702154"><span class="annot"><span class="annottext">Credential 'DRepRole StandardCrypto
</span><a href="#local-6989586621681702154"><span class="hs-identifier hs-var">drepCred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-827"></span><span>  </span><span class="annot"><span class="annottext">Credential 'DRepRole StandardCrypto
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin -&gt; Maybe Coin
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'DRepRole StandardCrypto
</span><a href="#local-6989586621681702154"><span class="hs-identifier hs-var">drepCred</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681702153"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-830"></span><span class="hs-comment">-- Automated transaction building</span><span>
</span><span id="line-831"></span><span class="hs-comment">--</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span class="annot"><span class="hs-comment">-- | The possible errors that can arise from 'makeTransactionBodyAutoBalance'.</span></span><span>
</span><span id="line-834"></span><span class="hs-keyword">data</span><span> </span><span id="TxBodyErrorAutoBalance"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-var">TxBodyErrorAutoBalance</span></a></span></span><span> </span><span id="local-6989586621681701157"><span class="annot"><a href="#local-6989586621681701157"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-comment">-- | The same errors that can arise from 'makeTransactionBody'.</span></span><span>
</span><span id="line-836"></span><span>    </span><span id="TxBodyError"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyError"><span class="hs-identifier hs-var">TxBodyError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyError"><span class="hs-identifier hs-type">TxBodyError</span></a></span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | One or more of the scripts fails to execute correctly.</span></span><span>
</span><span id="line-838"></span><span>    </span><span id="TxBodyScriptExecutionError"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyScriptExecutionError"><span class="hs-identifier hs-var">TxBodyScriptExecutionError</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier hs-type">ScriptExecutionError</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-839"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | One or more of the scripts were expected to fail validation, but none did.</span></span><span>
</span><span id="line-840"></span><span>    </span><span id="TxBodyScriptBadScriptValidity"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyScriptBadScriptValidity"><span class="hs-identifier hs-var">TxBodyScriptBadScriptValidity</span></a></span></span><span>
</span><span id="line-841"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | There is not enough ada to cover both the outputs and the fees.</span><span>
</span><span id="line-842"></span><span>    </span><span class="hs-comment">-- The transaction should be changed to provide more input ada, or</span><span>
</span><span id="line-843"></span><span>    </span><span class="hs-comment">-- otherwise adjusted to need less (e.g. outputs, script etc).</span><span>
</span><span id="line-844"></span><span>    </span><span id="TxBodyErrorAdaBalanceNegative"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAdaBalanceNegative"><span class="hs-identifier hs-var">TxBodyErrorAdaBalanceNegative</span></a></span></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-845"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | There is enough ada to cover both the outputs and the fees, but the</span><span>
</span><span id="line-846"></span><span>    </span><span class="hs-comment">-- resulting change is too small: it is under the minimum value for</span><span>
</span><span id="line-847"></span><span>    </span><span class="hs-comment">-- new UTxO entries. The transaction should be changed to provide more</span><span>
</span><span id="line-848"></span><span>    </span><span class="hs-comment">-- input ada.</span><span>
</span><span id="line-849"></span><span>    </span><span id="TxBodyErrorAdaBalanceTooSmall"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAdaBalanceTooSmall"><span class="hs-identifier hs-var">TxBodyErrorAdaBalanceTooSmall</span></a></span></span><span>
</span><span id="line-850"></span><span>      </span><span class="hs-comment">-- \^ Offending TxOut</span><span>
</span><span id="line-851"></span><span>      </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutInAnyEra"><span class="hs-identifier hs-type">TxOutInAnyEra</span></a></span><span>
</span><span id="line-852"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Minimum UTxO</span></span><span>
</span><span id="line-853"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-854"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Tx balance</span></span><span>
</span><span id="line-855"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-856"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | 'makeTransactionBodyAutoBalance' does not yet support the Byron era.</span></span><span>
</span><span id="line-857"></span><span>    </span><span id="TxBodyErrorByronEraNotSupported"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorByronEraNotSupported"><span class="hs-identifier hs-var">TxBodyErrorByronEraNotSupported</span></a></span></span><span>
</span><span id="line-858"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The 'ProtocolParameters' must provide the value for the min utxo</span><span>
</span><span id="line-859"></span><span>    </span><span class="hs-comment">-- parameter, for eras that use this parameter.</span><span>
</span><span id="line-860"></span><span>    </span><span id="TxBodyErrorMissingParamMinUTxO"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorMissingParamMinUTxO"><span class="hs-identifier hs-var">TxBodyErrorMissingParamMinUTxO</span></a></span></span><span>
</span><span id="line-861"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The transaction validity interval is too far into the future.</span><span>
</span><span id="line-862"></span><span>    </span><span class="hs-comment">-- See 'TransactionValidityIntervalError' for details.</span><span>
</span><span id="line-863"></span><span>    </span><span id="TxBodyErrorValidityInterval"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorValidityInterval"><span class="hs-identifier hs-var">TxBodyErrorValidityInterval</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TransactionValidityError"><span class="hs-identifier hs-type">TransactionValidityError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701157"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The minimum spendable UTxO threshold has not been met.</span></span><span>
</span><span id="line-865"></span><span>    </span><span id="TxBodyErrorMinUTxONotMet"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorMinUTxONotMet"><span class="hs-identifier hs-var">TxBodyErrorMinUTxONotMet</span></a></span></span><span>
</span><span id="line-866"></span><span>      </span><span class="hs-comment">-- \^ Offending TxOut</span><span>
</span><span id="line-867"></span><span>      </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutInAnyEra"><span class="hs-identifier hs-type">TxOutInAnyEra</span></a></span><span>
</span><span id="line-868"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Minimum UTxO</span></span><span>
</span><span id="line-869"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-870"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TxBodyErrorNonAdaAssetsUnbalanced"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorNonAdaAssetsUnbalanced"><span class="hs-identifier hs-var">TxBodyErrorNonAdaAssetsUnbalanced</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Api.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TxBodyErrorScriptWitnessIndexMissingFromExecUnitsMap"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorScriptWitnessIndexMissingFromExecUnitsMap"><span class="hs-identifier hs-var">TxBodyErrorScriptWitnessIndexMissingFromExecUnitsMap</span></a></span></span><span>
</span><span id="line-872"></span><span>      </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span>
</span><span id="line-873"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ExecutionUnits"><span class="hs-identifier hs-type">ExecutionUnits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TxBodyErrorDeprecatedEra"><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorDeprecatedEra"><span class="hs-identifier hs-var">TxBodyErrorDeprecatedEra</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Experimental.Eras.html#DeprecatedEra"><span class="hs-identifier hs-type">Exp.DeprecatedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701157"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-875"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621681702170"><span id="local-6989586621681702201"><span id="local-6989586621681702204"><span class="annot"><span class="annottext">Int -&gt; TxBodyErrorAutoBalance era -&gt; ShowS
[TxBodyErrorAutoBalance era] -&gt; ShowS
TxBodyErrorAutoBalance era -&gt; String
(Int -&gt; TxBodyErrorAutoBalance era -&gt; ShowS)
-&gt; (TxBodyErrorAutoBalance era -&gt; String)
-&gt; ([TxBodyErrorAutoBalance era] -&gt; ShowS)
-&gt; Show (TxBodyErrorAutoBalance era)
forall era. Int -&gt; TxBodyErrorAutoBalance era -&gt; ShowS
forall era. [TxBodyErrorAutoBalance era] -&gt; ShowS
forall era. TxBodyErrorAutoBalance era -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall era. Int -&gt; TxBodyErrorAutoBalance era -&gt; ShowS
showsPrec :: Int -&gt; TxBodyErrorAutoBalance era -&gt; ShowS
$cshow :: forall era. TxBodyErrorAutoBalance era -&gt; String
show :: TxBodyErrorAutoBalance era -&gt; String
$cshowList :: forall era. [TxBodyErrorAutoBalance era] -&gt; ShowS
showList :: [TxBodyErrorAutoBalance era] -&gt; ShowS
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-876"></span><span>
</span><span id="line-877"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681700734"><span class="annot"><a href="Cardano.Api.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700734"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-878"></span><span>  </span><span id="local-6989586621681702283"><span class="annot"><span class="annottext">prettyError :: forall ann. TxBodyErrorAutoBalance era -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var hs-var hs-var hs-var">prettyError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-879"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyError"><span class="hs-identifier hs-type">TxBodyError</span></a></span><span> </span><span id="local-6989586621681702284"><span class="annot"><span class="annottext">TxBodyError
</span><a href="#local-6989586621681702284"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-880"></span><span>      </span><span class="annot"><span class="annottext">TxBodyError -&gt; Doc ann
forall e ann. Error e =&gt; e -&gt; Doc ann
forall ann. TxBodyError -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var">prettyError</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError
</span><a href="#local-6989586621681702284"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-881"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyScriptExecutionError"><span class="hs-identifier hs-type">TxBodyScriptExecutionError</span></a></span><span> </span><span id="local-6989586621681702285"><span class="annot"><span class="annottext">[(ScriptWitnessIndex, ScriptExecutionError)]
</span><a href="#local-6989586621681702285"><span class="hs-identifier hs-var">failures</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-882"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-883"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The following scripts have execution failures:\n&quot;</span></span><span>
</span><span id="line-884"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span>
</span><span id="line-885"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-886"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;the script for &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc ann
forall ann. String -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptWitnessIndex -&gt; String
</span><a href="Cardano.Api.Tx.Body.html#renderScriptWitnessIndex"><span class="hs-identifier hs-var">renderScriptWitnessIndex</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681702287"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot; failed with: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptExecutionError -&gt; Doc ann
forall e ann. Error e =&gt; e -&gt; Doc ann
forall ann. ScriptExecutionError -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var">prettyError</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptExecutionError
</span><a href="#local-6989586621681702288"><span class="hs-identifier hs-var">failure</span></a></span><span>
</span><span id="line-888"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-889"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681702287"><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681702287"><span class="hs-identifier hs-var">index</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702288"><span class="annot"><span class="annottext">ScriptExecutionError
</span><a href="#local-6989586621681702288"><span class="hs-identifier hs-var">failure</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ScriptWitnessIndex, ScriptExecutionError)]
</span><a href="#local-6989586621681702285"><span class="hs-identifier hs-var">failures</span></a></span><span>
</span><span id="line-890"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-891"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-892"></span><span>    </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyScriptBadScriptValidity"><span class="hs-identifier hs-var">TxBodyScriptBadScriptValidity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-893"></span><span>      </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;One or more of the scripts were expected to fail validation, but none did.&quot;</span></span><span>
</span><span id="line-894"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAdaBalanceNegative"><span class="hs-identifier hs-type">TxBodyErrorAdaBalanceNegative</span></a></span><span> </span><span id="local-6989586621681702289"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702289"><span class="hs-identifier hs-var">lovelace</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-895"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-896"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The transaction does not balance in its use of ada. The net balance &quot;</span></span><span>
</span><span id="line-897"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;of the transaction is negative: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Doc ann
forall ann. Coin -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702289"><span class="hs-identifier hs-var">lovelace</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;. &quot;</span></span><span>
</span><span id="line-898"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The usual solution is to provide more inputs, or inputs with more ada.&quot;</span></span><span>
</span><span id="line-899"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-900"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAdaBalanceTooSmall"><span class="hs-identifier hs-type">TxBodyErrorAdaBalanceTooSmall</span></a></span><span> </span><span id="local-6989586621681702290"><span class="annot"><span class="annottext">TxOutInAnyEra
</span><a href="#local-6989586621681702290"><span class="hs-identifier hs-var">changeOutput</span></a></span></span><span> </span><span id="local-6989586621681702291"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702291"><span class="hs-identifier hs-var">minUTxO</span></a></span></span><span> </span><span id="local-6989586621681702292"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702292"><span class="hs-identifier hs-var">balance</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-901"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-902"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The transaction does balance in its use of ada, however the net &quot;</span></span><span>
</span><span id="line-903"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;balance does not meet the minimum UTxO threshold. \n&quot;</span></span><span>
</span><span id="line-904"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Balance: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Doc ann
forall ann. Coin -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702292"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-905"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Offending output (change output): &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc ann
forall ann. Text -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutInAnyEra -&gt; Text
</span><a href="Cardano.Api.Tx.Body.html#prettyRenderTxOut"><span class="hs-identifier hs-var">prettyRenderTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutInAnyEra
</span><a href="#local-6989586621681702290"><span class="hs-identifier hs-var">changeOutput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-906"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Minimum UTxO threshold: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Doc ann
forall ann. Coin -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702291"><span class="hs-identifier hs-var">minUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-907"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The usual solution is to provide more inputs, or inputs with more ada to &quot;</span></span><span>
</span><span id="line-908"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;meet the minimum UTxO threshold&quot;</span></span><span>
</span><span id="line-909"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-910"></span><span>    </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyErrorByronEraNotSupported"><span class="hs-identifier hs-var">TxBodyErrorByronEraNotSupported</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-911"></span><span>      </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The Byron era is not yet supported by makeTransactionBodyAutoBalance&quot;</span></span><span>
</span><span id="line-912"></span><span>    </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyErrorMissingParamMinUTxO"><span class="hs-identifier hs-var">TxBodyErrorMissingParamMinUTxO</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-913"></span><span>      </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The minUTxOValue protocol parameter is required but missing&quot;</span></span><span>
</span><span id="line-914"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorValidityInterval"><span class="hs-identifier hs-type">TxBodyErrorValidityInterval</span></a></span><span> </span><span id="local-6989586621681702294"><span class="annot"><span class="annottext">TransactionValidityError era
</span><a href="#local-6989586621681702294"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-915"></span><span>      </span><span class="annot"><span class="annottext">TransactionValidityError era -&gt; Doc ann
forall e ann. Error e =&gt; e -&gt; Doc ann
forall ann. TransactionValidityError era -&gt; Doc ann
</span><a href="Cardano.Api.Error.html#prettyError"><span class="hs-identifier hs-var">prettyError</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionValidityError era
</span><a href="#local-6989586621681702294"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-916"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorMinUTxONotMet"><span class="hs-identifier hs-type">TxBodyErrorMinUTxONotMet</span></a></span><span> </span><span id="local-6989586621681702295"><span class="annot"><span class="annottext">TxOutInAnyEra
</span><a href="#local-6989586621681702295"><span class="hs-identifier hs-var">txout</span></a></span></span><span> </span><span id="local-6989586621681702296"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702296"><span class="hs-identifier hs-var">minUTxO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-917"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-918"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Minimum UTxO threshold not met for tx output: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc ann
forall ann. Text -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutInAnyEra -&gt; Text
</span><a href="Cardano.Api.Tx.Body.html#prettyRenderTxOut"><span class="hs-identifier hs-var">prettyRenderTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutInAnyEra
</span><a href="#local-6989586621681702295"><span class="hs-identifier hs-var">txout</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-919"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Minimum required UTxO: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Doc ann
forall ann. Coin -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702296"><span class="hs-identifier hs-var">minUTxO</span></a></span><span>
</span><span id="line-920"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-921"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorNonAdaAssetsUnbalanced"><span class="hs-identifier hs-type">TxBodyErrorNonAdaAssetsUnbalanced</span></a></span><span> </span><span id="local-6989586621681702297"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702297"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-922"></span><span>      </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Non-Ada assets are unbalanced: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc ann
forall ann. Text -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Text
</span><a href="Cardano.Api.Value.html#renderValue"><span class="hs-identifier hs-var">renderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702297"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-923"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorScriptWitnessIndexMissingFromExecUnitsMap"><span class="hs-identifier hs-type">TxBodyErrorScriptWitnessIndexMissingFromExecUnitsMap</span></a></span><span> </span><span id="local-6989586621681702299"><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681702299"><span class="hs-identifier hs-var">sIndex</span></a></span></span><span> </span><span id="local-6989586621681702300"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702300"><span class="hs-identifier hs-var">eUnitsMap</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-924"></span><span>      </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-925"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;ScriptWitnessIndex (redeemer pointer): &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex -&gt; Doc ann
forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="Cardano.Api.Pretty.html#pshow"><span class="hs-identifier hs-var">pshow</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681702299"><span class="hs-identifier hs-var">sIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot; is missing from the execution &quot;</span></span><span>
</span><span id="line-926"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;units (redeemer pointer) map: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits -&gt; Doc ann
forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="Cardano.Api.Pretty.html#pshow"><span class="hs-identifier hs-var">pshow</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702300"><span class="hs-identifier hs-var">eUnitsMap</span></a></span><span>
</span><span id="line-927"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-928"></span><span>    </span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorDeprecatedEra"><span class="hs-identifier hs-type">TxBodyErrorDeprecatedEra</span></a></span><span> </span><span id="local-6989586621681702301"><span class="annot"><span class="annottext">DeprecatedEra era
</span><a href="#local-6989586621681702301"><span class="hs-identifier hs-var">deprecatedEra</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-929"></span><span>      </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;The era &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecatedEra era -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
forall ann. DeprecatedEra era -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">DeprecatedEra era
</span><a href="#local-6989586621681702301"><span class="hs-identifier hs-var">deprecatedEra</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot; is deprecated and no longer supported.&quot;</span></span><span>
</span><span id="line-930"></span><span>
</span><span id="line-931"></span><span id="local-6989586621681701151"><span class="annot"><a href="Cardano.Api.Fees.html#handleExUnitsErrors"><span class="hs-identifier hs-type">handleExUnitsErrors</span></a></span><span>
</span><span id="line-932"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Sign.html#ScriptValidity"><span class="hs-identifier hs-type">ScriptValidity</span></a></span><span>
</span><span id="line-933"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Mark script as expected to pass or fail validation</span></span><span>
</span><span id="line-934"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier hs-type">ScriptExecutionError</span></a></span><span>
</span><span id="line-935"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ExecutionUnits"><span class="hs-identifier hs-type">ExecutionUnits</span></a></span><span>
</span><span id="line-936"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701151"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ExecutionUnits"><span class="hs-identifier hs-type">ExecutionUnits</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-937"></span><span id="handleExUnitsErrors"><span class="annot"><span class="annottext">handleExUnitsErrors :: forall era.
ScriptValidity
-&gt; Map ScriptWitnessIndex ScriptExecutionError
-&gt; Map ScriptWitnessIndex ExecutionUnits
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Map ScriptWitnessIndex ExecutionUnits)
</span><a href="Cardano.Api.Fees.html#handleExUnitsErrors"><span class="hs-identifier hs-var hs-var">handleExUnitsErrors</span></a></span></span><span> </span><span class="annot"><span class="annottext">ScriptValidity
</span><a href="Cardano.Api.Tx.Sign.html#ScriptValid"><span class="hs-identifier hs-var">ScriptValid</span></a></span><span> </span><span id="local-6989586621681702314"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ScriptExecutionError
</span><a href="#local-6989586621681702314"><span class="hs-identifier hs-var">failuresMap</span></a></span></span><span> </span><span id="local-6989586621681702315"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702315"><span class="hs-identifier hs-var">exUnitsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[(ScriptWitnessIndex, ScriptExecutionError)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptWitnessIndex, ScriptExecutionError)]
</span><a href="#local-6989586621681702317"><span class="hs-identifier hs-var">failures</span></a></span><span>
</span><span id="line-939"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Map ScriptWitnessIndex ExecutionUnits)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702315"><span class="hs-identifier hs-var">exUnitsMap</span></a></span><span>
</span><span id="line-940"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Map ScriptWitnessIndex ExecutionUnits)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(ScriptWitnessIndex, ScriptExecutionError)]
-&gt; TxBodyErrorAutoBalance era
forall era.
[(ScriptWitnessIndex, ScriptExecutionError)]
-&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyScriptExecutionError"><span class="hs-identifier hs-var">TxBodyScriptExecutionError</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptWitnessIndex, ScriptExecutionError)]
</span><a href="#local-6989586621681702317"><span class="hs-identifier hs-var">failures</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-942"></span><span>  </span><span class="annot"><a href="#local-6989586621681702317"><span class="hs-identifier hs-type">failures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#ScriptExecutionError"><span class="hs-identifier hs-type">ScriptExecutionError</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-943"></span><span>  </span><span id="local-6989586621681702317"><span class="annot"><span class="annottext">failures :: [(ScriptWitnessIndex, ScriptExecutionError)]
</span><a href="#local-6989586621681702317"><span class="hs-identifier hs-var hs-var">failures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ScriptExecutionError
-&gt; [Item (Map ScriptWitnessIndex ScriptExecutionError)]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ScriptExecutionError
</span><a href="#local-6989586621681702314"><span class="hs-identifier hs-var">failuresMap</span></a></span><span>
</span><span id="line-944"></span><span class="annot"><a href="Cardano.Api.Fees.html#handleExUnitsErrors"><span class="hs-identifier hs-var">handleExUnitsErrors</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptValidity
</span><a href="Cardano.Api.Tx.Sign.html#ScriptInvalid"><span class="hs-identifier hs-var">ScriptInvalid</span></a></span><span> </span><span id="local-6989586621681702319"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ScriptExecutionError
</span><a href="#local-6989586621681702319"><span class="hs-identifier hs-var">failuresMap</span></a></span></span><span> </span><span id="local-6989586621681702320"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702320"><span class="hs-identifier hs-var">exUnitsMap</span></a></span></span><span>
</span><span id="line-945"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ScriptExecutionError -&gt; Bool
forall a. Map ScriptWitnessIndex a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ScriptExecutionError
</span><a href="#local-6989586621681702319"><span class="hs-identifier hs-var">failuresMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Map ScriptWitnessIndex ExecutionUnits)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
forall era. TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyScriptBadScriptValidity"><span class="hs-identifier hs-var">TxBodyScriptBadScriptValidity</span></a></span><span>
</span><span id="line-946"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Map ScriptWitnessIndex ExecutionUnits)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(Map ScriptWitnessIndex ExecutionUnits
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (Map ScriptWitnessIndex ExecutionUnits))
-&gt; Map ScriptWitnessIndex ExecutionUnits
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Map ScriptWitnessIndex ExecutionUnits)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptExecutionError -&gt; ExecutionUnits)
-&gt; Map ScriptWitnessIndex ScriptExecutionError
-&gt; Map ScriptWitnessIndex ExecutionUnits
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Strict.Internal.html#map"><span class="hs-identifier hs-var">Map.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ScriptExecutionError
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; ExecutionUnits
</span><a href="Cardano.Api.Script.html#ExecutionUnits"><span class="hs-identifier hs-var">ExecutionUnits</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ScriptExecutionError
</span><a href="#local-6989586621681702319"><span class="hs-identifier hs-var">failuresMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
-&gt; Map ScriptWitnessIndex ExecutionUnits
-&gt; Map ScriptWitnessIndex ExecutionUnits
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702320"><span class="hs-identifier hs-var">exUnitsMap</span></a></span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span class="hs-keyword">data</span><span> </span><span id="BalancedTxBody"><span class="annot"><a href="Cardano.Api.Fees.html#BalancedTxBody"><span class="hs-identifier hs-var">BalancedTxBody</span></a></span></span><span> </span><span id="local-6989586621681702321"><span class="annot"><a href="#local-6989586621681702321"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-949"></span><span>  </span><span id="local-6989586621681700965"><span id="BalancedTxBody"><span class="annot"><a href="Cardano.Api.Fees.html#BalancedTxBody"><span class="hs-identifier hs-var">BalancedTxBody</span></a></span></span><span>
</span><span id="line-950"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700965"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-951"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Experimental.Tx.html#UnsignedTx"><span class="hs-identifier hs-type">UnsignedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Experimental.Eras.html#ApiEraToExperimentalEra"><span class="hs-identifier hs-type">Exp.ApiEraToExperimentalEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700965"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxTx"><span class="hs-identifier hs-type">CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700965"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Transaction balance (change output)</span></span><span>
</span><span id="line-954"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-955"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Estimated transaction fee</span></span><span>
</span><span id="line-956"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Fees.html#BalancedTxBody"><span class="hs-identifier hs-type">BalancedTxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700965"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span id="local-6989586621681701165"><span id="local-6989586621681702325"><span id="local-6989586621681702335"><span id="local-6989586621681702339"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Experimental.Eras.html#IsEra"><span class="hs-identifier hs-type">Exp.IsEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Experimental.Eras.html#ApiEraToExperimentalEra"><span class="hs-identifier hs-type">Exp.ApiEraToExperimentalEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701165"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#IsShelleyBasedEra"><span class="hs-identifier hs-type">IsShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701165"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#BalancedTxBody"><span class="hs-identifier hs-type">BalancedTxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701165"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span class="hs-keyword">newtype</span><span> </span><span id="RequiredShelleyKeyWitnesses"><span class="annot"><a href="Cardano.Api.Fees.html#RequiredShelleyKeyWitnesses"><span class="hs-identifier hs-var">RequiredShelleyKeyWitnesses</span></a></span></span><span>
</span><span id="line-962"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="RequiredShelleyKeyWitnesses"><span class="annot"><a href="Cardano.Api.Fees.html#RequiredShelleyKeyWitnesses"><span class="hs-identifier hs-var">RequiredShelleyKeyWitnesses</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unRequiredShelleyKeyWitnesses"><span class="annot"><span class="annottext">RequiredShelleyKeyWitnesses -&gt; Int
</span><a href="Cardano.Api.Fees.html#unRequiredShelleyKeyWitnesses"><span class="hs-identifier hs-var hs-var">unRequiredShelleyKeyWitnesses</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621681702343"><span id="local-6989586621681702348"><span id="local-6989586621681702352"><span class="annot"><span class="annottext">Int -&gt; RequiredShelleyKeyWitnesses -&gt; ShowS
[RequiredShelleyKeyWitnesses] -&gt; ShowS
RequiredShelleyKeyWitnesses -&gt; String
(Int -&gt; RequiredShelleyKeyWitnesses -&gt; ShowS)
-&gt; (RequiredShelleyKeyWitnesses -&gt; String)
-&gt; ([RequiredShelleyKeyWitnesses] -&gt; ShowS)
-&gt; Show RequiredShelleyKeyWitnesses
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; RequiredShelleyKeyWitnesses -&gt; ShowS
showsPrec :: Int -&gt; RequiredShelleyKeyWitnesses -&gt; ShowS
$cshow :: RequiredShelleyKeyWitnesses -&gt; String
show :: RequiredShelleyKeyWitnesses -&gt; String
$cshowList :: [RequiredShelleyKeyWitnesses] -&gt; ShowS
showList :: [RequiredShelleyKeyWitnesses] -&gt; ShowS
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-964"></span><span>
</span><span id="line-965"></span><span class="hs-keyword">newtype</span><span> </span><span id="RequiredByronKeyWitnesses"><span class="annot"><a href="Cardano.Api.Fees.html#RequiredByronKeyWitnesses"><span class="hs-identifier hs-var">RequiredByronKeyWitnesses</span></a></span></span><span>
</span><span id="line-966"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="RequiredByronKeyWitnesses"><span class="annot"><a href="Cardano.Api.Fees.html#RequiredByronKeyWitnesses"><span class="hs-identifier hs-var">RequiredByronKeyWitnesses</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unRequiredByronKeyWitnesses"><span class="annot"><span class="annottext">RequiredByronKeyWitnesses -&gt; Int
</span><a href="Cardano.Api.Fees.html#unRequiredByronKeyWitnesses"><span class="hs-identifier hs-var hs-var">unRequiredByronKeyWitnesses</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-967"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621681702356"><span id="local-6989586621681702360"><span id="local-6989586621681702364"><span class="annot"><span class="annottext">Int -&gt; RequiredByronKeyWitnesses -&gt; ShowS
[RequiredByronKeyWitnesses] -&gt; ShowS
RequiredByronKeyWitnesses -&gt; String
(Int -&gt; RequiredByronKeyWitnesses -&gt; ShowS)
-&gt; (RequiredByronKeyWitnesses -&gt; String)
-&gt; ([RequiredByronKeyWitnesses] -&gt; ShowS)
-&gt; Show RequiredByronKeyWitnesses
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; RequiredByronKeyWitnesses -&gt; ShowS
showsPrec :: Int -&gt; RequiredByronKeyWitnesses -&gt; ShowS
$cshow :: RequiredByronKeyWitnesses -&gt; String
show :: RequiredByronKeyWitnesses -&gt; String
$cshowList :: [RequiredByronKeyWitnesses] -&gt; ShowS
showList :: [RequiredByronKeyWitnesses] -&gt; ShowS
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-968"></span><span>
</span><span id="line-969"></span><span class="hs-keyword">newtype</span><span> </span><span id="TotalReferenceScriptsSize"><span class="annot"><a href="Cardano.Api.Fees.html#TotalReferenceScriptsSize"><span class="hs-identifier hs-var">TotalReferenceScriptsSize</span></a></span></span><span>
</span><span id="line-970"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TotalReferenceScriptsSize"><span class="annot"><a href="Cardano.Api.Fees.html#TotalReferenceScriptsSize"><span class="hs-identifier hs-var">TotalReferenceScriptsSize</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unTotalReferenceScriptsSize"><span class="annot"><span class="annottext">TotalReferenceScriptsSize -&gt; Int
</span><a href="Cardano.Api.Fees.html#unTotalReferenceScriptsSize"><span class="hs-identifier hs-var hs-var">unTotalReferenceScriptsSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-971"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621681702368"><span id="local-6989586621681702372"><span id="local-6989586621681702376"><span class="annot"><span class="annottext">Int -&gt; TotalReferenceScriptsSize -&gt; ShowS
[TotalReferenceScriptsSize] -&gt; ShowS
TotalReferenceScriptsSize -&gt; String
(Int -&gt; TotalReferenceScriptsSize -&gt; ShowS)
-&gt; (TotalReferenceScriptsSize -&gt; String)
-&gt; ([TotalReferenceScriptsSize] -&gt; ShowS)
-&gt; Show TotalReferenceScriptsSize
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TotalReferenceScriptsSize -&gt; ShowS
showsPrec :: Int -&gt; TotalReferenceScriptsSize -&gt; ShowS
$cshow :: TotalReferenceScriptsSize -&gt; String
show :: TotalReferenceScriptsSize -&gt; String
$cshowList :: [TotalReferenceScriptsSize] -&gt; ShowS
showList :: [TotalReferenceScriptsSize] -&gt; ShowS
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-972"></span><span>
</span><span id="line-973"></span><span class="hs-keyword">data</span><span> </span><span id="FeeEstimationMode"><span class="annot"><a href="Cardano.Api.Fees.html#FeeEstimationMode"><span class="hs-identifier hs-var">FeeEstimationMode</span></a></span></span><span> </span><span id="local-6989586621681702378"><span class="annot"><a href="#local-6989586621681702378"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-974"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-comment">-- | Accurate fee calculation.</span></span><span>
</span><span id="line-975"></span><span>    </span><span id="CalculateWithSpendableUTxO"><span class="annot"><a href="Cardano.Api.Fees.html#CalculateWithSpendableUTxO"><span class="hs-identifier hs-var">CalculateWithSpendableUTxO</span></a></span></span><span>
</span><span id="line-976"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Query.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702378"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-977"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Spendable UTxO</span></span><span>
</span><span id="line-978"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-slotting-0.2.0.0-d6cb9dd28348e9fcb07e21ccfbef6fa3fb3b94338728b796d31c774e57d616a9/share/doc/html/src/Cardano.Slotting.Time.html#SystemStart"><span class="hs-identifier hs-type">SystemStart</span></a></span><span>
</span><span id="line-979"></span><span>      </span><span class="annot"><a href="Cardano.Api.Query.html#LedgerEpochInfo"><span class="hs-identifier hs-type">LedgerEpochInfo</span></a></span><span>
</span><span id="line-980"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Override number of key witnesses</span></span><span>
</span><span id="line-982"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Less accurate fee estimation.</span></span><span>
</span><span id="line-983"></span><span>    </span><span id="EstimateWithoutSpendableUTxO"><span class="annot"><a href="Cardano.Api.Fees.html#EstimateWithoutSpendableUTxO"><span class="hs-identifier hs-var">EstimateWithoutSpendableUTxO</span></a></span></span><span>
</span><span id="line-984"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-985"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Total potential collateral amount</span></span><span>
</span><span id="line-986"></span><span>      </span><span class="annot"><a href="Cardano.Api.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-987"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Total value of UTxOs being spent</span></span><span>
</span><span id="line-988"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ExecutionUnits"><span class="hs-identifier hs-type">ExecutionUnits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Plutus script execution units</span></span><span>
</span><span id="line-990"></span><span>      </span><span class="annot"><a href="Cardano.Api.Fees.html#RequiredShelleyKeyWitnesses"><span class="hs-identifier hs-type">RequiredShelleyKeyWitnesses</span></a></span><span>
</span><span id="line-991"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ The number of key witnesses still to be added to the transaction.</span></span><span>
</span><span id="line-992"></span><span>      </span><span class="annot"><a href="Cardano.Api.Fees.html#RequiredByronKeyWitnesses"><span class="hs-identifier hs-type">RequiredByronKeyWitnesses</span></a></span><span>
</span><span id="line-993"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ The number of Byron key witnesses still to be added to the transaction.</span></span><span>
</span><span id="line-994"></span><span>      </span><span class="annot"><a href="Cardano.Api.Fees.html#TotalReferenceScriptsSize"><span class="hs-identifier hs-type">TotalReferenceScriptsSize</span></a></span><span>
</span><span id="line-995"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ The total size in bytes of reference scripts</span></span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span class="hs-comment">-- | This is much like 'makeTransactionBody' but with greater automation to</span><span>
</span><span id="line-998"></span><span class="hs-comment">-- calculate suitable values for several things.</span><span>
</span><span id="line-999"></span><span class="hs-comment">--</span><span>
</span><span id="line-1000"></span><span class="hs-comment">-- In particular:</span><span>
</span><span id="line-1001"></span><span class="hs-comment">--</span><span>
</span><span id="line-1002"></span><span class="hs-comment">-- * It calculates the correct script 'ExecutionUnits' (ignoring the provided</span><span>
</span><span id="line-1003"></span><span class="hs-comment">--   values, which can thus be zero).</span><span>
</span><span id="line-1004"></span><span class="hs-comment">--</span><span>
</span><span id="line-1005"></span><span class="hs-comment">-- * It calculates the transaction fees, based on the script 'ExecutionUnits',</span><span>
</span><span id="line-1006"></span><span class="hs-comment">--   the current 'ProtocolParameters', and an estimate of the number of</span><span>
</span><span id="line-1007"></span><span class="hs-comment">--   key witnesses (i.e. signatures). There is an override for the number of</span><span>
</span><span id="line-1008"></span><span class="hs-comment">--   key witnesses.</span><span>
</span><span id="line-1009"></span><span class="hs-comment">--</span><span>
</span><span id="line-1010"></span><span class="hs-comment">-- * It accepts a change address, calculates the balance of the transaction</span><span>
</span><span id="line-1011"></span><span class="hs-comment">--   and puts the excess change into the change output.</span><span>
</span><span id="line-1012"></span><span class="hs-comment">--</span><span>
</span><span id="line-1013"></span><span class="hs-comment">-- * It also checks that the balance is positive and the change is above the</span><span>
</span><span id="line-1014"></span><span class="hs-comment">--   minimum threshold.</span><span>
</span><span id="line-1015"></span><span class="hs-comment">--</span><span>
</span><span id="line-1016"></span><span class="hs-comment">-- To do this it needs more information than 'makeTransactionBody', all of</span><span>
</span><span id="line-1017"></span><span class="hs-comment">-- which can be queried from a local node.</span><span>
</span><span id="line-1018"></span><span class="annot"><a href="Cardano.Api.Fees.html#makeTransactionBodyAutoBalance"><span class="hs-identifier hs-type">makeTransactionBodyAutoBalance</span></a></span><span>
</span><span id="line-1019"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681700763"><span class="annot"><a href="#local-6989586621681700763"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-1020"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1021"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700763"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1022"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-slotting-0.2.0.0-d6cb9dd28348e9fcb07e21ccfbef6fa3fb3b94338728b796d31c774e57d616a9/share/doc/html/src/Cardano.Slotting.Time.html#SystemStart"><span class="hs-identifier hs-type">SystemStart</span></a></span><span>
</span><span id="line-1023"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Query.html#LedgerEpochInfo"><span class="hs-identifier hs-type">LedgerEpochInfo</span></a></span><span>
</span><span id="line-1024"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.ProtocolParameters.html#LedgerProtocolParameters"><span class="hs-identifier hs-type">LedgerProtocolParameters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700763"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1025"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Certificate.html#PoolId"><span class="hs-identifier hs-type">PoolId</span></a></span><span>
</span><span id="line-1026"></span><span>  </span><span class="hs-comment">-- ^ The set of registered stake pools, that are being</span><span>
</span><span id="line-1027"></span><span>  </span><span class="hs-comment">--   unregistered in this transaction.</span><span>
</span><span id="line-1028"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#StakeCredential"><span class="hs-identifier hs-type">StakeCredential</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-1029"></span><span>  </span><span class="hs-comment">-- ^ Map of all deposits for stake credentials that are being</span><span>
</span><span id="line-1030"></span><span>  </span><span class="hs-comment">--   unregistered in this transaction</span><span>
</span><span id="line-1031"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Ledger.Credential</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Keys.Internal.html#DRepRole"><span class="hs-identifier hs-type">Ledger.DRepRole</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Crypto.html#StandardCrypto"><span class="hs-identifier hs-type">Ledger.StandardCrypto</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-1032"></span><span>  </span><span class="hs-comment">-- ^ Map of all deposits for drep credentials that are being</span><span>
</span><span id="line-1033"></span><span>  </span><span class="hs-comment">--   unregistered in this transaction</span><span>
</span><span id="line-1034"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Query.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700763"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1035"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Just the transaction inputs, not the entire 'UTxO'.</span></span><span>
</span><span id="line-1036"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700763"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1037"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#AddressInEra"><span class="hs-identifier hs-type">AddressInEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700763"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1038"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Change address</span></span><span>
</span><span id="line-1039"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>
</span><span id="line-1040"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Override key witnesses</span></span><span>
</span><span id="line-1041"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700763"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#BalancedTxBody"><span class="hs-identifier hs-type">BalancedTxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700763"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span id="makeTransactionBodyAutoBalance"><span class="annot"><span class="annottext">makeTransactionBodyAutoBalance :: forall era.
ShelleyBasedEra era
-&gt; SystemStart
-&gt; LedgerEpochInfo
-&gt; LedgerProtocolParameters era
-&gt; Set (Hash StakePoolKey)
-&gt; Map StakeCredential Coin
-&gt; Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; UTxO era
-&gt; TxBodyContent BuildTx era
-&gt; AddressInEra era
-&gt; Maybe Word
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
</span><a href="Cardano.Api.Fees.html#makeTransactionBodyAutoBalance"><span class="hs-identifier hs-var hs-var">makeTransactionBodyAutoBalance</span></a></span></span><span>
</span><span id="line-1043"></span><span>  </span><span id="local-6989586621681702379"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span></span><span>
</span><span id="line-1044"></span><span>  </span><span id="local-6989586621681702380"><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621681702380"><span class="hs-identifier hs-var">systemstart</span></a></span></span><span>
</span><span id="line-1045"></span><span>  </span><span id="local-6989586621681702381"><span class="annot"><span class="annottext">LedgerEpochInfo
</span><a href="#local-6989586621681702381"><span class="hs-identifier hs-var">history</span></a></span></span><span>
</span><span id="line-1046"></span><span>  </span><span id="local-6989586621681702382"><span class="annot"><span class="annottext">lpp :: LedgerProtocolParameters era
</span><a href="#local-6989586621681702382"><span class="hs-identifier hs-var">lpp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.ProtocolParameters.html#LedgerProtocolParameters"><span class="hs-identifier hs-type">LedgerProtocolParameters</span></a></span><span> </span><span id="local-6989586621681702383"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702383"><span class="hs-identifier hs-var">pp</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1047"></span><span>  </span><span id="local-6989586621681702384"><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681702384"><span class="hs-identifier hs-var">poolids</span></a></span></span><span>
</span><span id="line-1048"></span><span>  </span><span id="local-6989586621681702385"><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681702385"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span></span><span>
</span><span id="line-1049"></span><span>  </span><span id="local-6989586621681702386"><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681702386"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span></span><span>
</span><span id="line-1050"></span><span>  </span><span id="local-6989586621681702387"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681702387"><span class="hs-identifier hs-var">utxo</span></a></span></span><span>
</span><span id="line-1051"></span><span>  </span><span id="local-6989586621681702388"><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702388"><span class="hs-identifier hs-var">txbodycontent</span></a></span></span><span>
</span><span id="line-1052"></span><span>  </span><span id="local-6989586621681702389"><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702389"><span class="hs-identifier hs-var">changeaddr</span></a></span></span><span>
</span><span id="line-1053"></span><span>  </span><span id="local-6989586621681702390"><span class="annot"><span class="annottext">Maybe Word
</span><a href="#local-6989586621681702390"><span class="hs-identifier hs-var">mnkeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1054"></span><span>    </span><span class="annot"><span class="annottext">(ShelleyToAlonzoEraConstraints era =&gt;
 ShelleyToAlonzoEra era
 -&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era))
-&gt; (BabbageEraOnwardsConstraints era =&gt;
    BabbageEraOnwards era
    -&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era))
-&gt; ShelleyBasedEra era
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
forall era a.
(ShelleyToAlonzoEraConstraints era =&gt; ShelleyToAlonzoEra era -&gt; a)
-&gt; (BabbageEraOnwardsConstraints era =&gt; BabbageEraOnwards era -&gt; a)
-&gt; ShelleyBasedEra era
-&gt; a
</span><a href="Cardano.Api.Eras.Case.html#caseShelleyToAlonzoOrBabbageEraOnwards"><span class="hs-identifier hs-var">caseShelleyToAlonzoOrBabbageEraOnwards</span></a></span><span>
</span><span id="line-1055"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyErrorAutoBalance era
 -&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era))
-&gt; (ShelleyToAlonzoEra era -&gt; TxBodyErrorAutoBalance era)
-&gt; ShelleyToAlonzoEra era
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecatedEra era -&gt; TxBodyErrorAutoBalance era
forall era. DeprecatedEra era -&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyErrorDeprecatedEra"><span class="hs-identifier hs-var">TxBodyErrorDeprecatedEra</span></a></span><span> </span><span class="annot"><span class="annottext">(DeprecatedEra era -&gt; TxBodyErrorAutoBalance era)
-&gt; (ShelleyToAlonzoEra era -&gt; DeprecatedEra era)
-&gt; ShelleyToAlonzoEra era
-&gt; TxBodyErrorAutoBalance era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; DeprecatedEra era
forall era. ShelleyBasedEra era -&gt; DeprecatedEra era
</span><a href="Cardano.Api.Experimental.Eras.html#DeprecatedEra"><span class="hs-identifier hs-var">Exp.DeprecatedEra</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyBasedEra era -&gt; DeprecatedEra era)
-&gt; (ShelleyToAlonzoEra era -&gt; ShelleyBasedEra era)
-&gt; ShelleyToAlonzoEra era
-&gt; DeprecatedEra era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyToAlonzoEra era -&gt; ShelleyBasedEra era
forall era. ShelleyToAlonzoEra era -&gt; ShelleyBasedEra era
</span><a href="Cardano.Api.Eon.ShelleyToAlonzoEra.html#shelleyToAlonzoEraToShelleyBasedEra"><span class="hs-identifier hs-var">shelleyToAlonzoEraToShelleyBasedEra</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681702421"><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702421"><span class="hs-identifier hs-var">bEraOnwards</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1057"></span><span>          </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; (ShelleyBasedEraConstraints era =&gt;
    Either (TxBodyErrorAutoBalance era) (BalancedTxBody era))
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
forall era a.
ShelleyBasedEra era -&gt; (ShelleyBasedEraConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#shelleyBasedEraConstraints"><span class="hs-identifier hs-var">shelleyBasedEraConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyBasedEraConstraints era =&gt;
  Either (TxBodyErrorAutoBalance era) (BalancedTxBody era))
 -&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era))
-&gt; (ShelleyBasedEraConstraints era =&gt;
    Either (TxBodyErrorAutoBalance era) (BalancedTxBody era))
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1058"></span><span>            </span><span id="local-6989586621681702453"><span class="annot"><span class="annottext">Era (ApiEraToExperimentalEra era)
</span><a href="#local-6989586621681702453"><span class="hs-identifier hs-var">availableEra</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DeprecatedEra era -&gt; TxBodyErrorAutoBalance era)
-&gt; Either (DeprecatedEra era) (Era (ApiEraToExperimentalEra era))
-&gt; Either
     (TxBodyErrorAutoBalance era) (Era (ApiEraToExperimentalEra era))
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">DeprecatedEra era -&gt; TxBodyErrorAutoBalance era
forall era. DeprecatedEra era -&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyErrorDeprecatedEra"><span class="hs-identifier hs-var">TxBodyErrorDeprecatedEra</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (DeprecatedEra era) (Era (ApiEraToExperimentalEra era))
 -&gt; Either
      (TxBodyErrorAutoBalance era) (Era (ApiEraToExperimentalEra era)))
-&gt; Either (DeprecatedEra era) (Era (ApiEraToExperimentalEra era))
-&gt; Either
     (TxBodyErrorAutoBalance era) (Era (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; Either (DeprecatedEra era) (Era (ApiEraToExperimentalEra era))
forall era (m :: * -&gt; *).
MonadError (DeprecatedEra era) m =&gt;
ShelleyBasedEra era -&gt; m (Era (ApiEraToExperimentalEra era))
</span><a href="Cardano.Api.Experimental.Eras.html#sbeToEra"><span class="hs-identifier hs-var">sbeToEra</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-1059"></span><span>
</span><span id="line-1060"></span><span>            </span><span class="hs-comment">-- Our strategy is to:</span><span>
</span><span id="line-1061"></span><span>            </span><span class="hs-comment">-- 1. evaluate all the scripts to get the exec units, update with ex units</span><span>
</span><span id="line-1062"></span><span>            </span><span class="hs-comment">-- 2. figure out the overall min fees</span><span>
</span><span id="line-1063"></span><span>            </span><span class="hs-comment">-- 3. update tx with fees</span><span>
</span><span id="line-1064"></span><span>            </span><span class="hs-comment">-- 4. balance the transaction and update tx change output</span><span>
</span><span id="line-1065"></span><span>            </span><span class="annot"><a href="Cardano.Api.Experimental.Tx.html#UnsignedTx"><span class="hs-identifier hs-type">UnsignedTx</span></a></span><span> </span><span id="local-6989586621681702455"><span class="annot"><span class="annottext">Tx (LedgerEra (ApiEraToExperimentalEra era))
</span><a href="#local-6989586621681702455"><span class="hs-identifier hs-var">unsignedTx0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1066"></span><span>              </span><span class="annot"><span class="annottext">(TxBodyError -&gt; TxBodyErrorAutoBalance era)
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (UnsignedTx (ApiEraToExperimentalEra era))
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; TxBodyErrorAutoBalance era
forall era. TxBodyError -&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyError"><span class="hs-identifier hs-var">TxBodyError</span></a></span><span>
</span><span id="line-1067"></span><span>                </span><span class="annot"><span class="annottext">(Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (UnsignedTx (ApiEraToExperimentalEra era)))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (UnsignedTx (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Era (ApiEraToExperimentalEra era)
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
forall era.
Era era
-&gt; TxBodyContent BuildTx (ExperimentalEraToApiEra era)
-&gt; Either TxBodyError (UnsignedTx era)
</span><a href="Cardano.Api.Experimental.Tx.html#makeUnsignedTx"><span class="hs-identifier hs-var">makeUnsignedTx</span></a></span><span>
</span><span id="line-1068"></span><span>                  </span><span class="annot"><span class="annottext">Era (ApiEraToExperimentalEra era)
</span><a href="#local-6989586621681702453"><span class="hs-identifier hs-var">availableEra</span></a></span><span>
</span><span id="line-1069"></span><span>                </span><span class="annot"><span class="annottext">(TxBodyContent
   BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
 -&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
-&gt; (EraShimConstraints era =&gt;
    TxBodyContent
      BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
forall era a.
BabbageEraOnwards era -&gt; (EraShimConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Experimental.Eras.html#obtainShimConstraints"><span class="hs-identifier hs-var">obtainShimConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702421"><span class="hs-identifier hs-var">bEraOnwards</span></a></span><span>
</span><span id="line-1070"></span><span>                </span><span class="annot"><span class="annottext">((EraShimConstraints era =&gt;
  TxBodyContent
    BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
 -&gt; TxBodyContent
      BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
-&gt; (EraShimConstraints era =&gt;
    TxBodyContent
      BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702388"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span>
</span><span id="line-1071"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1072"></span><span>                      </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702388"><span class="hs-identifier hs-type">txbodycontent</span></a></span><span>
</span><span id="line-1073"></span><span>                        </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-type">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702389"><span class="hs-identifier hs-type">changeaddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#lovelaceToTxOutValue"><span class="hs-identifier hs-type">lovelaceToTxOutValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702379"><span class="hs-identifier hs-type">sbe</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-type">TxOutDatumNone</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-type">ReferenceScriptNone</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1074"></span><span>                        </span><span class="hs-comment">-- TODO: think about the size of the change output</span><span>
</span><span id="line-1075"></span><span>                        </span><span class="hs-comment">-- 1,2,4 or 8 bytes?</span><span>
</span><span id="line-1076"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-1077"></span><span>            </span><span id="local-6989586621681702461"><span class="annot"><span class="annottext">Map
  ScriptWitnessIndex
  (Either ScriptExecutionError ([Text], ExecutionUnits))
</span><a href="#local-6989586621681702461"><span class="hs-identifier hs-var">exUnitsMapWithLogs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1078"></span><span>              </span><span class="annot"><span class="annottext">(TransactionValidityError era -&gt; TxBodyErrorAutoBalance era)
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionValidityError era -&gt; TxBodyErrorAutoBalance era
forall era.
TransactionValidityError era -&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyErrorValidityInterval"><span class="hs-identifier hs-var">TxBodyErrorValidityInterval</span></a></span><span>
</span><span id="line-1079"></span><span>                </span><span class="annot"><span class="annottext">(Either
   (TransactionValidityError era)
   (Map
      ScriptWitnessIndex
      (Either ScriptExecutionError ([Text], ExecutionUnits)))
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (Map
         ScriptWitnessIndex
         (Either ScriptExecutionError ([Text], ExecutionUnits))))
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; SystemStart
-&gt; LedgerEpochInfo
-&gt; LedgerProtocolParameters era
-&gt; UTxO era
-&gt; Tx (ShelleyLedgerEra era)
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall era.
ShelleyBasedEra era
-&gt; SystemStart
-&gt; LedgerEpochInfo
-&gt; LedgerProtocolParameters era
-&gt; UTxO era
-&gt; Tx (ShelleyLedgerEra era)
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
</span><a href="Cardano.Api.Fees.html#evaluateTransactionExecutionUnitsShelley"><span class="hs-identifier hs-var">evaluateTransactionExecutionUnitsShelley</span></a></span><span>
</span><span id="line-1080"></span><span>                  </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-1081"></span><span>                  </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621681702380"><span class="hs-identifier hs-var">systemstart</span></a></span><span>
</span><span id="line-1082"></span><span>                  </span><span class="annot"><span class="annottext">LedgerEpochInfo
</span><a href="#local-6989586621681702381"><span class="hs-identifier hs-var">history</span></a></span><span>
</span><span id="line-1083"></span><span>                  </span><span class="annot"><span class="annottext">LedgerProtocolParameters era
</span><a href="#local-6989586621681702382"><span class="hs-identifier hs-var">lpp</span></a></span><span>
</span><span id="line-1084"></span><span>                  </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681702387"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-1085"></span><span>                </span><span class="annot"><span class="annottext">(Tx (ShelleyLedgerEra era)
 -&gt; Either
      (TransactionValidityError era)
      (Map
         ScriptWitnessIndex
         (Either ScriptExecutionError ([Text], ExecutionUnits))))
-&gt; Tx (ShelleyLedgerEra era)
-&gt; Either
     (TransactionValidityError era)
     (Map
        ScriptWitnessIndex
        (Either ScriptExecutionError ([Text], ExecutionUnits)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
-&gt; (EraShimConstraints era =&gt; Tx (ShelleyLedgerEra era))
-&gt; Tx (ShelleyLedgerEra era)
forall era a.
BabbageEraOnwards era -&gt; (EraShimConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Experimental.Eras.html#obtainShimConstraints"><span class="hs-identifier hs-var">obtainShimConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702421"><span class="hs-identifier hs-var">bEraOnwards</span></a></span><span> </span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
Tx (LedgerEra (ApiEraToExperimentalEra era))
EraShimConstraints era =&gt; Tx (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702455"><span class="hs-identifier hs-var">unsignedTx0</span></a></span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702465"><span class="annot"><span class="annottext">exUnitsMap :: Map ScriptWitnessIndex (Either ScriptExecutionError ExecutionUnits)
</span><a href="#local-6989586621681702465"><span class="hs-identifier hs-var hs-var">exUnitsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either ScriptExecutionError ([Text], ExecutionUnits)
 -&gt; Either ScriptExecutionError ExecutionUnits)
-&gt; Map
     ScriptWitnessIndex
     (Either ScriptExecutionError ([Text], ExecutionUnits))
-&gt; Map
     ScriptWitnessIndex (Either ScriptExecutionError ExecutionUnits)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Strict.Internal.html#map"><span class="hs-identifier hs-var">Map.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([Text], ExecutionUnits) -&gt; ExecutionUnits)
-&gt; Either ScriptExecutionError ([Text], ExecutionUnits)
-&gt; Either ScriptExecutionError ExecutionUnits
forall a b.
(a -&gt; b)
-&gt; Either ScriptExecutionError a -&gt; Either ScriptExecutionError b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">([Text], ExecutionUnits) -&gt; ExecutionUnits
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map
  ScriptWitnessIndex
  (Either ScriptExecutionError ([Text], ExecutionUnits))
</span><a href="#local-6989586621681702461"><span class="hs-identifier hs-var">exUnitsMapWithLogs</span></a></span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span>            </span><span id="local-6989586621681702467"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702467"><span class="hs-identifier hs-var">exUnitsMap'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1090"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Either ScriptExecutionError ExecutionUnits
 -&gt; Either ScriptExecutionError ExecutionUnits)
-&gt; Map
     ScriptWitnessIndex (Either ScriptExecutionError ExecutionUnits)
-&gt; (Map ScriptWitnessIndex ScriptExecutionError,
    Map ScriptWitnessIndex ExecutionUnits)
forall a b c k. (a -&gt; Either b c) -&gt; Map k a -&gt; (Map k b, Map k c)
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Strict.Internal.html#mapEither"><span class="hs-identifier hs-var">Map.mapEither</span></a></span><span> </span><span class="annot"><span class="annottext">Either ScriptExecutionError ExecutionUnits
-&gt; Either ScriptExecutionError ExecutionUnits
forall a. a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex (Either ScriptExecutionError ExecutionUnits)
</span><a href="#local-6989586621681702465"><span class="hs-identifier hs-var">exUnitsMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1091"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621681702470"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ScriptExecutionError
</span><a href="#local-6989586621681702470"><span class="hs-identifier hs-var">failures</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702471"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702471"><span class="hs-identifier hs-var">exUnitsMap'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1092"></span><span>                  </span><span class="annot"><span class="annottext">ScriptValidity
-&gt; Map ScriptWitnessIndex ScriptExecutionError
-&gt; Map ScriptWitnessIndex ExecutionUnits
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Map ScriptWitnessIndex ExecutionUnits)
forall era.
ScriptValidity
-&gt; Map ScriptWitnessIndex ScriptExecutionError
-&gt; Map ScriptWitnessIndex ExecutionUnits
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Map ScriptWitnessIndex ExecutionUnits)
</span><a href="Cardano.Api.Fees.html#handleExUnitsErrors"><span class="hs-identifier hs-var">handleExUnitsErrors</span></a></span><span>
</span><span id="line-1093"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxScriptValidity era -&gt; ScriptValidity
forall era. TxScriptValidity era -&gt; ScriptValidity
</span><a href="Cardano.Api.Tx.Sign.html#txScriptValidityToScriptValidity"><span class="hs-identifier hs-var">txScriptValidityToScriptValidity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; TxScriptValidity era
forall build era. TxBodyContent build era -&gt; TxScriptValidity era
</span><a href="Cardano.Api.Tx.Body.html#txScriptValidity"><span class="hs-identifier hs-var">txScriptValidity</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702388"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1094"></span><span>                    </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ScriptExecutionError
</span><a href="#local-6989586621681702470"><span class="hs-identifier hs-var">failures</span></a></span><span>
</span><span id="line-1095"></span><span>                    </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702471"><span class="hs-identifier hs-var">exUnitsMap'</span></a></span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span>            </span><span id="local-6989586621681702474"><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702474"><span class="hs-identifier hs-var">txbodycontent1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
-&gt; TxBodyContent BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era)
forall era.
Map ScriptWitnessIndex ExecutionUnits
-&gt; TxBodyContent BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era)
</span><a href="Cardano.Api.Fees.html#substituteExecutionUnits"><span class="hs-identifier hs-var">substituteExecutionUnits</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702467"><span class="hs-identifier hs-var">exUnitsMap'</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702388"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span>            </span><span class="hs-comment">-- Make a txbody that we will use for calculating the fees. For the purpose</span><span>
</span><span id="line-1100"></span><span>            </span><span class="hs-comment">-- of fees we just need to make a txbody of the right size in bytes. We do</span><span>
</span><span id="line-1101"></span><span>            </span><span class="hs-comment">-- not need the right values for the fee or change output. We use</span><span>
</span><span id="line-1102"></span><span>            </span><span class="hs-comment">-- &quot;big enough&quot; values for the change output and set so that the CBOR</span><span>
</span><span id="line-1103"></span><span>            </span><span class="hs-comment">-- encoding size of the tx will be big enough to cover the size of the final</span><span>
</span><span id="line-1104"></span><span>            </span><span class="hs-comment">-- output and fee. Yes this means this current code will only work for</span><span>
</span><span id="line-1105"></span><span>            </span><span class="hs-comment">-- final fee of less than around 4000 ada (2^32-1 lovelace) and change output</span><span>
</span><span id="line-1106"></span><span>            </span><span class="hs-comment">-- of less than around 18 trillion ada  (2^64-1 lovelace).</span><span>
</span><span id="line-1107"></span><span>            </span><span class="hs-comment">-- However, since at this point we know how much non-Ada change to give</span><span>
</span><span id="line-1108"></span><span>            </span><span class="hs-comment">-- we can use the true values for that.</span><span>
</span><span id="line-1109"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702480"><span class="annot"><span class="annottext">maxLovelaceChange :: Coin
</span><a href="#local-6989586621681702480"><span class="hs-identifier hs-var hs-var">maxLovelaceChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">L.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#%5E"><span class="hs-operator hs-var">^</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">64</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-bignum-1.3-inplace/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1110"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702486"><span class="annot"><span class="annottext">maxLovelaceFee :: Coin
</span><a href="#local-6989586621681702486"><span class="hs-identifier hs-var hs-var">maxLovelaceFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">L.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#%5E"><span class="hs-operator hs-var">^</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-bignum-1.3-inplace/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1111"></span><span>
</span><span id="line-1112"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702487"><span class="annot"><span class="annottext">totalValueAtSpendableUTxO :: Value
</span><a href="#local-6989586621681702487"><span class="hs-identifier hs-var hs-var">totalValueAtSpendableUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; Value (ShelleyLedgerEra era) -&gt; Value
forall era.
ShelleyBasedEra era -&gt; Value (ShelleyLedgerEra era) -&gt; Value
</span><a href="Cardano.Api.Value.html#fromLedgerValue"><span class="hs-identifier hs-var">fromLedgerValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">(Value (ShelleyLedgerEra era) -&gt; Value)
-&gt; Value (ShelleyLedgerEra era) -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxUTxO era] -&gt; Value (ShelleyLedgerEra era)
forall era ctx.
Monoid (Value (ShelleyLedgerEra era)) =&gt;
[TxOut ctx era] -&gt; Value (ShelleyLedgerEra era)
</span><a href="Cardano.Api.Fees.html#calculateIncomingUTxOValue"><span class="hs-identifier hs-var">calculateIncomingUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut CtxUTxO era] -&gt; Value (ShelleyLedgerEra era))
-&gt; [TxOut CtxUTxO era] -&gt; Value (ShelleyLedgerEra era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO era) -&gt; [TxOut CtxUTxO era]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxIn (TxOut CtxUTxO era) -&gt; [TxOut CtxUTxO era])
-&gt; Map TxIn (TxOut CtxUTxO era) -&gt; [TxOut CtxUTxO era]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era -&gt; Map TxIn (TxOut CtxUTxO era)
forall era. UTxO era -&gt; Map TxIn (TxOut CtxUTxO era)
</span><a href="Cardano.Api.Query.html#unUTxO"><span class="hs-identifier hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681702387"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-1113"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702492"><span class="annot"><span class="annottext">change :: MaryValue StandardCrypto
</span><a href="#local-6989586621681702492"><span class="hs-identifier hs-var hs-var">change</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1114"></span><span>                  </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; MaryValue StandardCrypto
-&gt; (MaryEraOnwards era -&gt; MaryValue StandardCrypto)
-&gt; MaryValue StandardCrypto
forall (eon :: * -&gt; *) era a.
Eon eon =&gt;
ShelleyBasedEra era -&gt; a -&gt; (eon era -&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#forShelleyBasedEraInEon"><span class="hs-identifier hs-var">forShelleyBasedEraInEon</span></a></span><span>
</span><span id="line-1115"></span><span>                    </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-1116"></span><span>                    </span><span class="annot"><span class="annottext">MaryValue StandardCrypto
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-1117"></span><span>                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681702493"><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681702493"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era -&gt; Value -&gt; Value (ShelleyLedgerEra era)
forall era.
MaryEraOnwards era -&gt; Value -&gt; Value (ShelleyLedgerEra era)
</span><a href="Cardano.Api.Value.html#toLedgerValue"><span class="hs-identifier hs-var">toLedgerValue</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681702493"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value (ShelleyLedgerEra era))
-&gt; Value -&gt; Value (ShelleyLedgerEra era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; Value -&gt; TxBodyContent BuildTx era -&gt; Value
forall era build.
ShelleyBasedEra era -&gt; Value -&gt; TxBodyContent build era -&gt; Value
</span><a href="Cardano.Api.Fees.html#calculateChangeValue"><span class="hs-identifier hs-var">calculateChangeValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702487"><span class="hs-identifier hs-var">totalValueAtSpendableUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702474"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1118"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702494"><span class="annot"><span class="annottext">changeWithMaxLovelace :: MaryValue StandardCrypto
</span><a href="#local-6989586621681702494"><span class="hs-identifier hs-var hs-var">changeWithMaxLovelace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaryValue StandardCrypto
</span><a href="#local-6989586621681702492"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="annot"><span class="annottext">MaryValue StandardCrypto
-&gt; (MaryValue StandardCrypto -&gt; MaryValue StandardCrypto)
-&gt; MaryValue StandardCrypto
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; Lens' (Value (ShelleyLedgerEra era)) Coin
forall era.
ShelleyBasedEra era -&gt; Lens' (Value (ShelleyLedgerEra era)) Coin
</span><a href="Cardano.Api.Ledger.Lens.html#adaAssetL"><span class="hs-identifier hs-var">A.adaAssetL</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin)
 -&gt; MaryValue StandardCrypto -&gt; Identity (MaryValue StandardCrypto))
-&gt; Coin -&gt; MaryValue StandardCrypto -&gt; MaryValue StandardCrypto
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702480"><span class="hs-identifier hs-var">maxLovelaceChange</span></a></span><span>
</span><span id="line-1119"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702495"><span class="annot"><span class="annottext">changeTxOut :: TxOutValue era
</span><a href="#local-6989586621681702495"><span class="hs-identifier hs-var hs-var">changeTxOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1120"></span><span>                  </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxOutValue era
-&gt; (MaryEraOnwards era -&gt; TxOutValue era)
-&gt; TxOutValue era
forall (eon :: * -&gt; *) era a.
Eon eon =&gt;
ShelleyBasedEra era -&gt; a -&gt; (eon era -&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#forShelleyBasedEraInEon"><span class="hs-identifier hs-var">forShelleyBasedEraInEon</span></a></span><span>
</span><span id="line-1121"></span><span>                    </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-1122"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; Coin -&gt; TxOutValue era
forall era. ShelleyBasedEra era -&gt; Coin -&gt; TxOutValue era
</span><a href="Cardano.Api.Tx.Body.html#lovelaceToTxOutValue"><span class="hs-identifier hs-var">lovelaceToTxOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702480"><span class="hs-identifier hs-var">maxLovelaceChange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1123"></span><span>                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681702496"><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681702496"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
-&gt; (MaryEraOnwardsConstraints era =&gt; TxOutValue era)
-&gt; TxOutValue era
forall era a.
MaryEraOnwards era -&gt; (MaryEraOnwardsConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.MaryEraOnwards.html#maryEraOnwardsConstraints"><span class="hs-identifier hs-var">maryEraOnwardsConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681702496"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((MaryEraOnwardsConstraints era =&gt; TxOutValue era)
 -&gt; TxOutValue era)
-&gt; (MaryEraOnwardsConstraints era =&gt; TxOutValue era)
-&gt; TxOutValue era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
forall era.
(Eq (Value (ShelleyLedgerEra era)),
 Show (Value (ShelleyLedgerEra era))) =&gt;
ShelleyBasedEra era
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
</span><a href="Cardano.Api.Tx.Body.html#TxOutValueShelleyBased"><span class="hs-identifier hs-var">TxOutValueShelleyBased</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">Value (ShelleyLedgerEra era)
MaryValue StandardCrypto
</span><a href="#local-6989586621681702494"><span class="hs-identifier hs-var">changeWithMaxLovelace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1124"></span><span>
</span><span id="line-1125"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681702500"><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702500"><span class="hs-identifier hs-var">dummyCollRet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702501"><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702501"><span class="hs-identifier hs-var">dummyTotColl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era
-&gt; AddressInEra era
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era
-&gt; AddressInEra era
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
</span><a href="Cardano.Api.Fees.html#maybeDummyTotalCollAndCollReturnOutput"><span class="hs-identifier hs-var">maybeDummyTotalCollAndCollReturnOutput</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702388"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702389"><span class="hs-identifier hs-var">changeaddr</span></a></span><span>
</span><span id="line-1126"></span><span>            </span><span class="annot"><a href="Cardano.Api.Experimental.Tx.html#UnsignedTx"><span class="hs-identifier hs-type">UnsignedTx</span></a></span><span> </span><span id="local-6989586621681702502"><span class="annot"><span class="annottext">Tx (LedgerEra (ApiEraToExperimentalEra era))
</span><a href="#local-6989586621681702502"><span class="hs-identifier hs-var">txbody1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1127"></span><span>              </span><span class="annot"><span class="annottext">(TxBodyError -&gt; TxBodyErrorAutoBalance era)
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (UnsignedTx (ApiEraToExperimentalEra era))
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; TxBodyErrorAutoBalance era
forall era. TxBodyError -&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyError"><span class="hs-identifier hs-var">TxBodyError</span></a></span><span>
</span><span id="line-1128"></span><span>                </span><span class="annot"><span class="annottext">(Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (UnsignedTx (ApiEraToExperimentalEra era)))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (UnsignedTx (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Era (ApiEraToExperimentalEra era)
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
forall era.
Era era
-&gt; TxBodyContent BuildTx (ExperimentalEraToApiEra era)
-&gt; Either TxBodyError (UnsignedTx era)
</span><a href="Cardano.Api.Experimental.Tx.html#makeUnsignedTx"><span class="hs-identifier hs-var">makeUnsignedTx</span></a></span><span> </span><span class="hs-comment">-- TODO: impossible to fail now</span><span>
</span><span id="line-1129"></span><span>                  </span><span class="annot"><span class="annottext">Era (ApiEraToExperimentalEra era)
</span><a href="#local-6989586621681702453"><span class="hs-identifier hs-var">availableEra</span></a></span><span>
</span><span id="line-1130"></span><span>                </span><span class="annot"><span class="annottext">(TxBodyContent
   BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
 -&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
-&gt; (EraShimConstraints era =&gt;
    TxBodyContent
      BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
forall era a.
BabbageEraOnwards era -&gt; (EraShimConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Experimental.Eras.html#obtainShimConstraints"><span class="hs-identifier hs-var">obtainShimConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702421"><span class="hs-identifier hs-var">bEraOnwards</span></a></span><span>
</span><span id="line-1131"></span><span>                </span><span class="annot"><span class="annottext">((EraShimConstraints era =&gt;
  TxBodyContent
    BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
 -&gt; TxBodyContent
      BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
-&gt; (EraShimConstraints era =&gt;
    TxBodyContent
      BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702474"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span>
</span><span id="line-1132"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txFee"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxFeeExplicit"><span class="hs-identifier hs-type">TxFeeExplicit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702379"><span class="hs-identifier hs-type">sbe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702486"><span class="hs-identifier hs-type">maxLovelaceFee</span></a></span><span>
</span><span id="line-1133"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1134"></span><span>                      </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702389"><span class="hs-identifier hs-type">changeaddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702495"><span class="hs-identifier hs-type">changeTxOut</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-type">TxOutDatumNone</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-type">ReferenceScriptNone</span></a></span><span>
</span><span id="line-1135"></span><span>                        </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702388"><span class="hs-identifier hs-type">txbodycontent</span></a></span><span>
</span><span id="line-1136"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txReturnCollateral"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681702500"><span class="hs-identifier hs-type">dummyCollRet</span></a></span><span>
</span><span id="line-1137"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txTotalCollateral"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681702501"><span class="hs-identifier hs-type">dummyTotColl</span></a></span><span>
</span><span id="line-1138"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-1139"></span><span>            </span><span class="hs-comment">-- NB: This has the potential to over estimate the fees because estimateTransactionKeyWitnessCount</span><span>
</span><span id="line-1140"></span><span>            </span><span class="hs-comment">-- makes the conservative assumption that all inputs are from distinct</span><span>
</span><span id="line-1141"></span><span>            </span><span class="hs-comment">-- addresses.</span><span>
</span><span id="line-1142"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702506"><span class="annot"><span class="annottext">nkeys :: Word
</span><a href="#local-6989586621681702506"><span class="hs-identifier hs-var hs-var">nkeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1143"></span><span>                  </span><span class="annot"><span class="annottext">Word -&gt; Maybe Word -&gt; Word
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span>
</span><span id="line-1144"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; Word
forall era. TxBodyContent BuildTx era -&gt; Word
</span><a href="Cardano.Api.Fees.html#estimateTransactionKeyWitnessCount"><span class="hs-identifier hs-var">estimateTransactionKeyWitnessCount</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702474"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1145"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Word
</span><a href="#local-6989586621681702390"><span class="hs-identifier hs-var">mnkeys</span></a></span><span>
</span><span id="line-1146"></span><span>                </span><span id="local-6989586621681702508"><span class="annot"><span class="annottext">fee :: Coin
</span><a href="#local-6989586621681702508"><span class="hs-identifier hs-var hs-var">fee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1147"></span><span>                  </span><span class="annot"><span class="annottext">BabbageEraOnwards era -&gt; (EraShimConstraints era =&gt; Coin) -&gt; Coin
forall era a.
BabbageEraOnwards era -&gt; (EraShimConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Experimental.Eras.html#obtainShimConstraints"><span class="hs-identifier hs-var">obtainShimConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702421"><span class="hs-identifier hs-var">bEraOnwards</span></a></span><span> </span><span class="annot"><span class="annottext">((EraShimConstraints era =&gt; Coin) -&gt; Coin)
-&gt; (EraShimConstraints era =&gt; Coin) -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1148"></span><span>                    </span><span class="annot"><span class="annottext">UTxO (ShelleyLedgerEra era)
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Tx (ShelleyLedgerEra era)
-&gt; Int
-&gt; Coin
forall era.
EraUTxO era =&gt;
UTxO era -&gt; PParams era -&gt; Tx era -&gt; Int -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Tools.html#calcMinFeeTx"><span class="hs-identifier hs-var">L.calcMinFeeTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; UTxO era -&gt; UTxO (ShelleyLedgerEra era)
forall era.
ShelleyBasedEra era -&gt; UTxO era -&gt; UTxO (ShelleyLedgerEra era)
</span><a href="Cardano.Api.Query.html#toLedgerUTxO"><span class="hs-identifier hs-var">toLedgerUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681702387"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702383"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
Tx (LedgerEra (ApiEraToExperimentalEra era))
</span><a href="#local-6989586621681702502"><span class="hs-identifier hs-var">txbody1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681702506"><span class="hs-identifier hs-var">nkeys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1149"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621681702515"><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702515"><span class="hs-identifier hs-var">retColl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702516"><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702516"><span class="hs-identifier hs-var">reqCol</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1150"></span><span>                  </span><span class="annot"><span class="annottext">(ShelleyToAlonzoEraConstraints era =&gt;
 ShelleyToAlonzoEra era
 -&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era))
-&gt; (BabbageEraOnwardsConstraints era =&gt;
    BabbageEraOnwards era
    -&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era))
-&gt; ShelleyBasedEra era
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
forall era a.
(ShelleyToAlonzoEraConstraints era =&gt; ShelleyToAlonzoEra era -&gt; a)
-&gt; (BabbageEraOnwardsConstraints era =&gt; BabbageEraOnwards era -&gt; a)
-&gt; ShelleyBasedEra era
-&gt; a
</span><a href="Cardano.Api.Eras.Case.html#caseShelleyToAlonzoOrBabbageEraOnwards"><span class="hs-identifier hs-var">caseShelleyToAlonzoOrBabbageEraOnwards</span></a></span><span>
</span><span id="line-1151"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxReturnCollateral CtxTx era, TxTotalCollateral era)
-&gt; ShelleyToAlonzoEra era
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
forall ctx era. TxReturnCollateral ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
forall era. TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1152"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681702525"><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702525"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1153"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702526"><span class="annot"><span class="annottext">collIns :: [TxIn]
</span><a href="#local-6989586621681702526"><span class="hs-identifier hs-var hs-var">collIns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; TxInsCollateral era
forall build era. TxBodyContent build era -&gt; TxInsCollateral era
</span><a href="Cardano.Api.Tx.Body.html#txInsCollateral"><span class="hs-identifier hs-var">txInsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702388"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1154"></span><span>                              </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxInsCollateral"><span class="hs-identifier hs-type">TxInsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681702527"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621681702527"><span class="hs-identifier hs-var">collIns'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621681702527"><span class="hs-identifier hs-var">collIns'</span></a></span><span>
</span><span id="line-1155"></span><span>                              </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxInsCollateralNone"><span class="hs-identifier hs-var">TxInsCollateralNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TxIn]
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-1156"></span><span>                            </span><span id="local-6989586621681702529"><span class="annot"><span class="annottext">collateralOuts :: [TxOut CtxUTxO era]
</span><a href="#local-6989586621681702529"><span class="hs-identifier hs-var hs-var">collateralOuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe (TxOut CtxUTxO era)] -&gt; [TxOut CtxUTxO era]
forall a. [Maybe a] -&gt; [a]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn -&gt; Map TxIn (TxOut CtxUTxO era) -&gt; Maybe (TxOut CtxUTxO era)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681702531"><span class="hs-identifier hs-var">txin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO era -&gt; Map TxIn (TxOut CtxUTxO era)
forall era. UTxO era -&gt; Map TxIn (TxOut CtxUTxO era)
</span><a href="Cardano.Api.Query.html#unUTxO"><span class="hs-identifier hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681702387"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681702531"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681702531"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621681702526"><span class="hs-identifier hs-var">collIns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1157"></span><span>                            </span><span id="local-6989586621681702532"><span class="annot"><span class="annottext">totalPotentialCollateral :: Coin
</span><a href="#local-6989586621681702532"><span class="hs-identifier hs-var hs-var">totalPotentialCollateral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coin] -&gt; Coin
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Coin] -&gt; Coin) -&gt; [Coin] -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO era -&gt; Coin) -&gt; [TxOut CtxUTxO era] -&gt; [Coin]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681702533"><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702533"><span class="hs-identifier hs-var">txOutVal</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxUTxO era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ReferenceScript era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxOutValue era -&gt; Coin
forall era. TxOutValue era -&gt; Coin
</span><a href="Cardano.Api.Tx.Body.html#txOutValueToLovelace"><span class="hs-identifier hs-var">txOutValueToLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702533"><span class="hs-identifier hs-var">txOutVal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxOut CtxUTxO era]
</span><a href="#local-6989586621681702529"><span class="hs-identifier hs-var">collateralOuts</span></a></span><span>
</span><span id="line-1158"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
-&gt; Coin
-&gt; PParams (ShelleyLedgerEra era)
-&gt; TxInsCollateral era
-&gt; TxReturnCollateral CtxTx era
-&gt; TxTotalCollateral era
-&gt; AddressInEra era
-&gt; Coin
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
forall era.
AlonzoEraPParams (ShelleyLedgerEra era) =&gt;
BabbageEraOnwards era
-&gt; Coin
-&gt; PParams (ShelleyLedgerEra era)
-&gt; TxInsCollateral era
-&gt; TxReturnCollateral CtxTx era
-&gt; TxTotalCollateral era
-&gt; AddressInEra era
-&gt; Coin
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
</span><a href="Cardano.Api.Fees.html#calcReturnAndTotalCollateral"><span class="hs-identifier hs-var">calcReturnAndTotalCollateral</span></a></span><span>
</span><span id="line-1159"></span><span>                              </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702525"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1160"></span><span>                              </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702508"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-1161"></span><span>                              </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702383"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1162"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; TxInsCollateral era
forall build era. TxBodyContent build era -&gt; TxInsCollateral era
</span><a href="Cardano.Api.Tx.Body.html#txInsCollateral"><span class="hs-identifier hs-var">txInsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702388"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1163"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; TxReturnCollateral CtxTx era
forall build era.
TxBodyContent build era -&gt; TxReturnCollateral CtxTx era
</span><a href="Cardano.Api.Tx.Body.html#txReturnCollateral"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702388"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1164"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; TxTotalCollateral era
forall build era. TxBodyContent build era -&gt; TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#txTotalCollateral"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702388"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1165"></span><span>                              </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702389"><span class="hs-identifier hs-var">changeaddr</span></a></span><span>
</span><span id="line-1166"></span><span>                              </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702532"><span class="hs-identifier hs-var">totalPotentialCollateral</span></a></span><span>
</span><span id="line-1167"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-1168"></span><span>                    </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-1169"></span><span>
</span><span id="line-1170"></span><span>            </span><span class="hs-comment">-- Make a txbody for calculating the balance. For this the size of the tx</span><span>
</span><span id="line-1171"></span><span>            </span><span class="hs-comment">-- does not matter, instead it's just the values of the fee and outputs.</span><span>
</span><span id="line-1172"></span><span>            </span><span class="hs-comment">-- Here we do not want to start with any change output, since that's what</span><span>
</span><span id="line-1173"></span><span>            </span><span class="hs-comment">-- we need to calculate.</span><span>
</span><span id="line-1174"></span><span>            </span><span class="annot"><a href="Cardano.Api.Experimental.Tx.html#UnsignedTx"><span class="hs-identifier hs-type">UnsignedTx</span></a></span><span> </span><span id="local-6989586621681702535"><span class="annot"><span class="annottext">Tx (LedgerEra (ApiEraToExperimentalEra era))
</span><a href="#local-6989586621681702535"><span class="hs-identifier hs-var">txbody2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1175"></span><span>              </span><span class="annot"><span class="annottext">(TxBodyError -&gt; TxBodyErrorAutoBalance era)
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (UnsignedTx (ApiEraToExperimentalEra era))
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; TxBodyErrorAutoBalance era
forall era. TxBodyError -&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyError"><span class="hs-identifier hs-var">TxBodyError</span></a></span><span>
</span><span id="line-1176"></span><span>                </span><span class="annot"><span class="annottext">(Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (UnsignedTx (ApiEraToExperimentalEra era)))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (UnsignedTx (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Era (ApiEraToExperimentalEra era)
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
forall era.
Era era
-&gt; TxBodyContent BuildTx (ExperimentalEraToApiEra era)
-&gt; Either TxBodyError (UnsignedTx era)
</span><a href="Cardano.Api.Experimental.Tx.html#makeUnsignedTx"><span class="hs-identifier hs-var">makeUnsignedTx</span></a></span><span> </span><span class="hs-comment">-- TODO: impossible to fail now</span><span>
</span><span id="line-1177"></span><span>                  </span><span class="annot"><span class="annottext">Era (ApiEraToExperimentalEra era)
</span><a href="#local-6989586621681702453"><span class="hs-identifier hs-var">availableEra</span></a></span><span>
</span><span id="line-1178"></span><span>                </span><span class="annot"><span class="annottext">(TxBodyContent
   BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
 -&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
-&gt; (EraShimConstraints era =&gt;
    TxBodyContent
      BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
forall era a.
BabbageEraOnwards era -&gt; (EraShimConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Experimental.Eras.html#obtainShimConstraints"><span class="hs-identifier hs-var">obtainShimConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702421"><span class="hs-identifier hs-var">bEraOnwards</span></a></span><span>
</span><span id="line-1179"></span><span>                </span><span class="annot"><span class="annottext">((EraShimConstraints era =&gt;
  TxBodyContent
    BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
 -&gt; TxBodyContent
      BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
-&gt; (EraShimConstraints era =&gt;
    TxBodyContent
      BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702474"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span>
</span><span id="line-1180"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txFee"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxFeeExplicit"><span class="hs-identifier hs-type">TxFeeExplicit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702379"><span class="hs-identifier hs-type">sbe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702508"><span class="hs-identifier hs-type">fee</span></a></span><span>
</span><span id="line-1181"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txReturnCollateral"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681702515"><span class="hs-identifier hs-type">retColl</span></a></span><span>
</span><span id="line-1182"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txTotalCollateral"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681702516"><span class="hs-identifier hs-type">reqCol</span></a></span><span>
</span><span id="line-1183"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-1184"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702539"><span class="annot"><span class="annottext">balance :: TxOutValue era
</span><a href="#local-6989586621681702539"><span class="hs-identifier hs-var hs-var">balance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1185"></span><span>                  </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
forall era.
(Eq (Value (ShelleyLedgerEra era)),
 Show (Value (ShelleyLedgerEra era))) =&gt;
ShelleyBasedEra era
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
</span><a href="Cardano.Api.Tx.Body.html#TxOutValueShelleyBased"><span class="hs-identifier hs-var">TxOutValueShelleyBased</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">(Value (ShelleyLedgerEra era) -&gt; TxOutValue era)
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1186"></span><span>                    </span><span class="annot"><span class="annottext">BabbageEraOnwards era
-&gt; (EraShimConstraints era =&gt; Value (ShelleyLedgerEra era))
-&gt; Value (ShelleyLedgerEra era)
forall era a.
BabbageEraOnwards era -&gt; (EraShimConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Experimental.Eras.html#obtainShimConstraints"><span class="hs-identifier hs-var">obtainShimConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702421"><span class="hs-identifier hs-var">bEraOnwards</span></a></span><span> </span><span class="annot"><span class="annottext">((EraShimConstraints era =&gt; Value (ShelleyLedgerEra era))
 -&gt; Value (ShelleyLedgerEra era))
-&gt; (EraShimConstraints era =&gt; Value (ShelleyLedgerEra era))
-&gt; Value (ShelleyLedgerEra era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1187"></span><span>                      </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
-&gt; (Credential 'Staking (EraCrypto (ShelleyLedgerEra era))
    -&gt; Maybe Coin)
-&gt; (Credential 'DRepRole (EraCrypto (ShelleyLedgerEra era))
    -&gt; Maybe Coin)
-&gt; (KeyHash 'StakePool (EraCrypto (ShelleyLedgerEra era)) -&gt; Bool)
-&gt; UTxO (ShelleyLedgerEra era)
-&gt; TxBody (ShelleyLedgerEra era)
-&gt; Value (ShelleyLedgerEra era)
forall era.
EraUTxO era =&gt;
PParams era
-&gt; (Credential 'Staking (EraCrypto era) -&gt; Maybe Coin)
-&gt; (Credential 'DRepRole (EraCrypto era) -&gt; Maybe Coin)
-&gt; (KeyHash 'StakePool (EraCrypto era) -&gt; Bool)
-&gt; UTxO era
-&gt; TxBody era
-&gt; Value era
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-api-1.9.2.1-4844a0255d7b8fb2f0d16eaff712596a0ef2d0d592972f20c030f33c676c47ab/share/doc/html/src/Cardano.Ledger.Api.Tx.Body.html#evalBalanceTxBody"><span class="hs-identifier hs-var">L.evalBalanceTxBody</span></a></span><span>
</span><span id="line-1188"></span><span>                        </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702383"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1189"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map StakeCredential Coin
-&gt; Credential 'Staking StandardCrypto -&gt; Maybe Coin
</span><a href="Cardano.Api.Fees.html#lookupDelegDeposit"><span class="hs-identifier hs-var">lookupDelegDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">Map StakeCredential Coin
</span><a href="#local-6989586621681702385"><span class="hs-identifier hs-var">stakeDelegDeposits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
-&gt; Credential 'DRepRole StandardCrypto -&gt; Maybe Coin
</span><a href="Cardano.Api.Fees.html#lookupDRepDeposit"><span class="hs-identifier hs-var">lookupDRepDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'DRepRole StandardCrypto) Coin
</span><a href="#local-6989586621681702386"><span class="hs-identifier hs-var">drepDelegDeposits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1191"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
-&gt; KeyHash 'StakePool StandardCrypto -&gt; Bool
</span><a href="Cardano.Api.Fees.html#isRegPool"><span class="hs-identifier hs-var">isRegPool</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Hash StakePoolKey)
</span><a href="#local-6989586621681702384"><span class="hs-identifier hs-var">poolids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; UTxO era -&gt; UTxO (ShelleyLedgerEra era)
forall era.
ShelleyBasedEra era -&gt; UTxO era -&gt; UTxO (ShelleyLedgerEra era)
</span><a href="Cardano.Api.Query.html#toLedgerUTxO"><span class="hs-identifier hs-var">toLedgerUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621681702387"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1193"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
Tx (LedgerEra (ApiEraToExperimentalEra era))
</span><a href="#local-6989586621681702535"><span class="hs-identifier hs-var">txbody2</span></a></span><span> </span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra era)
-&gt; Getting
     (TxBody (ShelleyLedgerEra era))
     (Tx (ShelleyLedgerEra era))
     (TxBody (ShelleyLedgerEra era))
-&gt; TxBody (ShelleyLedgerEra era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (TxBody (ShelleyLedgerEra era))
  (Tx (ShelleyLedgerEra era))
  (TxBody (ShelleyLedgerEra era))
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx (ShelleyLedgerEra era)) (TxBody (ShelleyLedgerEra era))
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">L.bodyTxL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1194"></span><span>
</span><span id="line-1195"></span><span>            </span><span class="annot"><span class="annottext">[TxOut CtxTx era]
-&gt; (TxOut CtxTx era -&gt; Either (TxBodyErrorAutoBalance era) ())
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; [TxOut CtxTx era]
forall build era. TxBodyContent build era -&gt; [TxOut CtxTx era]
</span><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702474"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TxOut CtxTx era -&gt; Either (TxBodyErrorAutoBalance era) ())
 -&gt; Either (TxBodyErrorAutoBalance era) ())
-&gt; (TxOut CtxTx era -&gt; Either (TxBodyErrorAutoBalance era) ())
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681702547"><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621681702547"><span class="hs-identifier hs-var">txout</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxOut CtxTx era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall era.
ShelleyBasedEra era
-&gt; TxOut CtxTx era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Either (TxBodyErrorAutoBalance era) ()
</span><a href="Cardano.Api.Fees.html#checkMinUTxOValue"><span class="hs-identifier hs-var">checkMinUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621681702547"><span class="hs-identifier hs-var">txout</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702383"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-1196"></span><span>
</span><span id="line-1197"></span><span>            </span><span class="hs-comment">-- check if the balance is positive or negative</span><span>
</span><span id="line-1198"></span><span>            </span><span class="hs-comment">-- in one case we can produce change, in the other the inputs are insufficient</span><span>
</span><span id="line-1199"></span><span>            </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; AddressInEra era
-&gt; TxOutValue era
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall era.
ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; AddressInEra era
-&gt; TxOutValue era
-&gt; Either (TxBodyErrorAutoBalance era) ()
</span><a href="Cardano.Api.Fees.html#balanceCheck"><span class="hs-identifier hs-var">balanceCheck</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702383"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702389"><span class="hs-identifier hs-var">changeaddr</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702539"><span class="hs-identifier hs-var">balance</span></a></span><span>
</span><span id="line-1200"></span><span>
</span><span id="line-1201"></span><span>            </span><span class="hs-comment">-- TODO: we could add the extra fee for the CBOR encoding of the change,</span><span>
</span><span id="line-1202"></span><span>            </span><span class="hs-comment">-- now that we know the magnitude of the change: i.e. 1-8 bytes extra.</span><span>
</span><span id="line-1203"></span><span>
</span><span id="line-1204"></span><span>            </span><span class="hs-comment">-- The txbody with the final fee and change output. This should work</span><span>
</span><span id="line-1205"></span><span>            </span><span class="hs-comment">-- provided that the fee and change are less than 2^32-1, and so will</span><span>
</span><span id="line-1206"></span><span>            </span><span class="hs-comment">-- fit within the encoding size we picked above when calculating the fee.</span><span>
</span><span id="line-1207"></span><span>            </span><span class="hs-comment">-- Yes this could be an over-estimate by a few bytes if the fee or change</span><span>
</span><span id="line-1208"></span><span>            </span><span class="hs-comment">-- would fit within 2^16-1. That's a possible optimisation.</span><span>
</span><span id="line-1209"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702548"><span class="annot"><span class="annottext">finalTxBodyContent :: TxBodyContent BuildTx era
</span><a href="#local-6989586621681702548"><span class="hs-identifier hs-var hs-var">finalTxBodyContent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1210"></span><span>                  </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702474"><span class="hs-identifier hs-var">txbodycontent1</span></a></span><span>
</span><span id="line-1211"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txFee"><span class="hs-identifier hs-var">txFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxFeeExplicit"><span class="hs-identifier hs-type">TxFeeExplicit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702379"><span class="hs-identifier hs-type">sbe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702508"><span class="hs-identifier hs-type">fee</span></a></span><span>
</span><span id="line-1212"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1213"></span><span>                        </span><span class="annot"><a href="Cardano.Api.Fees.html#accountForNoChange"><span class="hs-identifier hs-type">accountForNoChange</span></a></span><span>
</span><span id="line-1214"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702389"><span class="hs-identifier hs-type">changeaddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702539"><span class="hs-identifier hs-type">balance</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-type">TxOutDatumNone</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-type">ReferenceScriptNone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1215"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681702388"><span class="hs-identifier hs-type">txbodycontent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txReturnCollateral"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681702515"><span class="hs-identifier hs-type">retColl</span></a></span><span>
</span><span id="line-1217"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#txTotalCollateral"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681702516"><span class="hs-identifier hs-type">reqCol</span></a></span><span>
</span><span id="line-1218"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-1219"></span><span>            </span><span id="local-6989586621681702549"><span class="annot"><span class="annottext">UnsignedTx (ApiEraToExperimentalEra era)
</span><a href="#local-6989586621681702549"><span class="hs-identifier hs-var">txbody3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1220"></span><span>              </span><span class="annot"><span class="annottext">(TxBodyError -&gt; TxBodyErrorAutoBalance era)
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (UnsignedTx (ApiEraToExperimentalEra era))
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; TxBodyErrorAutoBalance era
forall era. TxBodyError -&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyError"><span class="hs-identifier hs-var">TxBodyError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (UnsignedTx (ApiEraToExperimentalEra era)))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (UnsignedTx (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- TODO: impossible to fail now. We need to implement a function</span><span>
</span><span id="line-1221"></span><span>              </span><span class="hs-comment">-- that simply creates a transaction body because we have already</span><span>
</span><span id="line-1222"></span><span>              </span><span class="hs-comment">-- validated the transaction body earlier within makeTransactionBodyAutoBalance</span><span>
</span><span id="line-1223"></span><span>                </span><span class="annot"><span class="annottext">Era (ApiEraToExperimentalEra era)
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
forall era.
Era era
-&gt; TxBodyContent BuildTx (ExperimentalEraToApiEra era)
-&gt; Either TxBodyError (UnsignedTx era)
</span><a href="Cardano.Api.Experimental.Tx.html#makeUnsignedTx"><span class="hs-identifier hs-var">makeUnsignedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Era (ApiEraToExperimentalEra era)
</span><a href="#local-6989586621681702453"><span class="hs-identifier hs-var">availableEra</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent
   BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
 -&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
-&gt; Either TxBodyError (UnsignedTx (ApiEraToExperimentalEra era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1224"></span><span>                  </span><span class="annot"><span class="annottext">BabbageEraOnwards era
-&gt; (EraShimConstraints era =&gt;
    TxBodyContent
      BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era)))
-&gt; TxBodyContent
     BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
forall era a.
BabbageEraOnwards era -&gt; (EraShimConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Experimental.Eras.html#obtainShimConstraints"><span class="hs-identifier hs-var">obtainShimConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702421"><span class="hs-identifier hs-var">bEraOnwards</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
TxBodyContent
  BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
EraShimConstraints era =&gt;
TxBodyContent
  BuildTx (ExperimentalEraToApiEra (ApiEraToExperimentalEra era))
</span><a href="#local-6989586621681702548"><span class="hs-identifier hs-var">finalTxBodyContent</span></a></span><span>
</span><span id="line-1225"></span><span>            </span><span class="annot"><span class="annottext">BalancedTxBody era
-&gt; Either (TxBodyErrorAutoBalance era) (BalancedTxBody era)
forall a. a -&gt; Either (TxBodyErrorAutoBalance era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-1226"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
-&gt; UnsignedTx (ApiEraToExperimentalEra era)
-&gt; TxOut CtxTx era
-&gt; Coin
-&gt; BalancedTxBody era
forall era.
TxBodyContent BuildTx era
-&gt; UnsignedTx (ApiEraToExperimentalEra era)
-&gt; TxOut CtxTx era
-&gt; Coin
-&gt; BalancedTxBody era
</span><a href="Cardano.Api.Fees.html#BalancedTxBody"><span class="hs-identifier hs-var">BalancedTxBody</span></a></span><span>
</span><span id="line-1227"></span><span>                  </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702548"><span class="hs-identifier hs-var">finalTxBodyContent</span></a></span><span>
</span><span id="line-1228"></span><span>                  </span><span class="annot"><span class="annottext">UnsignedTx (ApiEraToExperimentalEra era)
</span><a href="#local-6989586621681702549"><span class="hs-identifier hs-var">txbody3</span></a></span><span>
</span><span id="line-1229"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum CtxTx era
-&gt; ReferenceScript era
-&gt; TxOut CtxTx era
forall ctx era.
AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum ctx era
-&gt; ReferenceScript era
-&gt; TxOut ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702389"><span class="hs-identifier hs-var">changeaddr</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702539"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
forall ctx era. TxOutDatum ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-var">TxOutDatumNone</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript era
forall era. ReferenceScript era
</span><a href="Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-var">ReferenceScriptNone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1230"></span><span>                  </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702508"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-1231"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-1232"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-1233"></span><span>      </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702379"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-1234"></span><span>
</span><span id="line-1235"></span><span class="hs-comment">-- | In the event of spending the exact amount of lovelace in</span><span>
</span><span id="line-1236"></span><span class="hs-comment">-- the specified input(s), this function excludes the change</span><span>
</span><span id="line-1237"></span><span class="hs-comment">-- output. Note that this does not save any fees because by default</span><span>
</span><span id="line-1238"></span><span class="hs-comment">-- the fee calculation includes a change address for simplicity and</span><span>
</span><span id="line-1239"></span><span class="hs-comment">-- we make no attempt to recalculate the tx fee without a change address.</span><span>
</span><span id="line-1240"></span><span id="local-6989586621681700960"><span class="annot"><a href="Cardano.Api.Fees.html#accountForNoChange"><span class="hs-identifier hs-type">accountForNoChange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxTx"><span class="hs-identifier hs-type">CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700960"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxTx"><span class="hs-identifier hs-type">CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700960"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxTx"><span class="hs-identifier hs-type">CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700960"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1241"></span><span id="accountForNoChange"><span class="annot"><span class="annottext">accountForNoChange :: forall era.
TxOut CtxTx era -&gt; [TxOut CtxTx era] -&gt; [TxOut CtxTx era]
</span><a href="Cardano.Api.Fees.html#accountForNoChange"><span class="hs-identifier hs-var hs-var">accountForNoChange</span></a></span></span><span> </span><span id="local-6989586621681702556"><span class="annot"><span class="annottext">change :: TxOut CtxTx era
</span><a href="#local-6989586621681702556"><span class="hs-identifier hs-var">change</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681702557"><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702557"><span class="hs-identifier hs-var">balance</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ReferenceScript era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681702558"><span class="annot"><span class="annottext">[TxOut CtxTx era]
</span><a href="#local-6989586621681702558"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1242"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxOutValue era -&gt; Coin
forall era. TxOutValue era -&gt; Coin
</span><a href="Cardano.Api.Tx.Body.html#txOutValueToLovelace"><span class="hs-identifier hs-var">txOutValueToLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702557"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1243"></span><span>    </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx era]
</span><a href="#local-6989586621681702558"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-1244"></span><span>    </span><span class="hs-comment">-- We append change at the end so a client can predict the indexes</span><span>
</span><span id="line-1245"></span><span>    </span><span class="hs-comment">-- of the outputs</span><span>
</span><span id="line-1246"></span><span>    </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx era]
</span><a href="#local-6989586621681702558"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx era] -&gt; [TxOut CtxTx era] -&gt; [TxOut CtxTx era]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621681702556"><span class="hs-identifier hs-var">change</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1247"></span><span>
</span><span id="line-1248"></span><span id="local-6989586621681700959"><span class="annot"><a href="Cardano.Api.Fees.html#checkMinUTxOValue"><span class="hs-identifier hs-type">checkMinUTxOValue</span></a></span><span>
</span><span id="line-1249"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700959"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1250"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxTx"><span class="hs-identifier hs-type">CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700959"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1251"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">Ledger.PParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700959"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1252"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700959"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1253"></span><span id="checkMinUTxOValue"><span class="annot"><span class="annottext">checkMinUTxOValue :: forall era.
ShelleyBasedEra era
-&gt; TxOut CtxTx era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Either (TxBodyErrorAutoBalance era) ()
</span><a href="Cardano.Api.Fees.html#checkMinUTxOValue"><span class="hs-identifier hs-var hs-var">checkMinUTxOValue</span></a></span></span><span> </span><span id="local-6989586621681702562"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702562"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681702563"><span class="annot"><span class="annottext">txout :: TxOut CtxTx era
</span><a href="#local-6989586621681702563"><span class="hs-identifier hs-var">txout</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681702564"><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702564"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ReferenceScript era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681702565"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702565"><span class="hs-identifier hs-var">bpp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1254"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702566"><span class="annot"><span class="annottext">minUTxO :: Coin
</span><a href="#local-6989586621681702566"><span class="hs-identifier hs-var hs-var">minUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxOut CtxTx era -&gt; PParams (ShelleyLedgerEra era) -&gt; Coin
forall era.
ShelleyBasedEra era
-&gt; TxOut CtxTx era -&gt; PParams (ShelleyLedgerEra era) -&gt; Coin
</span><a href="Cardano.Api.Fees.html#calculateMinimumUTxO"><span class="hs-identifier hs-var">calculateMinimumUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702562"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621681702563"><span class="hs-identifier hs-var">txout</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702565"><span class="hs-identifier hs-var">bpp</span></a></span><span>
</span><span id="line-1255"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TxOutValue era -&gt; Coin
forall era. TxOutValue era -&gt; Coin
</span><a href="Cardano.Api.Tx.Body.html#txOutValueToLovelace"><span class="hs-identifier hs-var">txOutValueToLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702564"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702566"><span class="hs-identifier hs-var">minUTxO</span></a></span><span>
</span><span id="line-1256"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; Either (TxBodyErrorAutoBalance era) ()
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1257"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyErrorAutoBalance era
 -&gt; Either (TxBodyErrorAutoBalance era) ())
-&gt; TxBodyErrorAutoBalance era
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutInAnyEra -&gt; Coin -&gt; TxBodyErrorAutoBalance era
forall era. TxOutInAnyEra -&gt; Coin -&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyErrorMinUTxONotMet"><span class="hs-identifier hs-var">TxBodyErrorMinUTxONotMet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoEra era -&gt; TxOut CtxTx era -&gt; TxOutInAnyEra
forall era. CardanoEra era -&gt; TxOut CtxTx era -&gt; TxOutInAnyEra
</span><a href="Cardano.Api.Tx.Body.html#txOutInAnyEra"><span class="hs-identifier hs-var">txOutInAnyEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; CardanoEra era
forall era. ShelleyBasedEra era -&gt; CardanoEra era
forall (eon :: * -&gt; *) era.
ToCardanoEra eon =&gt;
eon era -&gt; CardanoEra era
</span><a href="Cardano.Api.Eras.Core.html#toCardanoEra"><span class="hs-identifier hs-var">toCardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702562"><span class="hs-identifier hs-var">sbe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621681702563"><span class="hs-identifier hs-var">txout</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702566"><span class="hs-identifier hs-var">minUTxO</span></a></span><span>
</span><span id="line-1258"></span><span>
</span><span id="line-1259"></span><span id="local-6989586621681700954"><span class="annot"><a href="Cardano.Api.Fees.html#balanceCheck"><span class="hs-identifier hs-type">balanceCheck</span></a></span><span>
</span><span id="line-1260"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700954"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1261"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">Ledger.PParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700954"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1262"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#AddressInEra"><span class="hs-identifier hs-type">AddressInEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700954"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1263"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutValue"><span class="hs-identifier hs-type">TxOutValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700954"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1264"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700954"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1265"></span><span id="balanceCheck"><span class="annot"><span class="annottext">balanceCheck :: forall era.
ShelleyBasedEra era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; AddressInEra era
-&gt; TxOutValue era
-&gt; Either (TxBodyErrorAutoBalance era) ()
</span><a href="Cardano.Api.Fees.html#balanceCheck"><span class="hs-identifier hs-var hs-var">balanceCheck</span></a></span></span><span> </span><span id="local-6989586621681702574"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702574"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681702575"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702575"><span class="hs-identifier hs-var">bpparams</span></a></span></span><span> </span><span id="local-6989586621681702576"><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702576"><span class="hs-identifier hs-var">changeaddr</span></a></span></span><span> </span><span id="local-6989586621681702577"><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702577"><span class="hs-identifier hs-var">balance</span></a></span></span><span>
</span><span id="line-1266"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TxOutValue era -&gt; Coin
forall era. TxOutValue era -&gt; Coin
</span><a href="Cardano.Api.Tx.Body.html#txOutValueToLovelace"><span class="hs-identifier hs-var">txOutValueToLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702577"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Bool
</span><a href="Cardano.Api.Fees.html#onlyAda"><span class="hs-identifier hs-var">onlyAda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutValue era -&gt; Value
forall era. TxOutValue era -&gt; Value
</span><a href="Cardano.Api.Tx.Body.html#txOutValueToValue"><span class="hs-identifier hs-var">txOutValueToValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702577"><span class="hs-identifier hs-var">balance</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Either (TxBodyErrorAutoBalance era) ()
forall a. a -&gt; Either (TxBodyErrorAutoBalance era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1267"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TxOutValue era -&gt; Coin
forall era. TxOutValue era -&gt; Coin
</span><a href="Cardano.Api.Tx.Body.html#txOutValueToLovelace"><span class="hs-identifier hs-var">txOutValueToLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702577"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1268"></span><span>      </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyErrorAutoBalance era
 -&gt; Either (TxBodyErrorAutoBalance era) ())
-&gt; (Coin -&gt; TxBodyErrorAutoBalance era)
-&gt; Coin
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; TxBodyErrorAutoBalance era
forall era. Coin -&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyErrorAdaBalanceNegative"><span class="hs-identifier hs-var">TxBodyErrorAdaBalanceNegative</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Either (TxBodyErrorAutoBalance era) ())
-&gt; Coin -&gt; Either (TxBodyErrorAutoBalance era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era -&gt; Coin
forall era. TxOutValue era -&gt; Coin
</span><a href="Cardano.Api.Tx.Body.html#txOutValueToLovelace"><span class="hs-identifier hs-var">txOutValueToLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702577"><span class="hs-identifier hs-var">balance</span></a></span><span>
</span><span id="line-1269"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1270"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxOut CtxTx era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall era.
ShelleyBasedEra era
-&gt; TxOut CtxTx era
-&gt; PParams (ShelleyLedgerEra era)
-&gt; Either (TxBodyErrorAutoBalance era) ()
</span><a href="Cardano.Api.Fees.html#checkMinUTxOValue"><span class="hs-identifier hs-var">checkMinUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702574"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum CtxTx era
-&gt; ReferenceScript era
-&gt; TxOut CtxTx era
forall ctx era.
AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum ctx era
-&gt; ReferenceScript era
-&gt; TxOut ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702576"><span class="hs-identifier hs-var">changeaddr</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702577"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
forall ctx era. TxOutDatum ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-var">TxOutDatumNone</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript era
forall era. ReferenceScript era
</span><a href="Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-var">ReferenceScriptNone</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702575"><span class="hs-identifier hs-var">bpparams</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1271"></span><span>        </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorMinUTxONotMet"><span class="hs-identifier hs-type">TxBodyErrorMinUTxONotMet</span></a></span><span> </span><span id="local-6989586621681702582"><span class="annot"><span class="annottext">TxOutInAnyEra
</span><a href="#local-6989586621681702582"><span class="hs-identifier hs-var">txOutAny</span></a></span></span><span> </span><span id="local-6989586621681702583"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702583"><span class="hs-identifier hs-var">minUTxO</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1272"></span><span>          </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyErrorAutoBalance era
 -&gt; Either (TxBodyErrorAutoBalance era) ())
-&gt; TxBodyErrorAutoBalance era
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutInAnyEra -&gt; Coin -&gt; Coin -&gt; TxBodyErrorAutoBalance era
forall era.
TxOutInAnyEra -&gt; Coin -&gt; Coin -&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyErrorAdaBalanceTooSmall"><span class="hs-identifier hs-var">TxBodyErrorAdaBalanceTooSmall</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutInAnyEra
</span><a href="#local-6989586621681702582"><span class="hs-identifier hs-var">txOutAny</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702583"><span class="hs-identifier hs-var">minUTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutValue era -&gt; Coin
forall era. TxOutValue era -&gt; Coin
</span><a href="Cardano.Api.Tx.Body.html#txOutValueToLovelace"><span class="hs-identifier hs-var">txOutValueToLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621681702577"><span class="hs-identifier hs-var">balance</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1273"></span><span>        </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681702584"><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681702584"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either (TxBodyErrorAutoBalance era) ()
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681702584"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1274"></span><span>        </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Either (TxBodyErrorAutoBalance era) ()
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1275"></span><span>
</span><span id="line-1276"></span><span class="annot"><a href="Cardano.Api.Fees.html#isNotAda"><span class="hs-identifier hs-type">isNotAda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Value.html#AssetId"><span class="hs-identifier hs-type">AssetId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1277"></span><span id="isNotAda"><span class="annot"><span class="annottext">isNotAda :: AssetId -&gt; Bool
</span><a href="Cardano.Api.Fees.html#isNotAda"><span class="hs-identifier hs-var hs-var">isNotAda</span></a></span></span><span> </span><span class="annot"><span class="annottext">AssetId
</span><a href="Cardano.Api.Value.html#AdaAssetId"><span class="hs-identifier hs-var">AdaAssetId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1278"></span><span class="annot"><a href="Cardano.Api.Fees.html#isNotAda"><span class="hs-identifier hs-var">isNotAda</span></a></span><span> </span><span class="annot"><span class="annottext">AssetId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1279"></span><span>
</span><span id="line-1280"></span><span class="annot"><a href="Cardano.Api.Fees.html#onlyAda"><span class="hs-identifier hs-type">onlyAda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1281"></span><span id="onlyAda"><span class="annot"><span class="annottext">onlyAda :: Value -&gt; Bool
</span><a href="Cardano.Api.Fees.html#onlyAda"><span class="hs-identifier hs-var hs-var">onlyAda</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, Quantity)] -&gt; Bool)
-&gt; (Value -&gt; [(AssetId, Quantity)]) -&gt; Value -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; [(AssetId, Quantity)]
</span><a href="Cardano.Api.Value.html#valueToList"><span class="hs-identifier hs-var">valueToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [(AssetId, Quantity)])
-&gt; (Value -&gt; Value) -&gt; Value -&gt; [(AssetId, Quantity)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetId -&gt; Bool) -&gt; Value -&gt; Value
</span><a href="Cardano.Api.Value.html#filterValue"><span class="hs-identifier hs-var">filterValue</span></a></span><span> </span><span class="annot"><span class="annottext">AssetId -&gt; Bool
</span><a href="Cardano.Api.Fees.html#isNotAda"><span class="hs-identifier hs-var">isNotAda</span></a></span><span>
</span><span id="line-1282"></span><span>
</span><span id="line-1283"></span><span id="local-6989586621681701198"><span id="local-6989586621681701199"><span class="annot"><a href="Cardano.Api.Fees.html#calculateIncomingUTxOValue"><span class="hs-identifier hs-type">calculateIncomingUTxOValue</span></a></span><span>
</span><span id="line-1284"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#Monoid"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.html#Value"><span class="hs-identifier hs-type">Ledger.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701198"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701199"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701198"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.html#Value"><span class="hs-identifier hs-type">Ledger.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701198"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1286"></span><span id="calculateIncomingUTxOValue"><span class="annot"><span class="annottext">calculateIncomingUTxOValue :: forall era ctx.
Monoid (Value (ShelleyLedgerEra era)) =&gt;
[TxOut ctx era] -&gt; Value (ShelleyLedgerEra era)
</span><a href="Cardano.Api.Fees.html#calculateIncomingUTxOValue"><span class="hs-identifier hs-var hs-var">calculateIncomingUTxOValue</span></a></span></span><span> </span><span id="local-6989586621681702591"><span class="annot"><span class="annottext">[TxOut ctx era]
</span><a href="#local-6989586621681702591"><span class="hs-identifier hs-var">providedUtxoOuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1287"></span><span>  </span><span class="annot"><span class="annottext">[Value (ShelleyLedgerEra era)] -&gt; Value (ShelleyLedgerEra era)
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Value (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702592"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutValueShelleyBased"><span class="hs-identifier hs-type">TxOutValueShelleyBased</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681702592"><span class="annot"><span class="annottext">Value (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702592"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOutDatum ctx era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ReferenceScript era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TxOut ctx era]
</span><a href="#local-6989586621681702591"><span class="hs-identifier hs-var">providedUtxoOuts</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1288"></span><span>
</span><span id="line-1289"></span><span class="hs-comment">-- Calculation taken from validateInsufficientCollateral: https://github.com/input-output-hk/cardano-ledger/blob/389b266d6226dedf3d2aec7af640b3ca4984c5ea/eras/alonzo/impl/src/Cardano/Ledger/Alonzo/Rules/Utxo.hs#L335</span><span>
</span><span id="line-1290"></span><span class="hs-comment">-- TODO: Bug Jared to expose a function from the ledger that returns total and return collateral.</span><span>
</span><span id="line-1291"></span><span id="local-6989586621681700945"><span class="annot"><a href="Cardano.Api.Fees.html#calcReturnAndTotalCollateral"><span class="hs-identifier hs-type">calcReturnAndTotalCollateral</span></a></span><span>
</span><span id="line-1292"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1293"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.PParams.html#AlonzoEraPParams"><span class="hs-identifier hs-type">Ledger.AlonzoEraPParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700945"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1294"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.BabbageEraOnwards.html#BabbageEraOnwards"><span class="hs-identifier hs-type">BabbageEraOnwards</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700945"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1295"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-1296"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Fee</span></span><span>
</span><span id="line-1297"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">Ledger.PParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700945"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1298"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxInsCollateral"><span class="hs-identifier hs-type">TxInsCollateral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700945"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1299"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ From the initial TxBodyContent</span></span><span>
</span><span id="line-1300"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxReturnCollateral"><span class="hs-identifier hs-type">TxReturnCollateral</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxTx"><span class="hs-identifier hs-type">CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700945"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1301"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ From the initial TxBodyContent</span></span><span>
</span><span id="line-1302"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxTotalCollateral"><span class="hs-identifier hs-type">TxTotalCollateral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700945"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1303"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ From the initial TxBodyContent</span></span><span>
</span><span id="line-1304"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#AddressInEra"><span class="hs-identifier hs-type">AddressInEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700945"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1305"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Change address</span></span><span>
</span><span id="line-1306"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-1307"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Total available collateral in lovelace</span></span><span>
</span><span id="line-1308"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxReturnCollateral"><span class="hs-identifier hs-type">TxReturnCollateral</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxTx"><span class="hs-identifier hs-type">CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700945"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxTotalCollateral"><span class="hs-identifier hs-type">TxTotalCollateral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700945"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1309"></span><span id="calcReturnAndTotalCollateral"><span class="annot"><span class="annottext">calcReturnAndTotalCollateral :: forall era.
AlonzoEraPParams (ShelleyLedgerEra era) =&gt;
BabbageEraOnwards era
-&gt; Coin
-&gt; PParams (ShelleyLedgerEra era)
-&gt; TxInsCollateral era
-&gt; TxReturnCollateral CtxTx era
-&gt; TxTotalCollateral era
-&gt; AddressInEra era
-&gt; Coin
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
</span><a href="Cardano.Api.Fees.html#calcReturnAndTotalCollateral"><span class="hs-identifier hs-var hs-var">calcReturnAndTotalCollateral</span></a></span></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxInsCollateralNone"><span class="hs-identifier hs-var">TxInsCollateralNone</span></a></span><span> </span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
forall ctx era. TxReturnCollateral ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
forall era. TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1310"></span><span class="annot"><a href="Cardano.Api.Fees.html#calcReturnAndTotalCollateral"><span class="hs-identifier hs-var">calcReturnAndTotalCollateral</span></a></span><span> </span><span id="local-6989586621681702612"><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702612"><span class="hs-identifier hs-var">retColSup</span></a></span></span><span> </span><span id="local-6989586621681702613"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702613"><span class="hs-identifier hs-var">fee</span></a></span></span><span> </span><span id="local-6989586621681702614"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702614"><span class="hs-identifier hs-var">pp'</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxInsCollateral"><span class="hs-identifier hs-type">TxInsCollateral</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621681702615"><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702615"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span></span><span> </span><span id="local-6989586621681702616"><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702616"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span></span><span> </span><span id="local-6989586621681702617"><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702617"><span class="hs-identifier hs-var">cAddr</span></a></span></span><span> </span><span id="local-6989586621681702618"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702618"><span class="hs-identifier hs-var">totalAvailableAda</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1311"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1312"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702619"><span class="annot"><span class="annottext">colPerc :: Natural
</span><a href="#local-6989586621681702619"><span class="hs-identifier hs-var hs-var">colPerc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702614"><span class="hs-identifier hs-var">pp'</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
-&gt; Getting Natural (PParams (ShelleyLedgerEra era)) Natural
-&gt; Natural
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Natural (PParams (ShelleyLedgerEra era)) Natural
forall era. AlonzoEraPParams era =&gt; Lens' (PParams era) Natural
Lens' (PParams (ShelleyLedgerEra era)) Natural
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-alonzo-1.10.0.0-f2b1b1d67a783b109a5c4fc659f412984adaac28a35f7c497a540b4dd93e0d57/share/doc/html/src/Cardano.Ledger.Alonzo.PParams.html#ppCollateralPercentageL"><span class="hs-identifier hs-var">Ledger.ppCollateralPercentageL</span></a></span><span>
</span><span id="line-1313"></span><span>        </span><span class="hs-comment">-- We must first figure out how much lovelace we have committed</span><span>
</span><span id="line-1314"></span><span>        </span><span class="hs-comment">-- as collateral and we must determine if we have enough lovelace at our</span><span>
</span><span id="line-1315"></span><span>        </span><span class="hs-comment">-- collateral tx inputs to cover the tx</span><span>
</span><span id="line-1316"></span><span>        </span><span id="local-6989586621681702621"><span class="annot"><span class="annottext">totalCollateralLovelace :: Coin
</span><a href="#local-6989586621681702621"><span class="hs-identifier hs-var hs-var">totalCollateralLovelace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702618"><span class="hs-identifier hs-var">totalAvailableAda</span></a></span><span>
</span><span id="line-1317"></span><span>        </span><span id="local-6989586621681702622"><span class="annot"><span class="annottext">requiredCollateral :: Coin
</span><a href="#local-6989586621681702622"><span class="hs-identifier hs-var">requiredCollateral</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span> </span><span id="local-6989586621681702623"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681702623"><span class="hs-identifier hs-var">reqAmt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621681702619"><span class="hs-identifier hs-var">colPerc</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702613"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-1318"></span><span>        </span><span id="local-6989586621681702625"><span class="annot"><span class="annottext">totalCollateral :: TxTotalCollateral era
</span><a href="#local-6989586621681702625"><span class="hs-identifier hs-var hs-var">totalCollateral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1319"></span><span>          </span><span class="annot"><span class="annottext">BabbageEraOnwards era -&gt; Coin -&gt; TxTotalCollateral era
forall era. BabbageEraOnwards era -&gt; Coin -&gt; TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateral"><span class="hs-identifier hs-var">TxTotalCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702612"><span class="hs-identifier hs-var">retColSup</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; TxTotalCollateral era)
-&gt; (Rational -&gt; Coin) -&gt; Rational -&gt; TxTotalCollateral era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#rationalToCoinViaCeiling"><span class="hs-identifier hs-var">L.rationalToCoinViaCeiling</span></a></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; TxTotalCollateral era)
-&gt; Rational -&gt; TxTotalCollateral era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1320"></span><span>            </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681702623"><span class="hs-identifier hs-var">reqAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Rational
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#%25"><span class="hs-operator hs-var">%</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">100</span></span><span>
</span><span id="line-1321"></span><span>        </span><span class="hs-comment">-- Why * 100? requiredCollateral is the product of the collateral percentage and the tx fee</span><span>
</span><span id="line-1322"></span><span>        </span><span class="hs-comment">-- We choose to multiply 100 rather than divide by 100 to make the calculation</span><span>
</span><span id="line-1323"></span><span>        </span><span class="hs-comment">-- easier to manage. At the end of the calculation we then use % 100 to perform our division</span><span>
</span><span id="line-1324"></span><span>        </span><span class="hs-comment">-- and round the returnCollateral down which has the effect of potentially slightly</span><span>
</span><span id="line-1325"></span><span>        </span><span class="hs-comment">-- overestimating the required collateral.</span><span>
</span><span id="line-1326"></span><span>        </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span> </span><span id="local-6989586621681702629"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681702629"><span class="hs-identifier hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702621"><span class="hs-identifier hs-var">totalCollateralLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702622"><span class="hs-identifier hs-var">requiredCollateral</span></a></span><span>
</span><span id="line-1327"></span><span>        </span><span id="local-6989586621681702630"><span class="annot"><span class="annottext">returnCollateral :: Coin
</span><a href="#local-6989586621681702630"><span class="hs-identifier hs-var hs-var">returnCollateral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#rationalToCoinViaFloor"><span class="hs-identifier hs-var">L.rationalToCoinViaFloor</span></a></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Coin) -&gt; Rational -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681702629"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Rational
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#%25"><span class="hs-operator hs-var">%</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">100</span></span><span>
</span><span id="line-1328"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702615"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702616"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1329"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681702632"><span class="annot"><span class="annottext">rc :: TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702632"><span class="hs-identifier hs-var">rc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxReturnCollateral"><span class="hs-identifier hs-type">TxReturnCollateral</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702634"><span class="annot"><span class="annottext">tc :: TxTotalCollateral era
</span><a href="#local-6989586621681702634"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxTotalCollateral"><span class="hs-identifier hs-type">TxTotalCollateral</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1330"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702632"><span class="hs-identifier hs-var">rc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702634"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1331"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681702635"><span class="annot"><span class="annottext">rc :: TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702635"><span class="hs-identifier hs-var">rc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxReturnCollateral"><span class="hs-identifier hs-type">TxReturnCollateral</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1332"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702635"><span class="hs-identifier hs-var">rc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
forall era. TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1333"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702636"><span class="annot"><span class="annottext">tc :: TxTotalCollateral era
</span><a href="#local-6989586621681702636"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxTotalCollateral"><span class="hs-identifier hs-type">TxTotalCollateral</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1334"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
forall ctx era. TxReturnCollateral ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702636"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1335"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1336"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702621"><span class="hs-identifier hs-var">totalCollateralLovelace</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-prim-0.11.0-inplace/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702622"><span class="hs-identifier hs-var">requiredCollateral</span></a></span><span>
</span><span id="line-1337"></span><span>          </span><span class="hs-keyword">then</span><span>
</span><span id="line-1338"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
-&gt; TxOut CtxTx era -&gt; TxReturnCollateral CtxTx era
forall era ctx.
BabbageEraOnwards era
-&gt; TxOut ctx era -&gt; TxReturnCollateral ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateral"><span class="hs-identifier hs-var">TxReturnCollateral</span></a></span><span>
</span><span id="line-1339"></span><span>                </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702612"><span class="hs-identifier hs-var">retColSup</span></a></span><span>
</span><span id="line-1340"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum CtxTx era
-&gt; ReferenceScript era
-&gt; TxOut CtxTx era
forall ctx era.
AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum ctx era
-&gt; ReferenceScript era
-&gt; TxOut ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span>
</span><span id="line-1341"></span><span>                    </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702617"><span class="hs-identifier hs-var">cAddr</span></a></span><span>
</span><span id="line-1342"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; Coin -&gt; TxOutValue era
forall era. ShelleyBasedEra era -&gt; Coin -&gt; TxOutValue era
</span><a href="Cardano.Api.Tx.Body.html#lovelaceToTxOutValue"><span class="hs-identifier hs-var">lovelaceToTxOutValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BabbageEraOnwards era -&gt; ShelleyBasedEra era
forall era. BabbageEraOnwards era -&gt; ShelleyBasedEra era
</span><a href="Cardano.Api.Eon.BabbageEraOnwards.html#babbageEraOnwardsToShelleyBasedEra"><span class="hs-identifier hs-var">babbageEraOnwardsToShelleyBasedEra</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702612"><span class="hs-identifier hs-var">retColSup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702630"><span class="hs-identifier hs-var">returnCollateral</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1343"></span><span>                    </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
forall ctx era. TxOutDatum ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-var">TxOutDatumNone</span></a></span><span>
</span><span id="line-1344"></span><span>                    </span><span class="annot"><span class="annottext">ReferenceScript era
forall era. ReferenceScript era
</span><a href="Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-var">ReferenceScriptNone</span></a></span><span>
</span><span id="line-1345"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1346"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702625"><span class="hs-identifier hs-var">totalCollateral</span></a></span><span>
</span><span id="line-1347"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1348"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
forall ctx era. TxReturnCollateral ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
forall era. TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1349"></span><span>
</span><span id="line-1350"></span><span id="local-6989586621681701224"><span id="local-6989586621681701225"><span class="annot"><a href="Cardano.Api.Fees.html#calculateCreatedUTOValue"><span class="hs-identifier hs-type">calculateCreatedUTOValue</span></a></span><span>
</span><span id="line-1351"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701224"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701225"><span class="hs-identifier hs-type">build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701224"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span></span></span><span>
</span><span id="line-1352"></span><span id="calculateCreatedUTOValue"><span class="annot"><span class="annottext">calculateCreatedUTOValue :: forall era build.
ShelleyBasedEra era -&gt; TxBodyContent build era -&gt; Value
</span><a href="Cardano.Api.Fees.html#calculateCreatedUTOValue"><span class="hs-identifier hs-var hs-var">calculateCreatedUTOValue</span></a></span></span><span> </span><span id="local-6989586621681702640"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702640"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681702641"><span class="annot"><span class="annottext">TxBodyContent build era
</span><a href="#local-6989586621681702641"><span class="hs-identifier hs-var">txbodycontent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1353"></span><span>  </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; Value (ShelleyLedgerEra era) -&gt; Value
forall era.
ShelleyBasedEra era -&gt; Value (ShelleyLedgerEra era) -&gt; Value
</span><a href="Cardano.Api.Value.html#fromLedgerValue"><span class="hs-identifier hs-var">fromLedgerValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702640"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">Value (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702642"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOutValueShelleyBased"><span class="hs-identifier hs-type">TxOutValueShelleyBased</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681702642"><span class="annot"><span class="annottext">Value (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702642"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ReferenceScript era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxBodyContent build era -&gt; [TxOut CtxTx era]
forall build era. TxBodyContent build era -&gt; [TxOut CtxTx era]
</span><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent build era
</span><a href="#local-6989586621681702641"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1354"></span><span>
</span><span id="line-1355"></span><span id="local-6989586621681700881"><span id="local-6989586621681700882"><span class="annot"><a href="Cardano.Api.Fees.html#calculateChangeValue"><span class="hs-identifier hs-type">calculateChangeValue</span></a></span><span>
</span><span id="line-1356"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700881"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700882"><span class="hs-identifier hs-type">build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700881"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span></span></span><span>
</span><span id="line-1357"></span><span id="calculateChangeValue"><span class="annot"><span class="annottext">calculateChangeValue :: forall era build.
ShelleyBasedEra era -&gt; Value -&gt; TxBodyContent build era -&gt; Value
</span><a href="Cardano.Api.Fees.html#calculateChangeValue"><span class="hs-identifier hs-var hs-var">calculateChangeValue</span></a></span></span><span> </span><span id="local-6989586621681702647"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702647"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681702648"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702648"><span class="hs-identifier hs-var">incoming</span></a></span></span><span> </span><span id="local-6989586621681702649"><span class="annot"><span class="annottext">TxBodyContent build era
</span><a href="#local-6989586621681702649"><span class="hs-identifier hs-var">txbodycontent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1358"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702650"><span class="annot"><span class="annottext">outgoing :: Value
</span><a href="#local-6989586621681702650"><span class="hs-identifier hs-var hs-var">outgoing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; TxBodyContent build era -&gt; Value
forall era build.
ShelleyBasedEra era -&gt; TxBodyContent build era -&gt; Value
</span><a href="Cardano.Api.Fees.html#calculateCreatedUTOValue"><span class="hs-identifier hs-var">calculateCreatedUTOValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702647"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent build era
</span><a href="#local-6989586621681702649"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span>
</span><span id="line-1359"></span><span>      </span><span id="local-6989586621681702651"><span class="annot"><span class="annottext">minted :: Value
</span><a href="#local-6989586621681702651"><span class="hs-identifier hs-var hs-var">minted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxBodyContent build era -&gt; TxMintValue build era
forall build era. TxBodyContent build era -&gt; TxMintValue build era
</span><a href="Cardano.Api.Tx.Body.html#txMintValue"><span class="hs-identifier hs-var">txMintValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent build era
</span><a href="#local-6989586621681702649"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1360"></span><span>        </span><span class="annot"><span class="annottext">TxMintValue build era
</span><a href="Cardano.Api.Tx.Body.html#TxMintNone"><span class="hs-identifier hs-var">TxMintNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-1361"></span><span>        </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxMintValue"><span class="hs-identifier hs-type">TxMintValue</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681702655"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702655"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">BuildTxWith build (Map PolicyId (ScriptWitness WitCtxMint era))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702655"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1362"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702648"><span class="hs-identifier hs-var">incoming</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702651"><span class="hs-identifier hs-var">minted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="Cardano.Api.Value.html#negateValue"><span class="hs-identifier hs-var">negateValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702650"><span class="hs-identifier hs-var">outgoing</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1363"></span><span>
</span><span id="line-1364"></span><span class="hs-comment">-- | This is used in the balance calculation in the event where</span><span>
</span><span id="line-1365"></span><span class="hs-comment">-- the user does not supply the UTxO(s) they intend to spend</span><span>
</span><span id="line-1366"></span><span class="hs-comment">-- but they must supply their total balance of ADA.</span><span>
</span><span id="line-1367"></span><span class="hs-comment">-- evaluateTransactionBalance calls evalBalanceTxBody which requires a UTxO value.</span><span>
</span><span id="line-1368"></span><span class="hs-comment">-- This eventually calls getConsumedMaryValue which retrieves the balance</span><span>
</span><span id="line-1369"></span><span class="hs-comment">-- from the transaction itself. This necessitated a function to create a &quot;fake&quot; UTxO</span><span>
</span><span id="line-1370"></span><span class="hs-comment">-- to still use evalBalanceTxBody however this will fail for transactions</span><span>
</span><span id="line-1371"></span><span class="hs-comment">-- containing multi-assets, refunds and withdrawals.</span><span>
</span><span id="line-1372"></span><span class="hs-comment">-- TODO: Include multiassets</span><span>
</span><span id="line-1373"></span><span id="local-6989586621681700952"><span class="annot"><a href="Cardano.Api.Fees.html#createFakeUTxO"><span class="hs-identifier hs-type">createFakeUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700952"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700952"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Query.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700952"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-1374"></span><span id="createFakeUTxO"><span class="annot"><span class="annottext">createFakeUTxO :: forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Coin -&gt; UTxO era
</span><a href="Cardano.Api.Fees.html#createFakeUTxO"><span class="hs-identifier hs-var hs-var">createFakeUTxO</span></a></span></span><span> </span><span id="local-6989586621681702661"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702661"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681702662"><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702662"><span class="hs-identifier hs-var">txbodycontent</span></a></span></span><span> </span><span id="local-6989586621681702663"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702663"><span class="hs-identifier hs-var">totalAdaInUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1375"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702664"><span class="annot"><span class="annottext">singleTxIn :: [TxIn]
</span><a href="#local-6989586621681702664"><span class="hs-identifier hs-var hs-var">singleTxIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxIn]
-&gt; ((TxIn, [TxIn]) -&gt; [TxIn]) -&gt; Maybe (TxIn, [TxIn]) -&gt; [TxIn]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; [TxIn]
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; [TxIn])
-&gt; ((TxIn, [TxIn]) -&gt; TxIn) -&gt; (TxIn, [TxIn]) -&gt; [TxIn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, [TxIn]) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (TxIn, [TxIn]) -&gt; [TxIn]) -&gt; Maybe (TxIn, [TxIn]) -&gt; [TxIn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; Maybe (TxIn, [TxIn])
forall a. [a] -&gt; Maybe (a, [a])
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.List.html#uncons"><span class="hs-identifier hs-var">List.uncons</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681702667"><span class="hs-identifier hs-var">txin</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681702667"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681702667"><span class="hs-identifier hs-var">txin</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; TxIns BuildTx era
forall build era. TxBodyContent build era -&gt; TxIns build era
</span><a href="Cardano.Api.Tx.Body.html#txIns"><span class="hs-identifier hs-var">txIns</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702662"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1376"></span><span>      </span><span id="local-6989586621681702668"><span class="annot"><span class="annottext">singleTxOut :: [TxOut CtxUTxO era]
</span><a href="#local-6989586621681702668"><span class="hs-identifier hs-var hs-var">singleTxOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1377"></span><span>        </span><span class="annot"><span class="annottext">[TxOut CtxUTxO era]
-&gt; ((TxOut CtxTx era, [TxOut CtxTx era]) -&gt; [TxOut CtxUTxO era])
-&gt; Maybe (TxOut CtxTx era, [TxOut CtxTx era])
-&gt; [TxOut CtxUTxO era]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO era -&gt; [TxOut CtxUTxO era]
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO era -&gt; [TxOut CtxUTxO era])
-&gt; ((TxOut CtxTx era, [TxOut CtxTx era]) -&gt; TxOut CtxUTxO era)
-&gt; (TxOut CtxTx era, [TxOut CtxTx era])
-&gt; [TxOut CtxUTxO era]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; Coin -&gt; TxOut CtxUTxO era -&gt; TxOut CtxUTxO era
forall era.
ShelleyBasedEra era
-&gt; Coin -&gt; TxOut CtxUTxO era -&gt; TxOut CtxUTxO era
</span><a href="Cardano.Api.Fees.html#updateTxOut"><span class="hs-identifier hs-var">updateTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702661"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702663"><span class="hs-identifier hs-var">totalAdaInUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO era -&gt; TxOut CtxUTxO era)
-&gt; ((TxOut CtxTx era, [TxOut CtxTx era]) -&gt; TxOut CtxUTxO era)
-&gt; (TxOut CtxTx era, [TxOut CtxTx era])
-&gt; TxOut CtxUTxO era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era -&gt; TxOut CtxUTxO era
forall era. TxOut CtxTx era -&gt; TxOut CtxUTxO era
</span><a href="Cardano.Api.Tx.Body.html#toCtxUTxOTxOut"><span class="hs-identifier hs-var">toCtxUTxOTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx era -&gt; TxOut CtxUTxO era)
-&gt; ((TxOut CtxTx era, [TxOut CtxTx era]) -&gt; TxOut CtxTx era)
-&gt; (TxOut CtxTx era, [TxOut CtxTx era])
-&gt; TxOut CtxUTxO era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx era, [TxOut CtxTx era]) -&gt; TxOut CtxTx era
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (TxOut CtxTx era, [TxOut CtxTx era]) -&gt; [TxOut CtxUTxO era])
-&gt; Maybe (TxOut CtxTx era, [TxOut CtxTx era])
-&gt; [TxOut CtxUTxO era]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1378"></span><span>          </span><span class="annot"><span class="annottext">[TxOut CtxTx era] -&gt; Maybe (TxOut CtxTx era, [TxOut CtxTx era])
forall a. [a] -&gt; Maybe (a, [a])
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.List.html#uncons"><span class="hs-identifier hs-var">List.uncons</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut CtxTx era] -&gt; Maybe (TxOut CtxTx era, [TxOut CtxTx era]))
-&gt; [TxOut CtxTx era] -&gt; Maybe (TxOut CtxTx era, [TxOut CtxTx era])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1379"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; [TxOut CtxTx era]
forall build era. TxBodyContent build era -&gt; [TxOut CtxTx era]
</span><a href="Cardano.Api.Tx.Body.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702662"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span>
</span><span id="line-1380"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- Take one txin and one txout. Replace the out value with totalAdaInUTxO</span><span>
</span><span id="line-1381"></span><span>      </span><span class="hs-comment">-- Return an empty UTxO if there are no txins or txouts</span><span>
</span><span id="line-1382"></span><span>      </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO era) -&gt; UTxO era
forall era. Map TxIn (TxOut CtxUTxO era) -&gt; UTxO era
</span><a href="Cardano.Api.Query.html#UTxO"><span class="hs-identifier hs-var">UTxO</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxIn (TxOut CtxUTxO era) -&gt; UTxO era)
-&gt; Map TxIn (TxOut CtxUTxO era) -&gt; UTxO era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Item (Map TxIn (TxOut CtxUTxO era))]
-&gt; Map TxIn (TxOut CtxUTxO era)
forall l. IsList l =&gt; [Item l] -&gt; l
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Item (Map TxIn (TxOut CtxUTxO era))]
 -&gt; Map TxIn (TxOut CtxUTxO era))
-&gt; [Item (Map TxIn (TxOut CtxUTxO era))]
-&gt; Map TxIn (TxOut CtxUTxO era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; [TxOut CtxUTxO era] -&gt; [(TxIn, TxOut CtxUTxO era)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621681702664"><span class="hs-identifier hs-var">singleTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxUTxO era]
</span><a href="#local-6989586621681702668"><span class="hs-identifier hs-var">singleTxOut</span></a></span><span>
</span><span id="line-1383"></span><span>
</span><span id="line-1384"></span><span id="local-6989586621681701240"><span class="annot"><a href="Cardano.Api.Fees.html#updateTxOut"><span class="hs-identifier hs-type">updateTxOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701240"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxUTxO"><span class="hs-identifier hs-type">CtxUTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701240"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxUTxO"><span class="hs-identifier hs-type">CtxUTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701240"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-1385"></span><span id="updateTxOut"><span class="annot"><span class="annottext">updateTxOut :: forall era.
ShelleyBasedEra era
-&gt; Coin -&gt; TxOut CtxUTxO era -&gt; TxOut CtxUTxO era
</span><a href="Cardano.Api.Fees.html#updateTxOut"><span class="hs-identifier hs-var hs-var">updateTxOut</span></a></span></span><span> </span><span id="local-6989586621681702671"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702671"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681702672"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702672"><span class="hs-identifier hs-var">updatedValue</span></a></span></span><span> </span><span id="local-6989586621681702673"><span class="annot"><span class="annottext">TxOut CtxUTxO era
</span><a href="#local-6989586621681702673"><span class="hs-identifier hs-var">txout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1386"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702674"><span class="annot"><span class="annottext">ledgerout :: TxOut (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702674"><span class="hs-identifier hs-var hs-var">ledgerout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; (ShelleyBasedEraConstraints era =&gt; TxOut (ShelleyLedgerEra era))
-&gt; TxOut (ShelleyLedgerEra era)
forall era a.
ShelleyBasedEra era -&gt; (ShelleyBasedEraConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#shelleyBasedEraConstraints"><span class="hs-identifier hs-var">shelleyBasedEraConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702671"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyBasedEraConstraints era =&gt; TxOut (ShelleyLedgerEra era))
 -&gt; TxOut (ShelleyLedgerEra era))
-&gt; (ShelleyBasedEraConstraints era =&gt; TxOut (ShelleyLedgerEra era))
-&gt; TxOut (ShelleyLedgerEra era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxOut CtxUTxO era -&gt; TxOut (ShelleyLedgerEra era)
forall era ledgerera.
(ShelleyLedgerEra era ~ ledgerera) =&gt;
ShelleyBasedEra era -&gt; TxOut CtxUTxO era -&gt; TxOut ledgerera
</span><a href="Cardano.Api.Tx.Body.html#toShelleyTxOut"><span class="hs-identifier hs-var">toShelleyTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702671"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO era
</span><a href="#local-6989586621681702673"><span class="hs-identifier hs-var">txout</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut (ShelleyLedgerEra era)
-&gt; (TxOut (ShelleyLedgerEra era) -&gt; TxOut (ShelleyLedgerEra era))
-&gt; TxOut (ShelleyLedgerEra era)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin)
-&gt; TxOut (ShelleyLedgerEra era)
-&gt; Identity (TxOut (ShelleyLedgerEra era))
forall era. (HasCallStack, EraTxOut era) =&gt; Lens' (TxOut era) Coin
Lens' (TxOut (ShelleyLedgerEra era)) Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.html#coinTxOutL"><span class="hs-identifier hs-var">L.coinTxOutL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin)
 -&gt; TxOut (ShelleyLedgerEra era)
 -&gt; Identity (TxOut (ShelleyLedgerEra era)))
-&gt; Coin
-&gt; TxOut (ShelleyLedgerEra era)
-&gt; TxOut (ShelleyLedgerEra era)
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702672"><span class="hs-identifier hs-var">updatedValue</span></a></span><span>
</span><span id="line-1387"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxOut (ShelleyLedgerEra era) -&gt; TxOut CtxUTxO era
forall era ctx.
ShelleyBasedEra era
-&gt; TxOut (ShelleyLedgerEra era) -&gt; TxOut ctx era
</span><a href="Cardano.Api.Tx.Body.html#fromShelleyTxOut"><span class="hs-identifier hs-var">fromShelleyTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702671"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702674"><span class="hs-identifier hs-var">ledgerout</span></a></span><span>
</span><span id="line-1388"></span><span>
</span><span id="line-1389"></span><span class="hs-comment">-- Essentially we check for the existence of collateral inputs. If they exist we</span><span>
</span><span id="line-1390"></span><span class="hs-comment">-- create a fictitious collateral return output. Why? Because we need to put dummy values</span><span>
</span><span id="line-1391"></span><span class="hs-comment">-- to get a fee estimate (i.e we overestimate the fee). The required collateral depends</span><span>
</span><span id="line-1392"></span><span class="hs-comment">-- on the tx fee as per the Alonzo spec.</span><span>
</span><span id="line-1393"></span><span id="local-6989586621681700907"><span class="annot"><a href="Cardano.Api.Fees.html#maybeDummyTotalCollAndCollReturnOutput"><span class="hs-identifier hs-type">maybeDummyTotalCollAndCollReturnOutput</span></a></span><span>
</span><span id="line-1394"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700907"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1395"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700907"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1396"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#AddressInEra"><span class="hs-identifier hs-type">AddressInEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700907"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1397"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxReturnCollateral"><span class="hs-identifier hs-type">TxReturnCollateral</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxTx"><span class="hs-identifier hs-type">CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700907"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxTotalCollateral"><span class="hs-identifier hs-type">TxTotalCollateral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700907"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1398"></span><span id="maybeDummyTotalCollAndCollReturnOutput"><span class="annot"><span class="annottext">maybeDummyTotalCollAndCollReturnOutput :: forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era
-&gt; AddressInEra era
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
</span><a href="Cardano.Api.Fees.html#maybeDummyTotalCollAndCollReturnOutput"><span class="hs-identifier hs-var hs-var">maybeDummyTotalCollAndCollReturnOutput</span></a></span></span><span> </span><span id="local-6989586621681702697"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702697"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span class="hs-special">{</span><span id="local-6989586621681702698"><span class="annot"><span class="annottext">TxInsCollateral era
txInsCollateral :: forall build era. TxBodyContent build era -&gt; TxInsCollateral era
txInsCollateral :: TxInsCollateral era
</span><a href="Cardano.Api.Tx.Body.html#txInsCollateral"><span class="hs-identifier hs-var hs-var">txInsCollateral</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702699"><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
txReturnCollateral :: forall build era.
TxBodyContent build era -&gt; TxReturnCollateral CtxTx era
txReturnCollateral :: TxReturnCollateral CtxTx era
</span><a href="Cardano.Api.Tx.Body.html#txReturnCollateral"><span class="hs-identifier hs-var hs-var">txReturnCollateral</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702700"><span class="annot"><span class="annottext">TxTotalCollateral era
txTotalCollateral :: forall build era. TxBodyContent build era -&gt; TxTotalCollateral era
txTotalCollateral :: TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#txTotalCollateral"><span class="hs-identifier hs-var hs-var">txTotalCollateral</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621681702701"><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702701"><span class="hs-identifier hs-var">cAddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1399"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><a href="#local-6989586621681702698"><span class="hs-identifier hs-var">txInsCollateral</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1400"></span><span>    </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxInsCollateralNone"><span class="hs-identifier hs-var">TxInsCollateralNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
forall ctx era. TxReturnCollateral ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
forall era. TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1401"></span><span>    </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxInsCollateral"><span class="hs-identifier hs-type">TxInsCollateral</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1402"></span><span>      </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
-&gt; (BabbageEraOnwards era
    -&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era))
-&gt; (TxReturnCollateral CtxTx era, TxTotalCollateral era)
forall (eon :: * -&gt; *) era a.
Eon eon =&gt;
ShelleyBasedEra era -&gt; a -&gt; (eon era -&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#forShelleyBasedEraInEon"><span class="hs-identifier hs-var">forShelleyBasedEraInEon</span></a></span><span>
</span><span id="line-1403"></span><span>        </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702697"><span class="hs-identifier hs-var">sbe</span></a></span><span>
</span><span id="line-1404"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
forall ctx era. TxReturnCollateral ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
forall era. TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1405"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681702702"><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702702"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1406"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702703"><span class="annot"><span class="annottext">dummyRetCol :: TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702703"><span class="hs-identifier hs-var hs-var">dummyRetCol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1407"></span><span>                  </span><span class="annot"><span class="annottext">BabbageEraOnwards era
-&gt; TxOut CtxTx era -&gt; TxReturnCollateral CtxTx era
forall era ctx.
BabbageEraOnwards era
-&gt; TxOut ctx era -&gt; TxReturnCollateral ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateral"><span class="hs-identifier hs-var">TxReturnCollateral</span></a></span><span>
</span><span id="line-1408"></span><span>                    </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702702"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1409"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum CtxTx era
-&gt; ReferenceScript era
-&gt; TxOut CtxTx era
forall ctx era.
AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum ctx era
-&gt; ReferenceScript era
-&gt; TxOut ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span>
</span><span id="line-1410"></span><span>                        </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621681702701"><span class="hs-identifier hs-var">cAddr</span></a></span><span>
</span><span id="line-1411"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era -&gt; Coin -&gt; TxOutValue era
forall era. ShelleyBasedEra era -&gt; Coin -&gt; TxOutValue era
</span><a href="Cardano.Api.Tx.Body.html#lovelaceToTxOutValue"><span class="hs-identifier hs-var">lovelaceToTxOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702697"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; TxOutValue era) -&gt; Coin -&gt; TxOutValue era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">L.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#%5E"><span class="hs-operator hs-var">^</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">64</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-bignum-1.3-inplace/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1412"></span><span>                        </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
forall ctx era. TxOutDatum ctx era
</span><a href="Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-var">TxOutDatumNone</span></a></span><span>
</span><span id="line-1413"></span><span>                        </span><span class="annot"><span class="annottext">ReferenceScript era
forall era. ReferenceScript era
</span><a href="Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-var">ReferenceScriptNone</span></a></span><span>
</span><span id="line-1414"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-1415"></span><span>                </span><span id="local-6989586621681702704"><span class="annot"><span class="annottext">dummyTotCol :: TxTotalCollateral era
</span><a href="#local-6989586621681702704"><span class="hs-identifier hs-var hs-var">dummyTotCol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era -&gt; Coin -&gt; TxTotalCollateral era
forall era. BabbageEraOnwards era -&gt; Coin -&gt; TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateral"><span class="hs-identifier hs-var">TxTotalCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621681702702"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">L.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#%5E"><span class="hs-operator hs-var">^</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/ghc-bignum-1.3-inplace/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1416"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702699"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702700"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1417"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621681702705"><span class="annot"><span class="annottext">rc :: TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702705"><span class="hs-identifier hs-var">rc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxReturnCollateral"><span class="hs-identifier hs-type">TxReturnCollateral</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702706"><span class="annot"><span class="annottext">tc :: TxTotalCollateral era
</span><a href="#local-6989586621681702706"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxTotalCollateral"><span class="hs-identifier hs-type">TxTotalCollateral</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702705"><span class="hs-identifier hs-var">rc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702706"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1418"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621681702707"><span class="annot"><span class="annottext">rc :: TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702707"><span class="hs-identifier hs-var">rc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxReturnCollateral"><span class="hs-identifier hs-type">TxReturnCollateral</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702707"><span class="hs-identifier hs-var">rc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702704"><span class="hs-identifier hs-var">dummyTotCol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1419"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702708"><span class="annot"><span class="annottext">tc :: TxTotalCollateral era
</span><a href="#local-6989586621681702708"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxTotalCollateral"><span class="hs-identifier hs-type">TxTotalCollateral</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702703"><span class="hs-identifier hs-var">dummyRetCol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702708"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1420"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="Cardano.Api.Tx.Body.html#TxReturnCollateralNone"><span class="hs-identifier hs-var">TxReturnCollateralNone</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="Cardano.Api.Tx.Body.html#TxTotalCollateralNone"><span class="hs-identifier hs-var">TxTotalCollateralNone</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><a href="#local-6989586621681702703"><span class="hs-identifier hs-var">dummyRetCol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><a href="#local-6989586621681702704"><span class="hs-identifier hs-var">dummyTotCol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1421"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1422"></span><span>
</span><span id="line-1423"></span><span class="annot"><a href="Cardano.Api.Fees.html#substituteExecutionUnits"><span class="hs-identifier hs-type">substituteExecutionUnits</span></a></span><span>
</span><span id="line-1424"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681700793"><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-1425"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ExecutionUnits"><span class="hs-identifier hs-type">ExecutionUnits</span></a></span><span>
</span><span id="line-1426"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1427"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1428"></span><span id="substituteExecutionUnits"><span class="annot"><span class="annottext">substituteExecutionUnits :: forall era.
Map ScriptWitnessIndex ExecutionUnits
-&gt; TxBodyContent BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era)
</span><a href="Cardano.Api.Fees.html#substituteExecutionUnits"><span class="hs-identifier hs-var hs-var">substituteExecutionUnits</span></a></span></span><span>
</span><span id="line-1429"></span><span>  </span><span id="local-6989586621681702727"><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702727"><span class="hs-identifier hs-var">exUnitsMap</span></a></span></span><span>
</span><span id="line-1430"></span><span>  </span><span id="local-6989586621681702728"><span class="annot"><span class="annottext">txbodycontent :: TxBodyContent BuildTx era
</span><a href="#local-6989586621681702728"><span class="hs-identifier hs-var">txbodycontent</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxBodyContent"><span class="hs-identifier hs-type">TxBodyContent</span></a></span><span>
</span><span id="line-1431"></span><span>                    </span><span id="local-6989586621681702729"><span class="annot"><span class="annottext">TxIns BuildTx era
</span><a href="#local-6989586621681702729"><span class="hs-identifier hs-var">txIns</span></a></span></span><span>
</span><span id="line-1432"></span><span>                    </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1433"></span><span>                    </span><span class="annot"><span class="annottext">TxInsReference era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1434"></span><span>                    </span><span class="annot"><span class="annottext">[TxOut CtxTx era]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1435"></span><span>                    </span><span class="annot"><span class="annottext">TxTotalCollateral era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1436"></span><span>                    </span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1437"></span><span>                    </span><span class="annot"><span class="annottext">TxFee era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1438"></span><span>                    </span><span class="annot"><span class="annottext">TxValidityLowerBound era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1439"></span><span>                    </span><span class="annot"><span class="annottext">TxValidityUpperBound era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1440"></span><span>                    </span><span class="annot"><span class="annottext">TxMetadataInEra era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1441"></span><span>                    </span><span class="annot"><span class="annottext">TxAuxScripts era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1442"></span><span>                    </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1443"></span><span>                    </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Maybe (LedgerProtocolParameters era))
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1444"></span><span>                    </span><span id="local-6989586621681702730"><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
</span><a href="#local-6989586621681702730"><span class="hs-identifier hs-var">txWithdrawals</span></a></span></span><span>
</span><span id="line-1445"></span><span>                    </span><span id="local-6989586621681702731"><span class="annot"><span class="annottext">TxCertificates BuildTx era
</span><a href="#local-6989586621681702731"><span class="hs-identifier hs-var">txCertificates</span></a></span></span><span>
</span><span id="line-1446"></span><span>                    </span><span class="annot"><span class="annottext">TxUpdateProposal era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1447"></span><span>                    </span><span id="local-6989586621681702732"><span class="annot"><span class="annottext">TxMintValue BuildTx era
</span><a href="#local-6989586621681702732"><span class="hs-identifier hs-var">txMintValue</span></a></span></span><span>
</span><span id="line-1448"></span><span>                    </span><span class="annot"><span class="annottext">TxScriptValidity era
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1449"></span><span>                    </span><span id="local-6989586621681702733"><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era))
</span><a href="#local-6989586621681702733"><span class="hs-identifier hs-var">txProposalProcedures</span></a></span></span><span>
</span><span id="line-1450"></span><span>                    </span><span id="local-6989586621681702734"><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures BuildTx era))
</span><a href="#local-6989586621681702734"><span class="hs-identifier hs-var">txVotingProcedures</span></a></span></span><span>
</span><span id="line-1451"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (Featured ConwayEraOnwards era (Maybe Coin))
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1452"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (Featured ConwayEraOnwards era Coin)
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1453"></span><span>                  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1454"></span><span>    </span><span id="local-6989586621681702735"><span class="annot"><span class="annottext">TxIns BuildTx era
</span><a href="#local-6989586621681702735"><span class="hs-identifier hs-var">mappedTxIns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxIns BuildTx era)
</span><a href="#local-6989586621681702736"><span class="hs-identifier hs-var">mapScriptWitnessesTxIns</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx era
</span><a href="#local-6989586621681702729"><span class="hs-identifier hs-var">txIns</span></a></span><span>
</span><span id="line-1455"></span><span>    </span><span id="local-6989586621681702737"><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
</span><a href="#local-6989586621681702737"><span class="hs-identifier hs-var">mappedWithdrawals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxWithdrawals BuildTx era)
</span><a href="#local-6989586621681702738"><span class="hs-identifier hs-var">mapScriptWitnessesWithdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
</span><a href="#local-6989586621681702730"><span class="hs-identifier hs-var">txWithdrawals</span></a></span><span>
</span><span id="line-1456"></span><span>    </span><span id="local-6989586621681702739"><span class="annot"><span class="annottext">TxMintValue BuildTx era
</span><a href="#local-6989586621681702739"><span class="hs-identifier hs-var">mappedMintedVals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxMintValue BuildTx era)
</span><a href="#local-6989586621681702740"><span class="hs-identifier hs-var">mapScriptWitnessesMinting</span></a></span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx era
</span><a href="#local-6989586621681702732"><span class="hs-identifier hs-var">txMintValue</span></a></span><span>
</span><span id="line-1457"></span><span>    </span><span id="local-6989586621681702741"><span class="annot"><span class="annottext">TxCertificates BuildTx era
</span><a href="#local-6989586621681702741"><span class="hs-identifier hs-var">mappedTxCertificates</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxCertificates BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxCertificates BuildTx era)
</span><a href="#local-6989586621681702742"><span class="hs-identifier hs-var">mapScriptWitnessesCertificates</span></a></span><span> </span><span class="annot"><span class="annottext">TxCertificates BuildTx era
</span><a href="#local-6989586621681702731"><span class="hs-identifier hs-var">txCertificates</span></a></span><span>
</span><span id="line-1458"></span><span>    </span><span id="local-6989586621681702743"><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures BuildTx era))
</span><a href="#local-6989586621681702743"><span class="hs-identifier hs-var">mappedVotes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures BuildTx era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxVotingProcedures BuildTx era)))
forall build.
Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxVotingProcedures build era)))
</span><a href="#local-6989586621681702744"><span class="hs-identifier hs-var">mapScriptWitnessesVotes</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures BuildTx era))
</span><a href="#local-6989586621681702734"><span class="hs-identifier hs-var">txVotingProcedures</span></a></span><span>
</span><span id="line-1459"></span><span>    </span><span id="local-6989586621681702745"><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era))
</span><a href="#local-6989586621681702745"><span class="hs-identifier hs-var">mappedProposals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era)))
forall build.
Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxProposalProcedures build era)))
</span><a href="#local-6989586621681702746"><span class="hs-identifier hs-var">mapScriptWitnessesProposals</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era))
</span><a href="#local-6989586621681702733"><span class="hs-identifier hs-var">txProposalProcedures</span></a></span><span>
</span><span id="line-1460"></span><span>
</span><span id="line-1461"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx era
 -&gt; Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era))
-&gt; TxBodyContent BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxBodyContent BuildTx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1462"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621681702728"><span class="hs-identifier hs-var">txbodycontent</span></a></span><span>
</span><span id="line-1463"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
-&gt; (TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era)
-&gt; TxBodyContent BuildTx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx era
-&gt; TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era
forall build era.
TxIns build era
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><a href="Cardano.Api.Tx.Body.html#setTxIns"><span class="hs-identifier hs-var">setTxIns</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx era
</span><a href="#local-6989586621681702735"><span class="hs-identifier hs-var">mappedTxIns</span></a></span><span>
</span><span id="line-1464"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
-&gt; (TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era)
-&gt; TxBodyContent BuildTx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx era
-&gt; TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era
forall build era.
TxMintValue build era
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><a href="Cardano.Api.Tx.Body.html#setTxMintValue"><span class="hs-identifier hs-var">setTxMintValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx era
</span><a href="#local-6989586621681702739"><span class="hs-identifier hs-var">mappedMintedVals</span></a></span><span>
</span><span id="line-1465"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
-&gt; (TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era)
-&gt; TxBodyContent BuildTx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxCertificates BuildTx era
-&gt; TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era
forall build era.
TxCertificates build era
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><a href="Cardano.Api.Tx.Body.html#setTxCertificates"><span class="hs-identifier hs-var">setTxCertificates</span></a></span><span> </span><span class="annot"><span class="annottext">TxCertificates BuildTx era
</span><a href="#local-6989586621681702741"><span class="hs-identifier hs-var">mappedTxCertificates</span></a></span><span>
</span><span id="line-1466"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
-&gt; (TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era)
-&gt; TxBodyContent BuildTx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
-&gt; TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era
forall build era.
TxWithdrawals build era
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><a href="Cardano.Api.Tx.Body.html#setTxWithdrawals"><span class="hs-identifier hs-var">setTxWithdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
</span><a href="#local-6989586621681702737"><span class="hs-identifier hs-var">mappedWithdrawals</span></a></span><span>
</span><span id="line-1467"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
-&gt; (TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era)
-&gt; TxBodyContent BuildTx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures BuildTx era))
-&gt; TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era
forall era build.
Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><a href="Cardano.Api.Tx.Body.html#setTxVotingProcedures"><span class="hs-identifier hs-var">setTxVotingProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures BuildTx era))
</span><a href="#local-6989586621681702743"><span class="hs-identifier hs-var">mappedVotes</span></a></span><span>
</span><span id="line-1468"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
-&gt; (TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era)
-&gt; TxBodyContent BuildTx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era))
-&gt; TxBodyContent BuildTx era -&gt; TxBodyContent BuildTx era
forall era build.
Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><a href="Cardano.Api.Tx.Body.html#setTxProposalProcedures"><span class="hs-identifier hs-var">setTxProposalProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures BuildTx era))
</span><a href="#local-6989586621681702745"><span class="hs-identifier hs-var">mappedProposals</span></a></span><span>
</span><span id="line-1469"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-1470"></span><span>    </span><span id="local-6989586621681701274"><span class="annot"><a href="#local-6989586621681702753"><span class="hs-identifier hs-type">substituteExecUnits</span></a></span><span>
</span><span id="line-1471"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndex"><span class="hs-identifier hs-type">ScriptWitnessIndex</span></a></span><span>
</span><span id="line-1472"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-type">ScriptWitness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701274"><span class="hs-identifier hs-type">witctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1473"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-type">ScriptWitness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701274"><span class="hs-identifier hs-type">witctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1474"></span><span>    </span><span id="local-6989586621681702753"><span class="annot"><span class="annottext">substituteExecUnits :: forall witctx.
ScriptWitnessIndex
-&gt; ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
</span><a href="#local-6989586621681702753"><span class="hs-identifier hs-var hs-var">substituteExecUnits</span></a></span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681702754"><span class="annot"><span class="annottext">wit :: ScriptWitness witctx era
</span><a href="#local-6989586621681702754"><span class="hs-identifier hs-var">wit</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Api.Script.html#SimpleScriptWitness"><span class="hs-identifier hs-type">SimpleScriptWitness</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitness witctx era
</span><a href="#local-6989586621681702754"><span class="hs-identifier hs-var">wit</span></a></span><span>
</span><span id="line-1475"></span><span>    </span><span class="annot"><a href="#local-6989586621681702753"><span class="hs-identifier hs-var">substituteExecUnits</span></a></span><span> </span><span id="local-6989586621681702756"><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681702756"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#PlutusScriptWitness"><span class="hs-identifier hs-type">PlutusScriptWitness</span></a></span><span> </span><span id="local-6989586621681702759"><span class="annot"><span class="annottext">ScriptLanguageInEra lang era
</span><a href="#local-6989586621681702759"><span class="hs-identifier hs-var">langInEra</span></a></span></span><span> </span><span id="local-6989586621681702760"><span class="annot"><span class="annottext">PlutusScriptVersion lang
</span><a href="#local-6989586621681702760"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621681702761"><span class="annot"><span class="annottext">PlutusScriptOrReferenceInput lang
</span><a href="#local-6989586621681702761"><span class="hs-identifier hs-var">script</span></a></span></span><span> </span><span id="local-6989586621681702762"><span class="annot"><span class="annottext">ScriptDatum witctx
</span><a href="#local-6989586621681702762"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span id="local-6989586621681702763"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621681702763"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExecutionUnits
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1476"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
-&gt; Map ScriptWitnessIndex ExecutionUnits -&gt; Maybe ExecutionUnits
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681702756"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702727"><span class="hs-identifier hs-var">exUnitsMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1477"></span><span>        </span><span class="annot"><span class="annottext">Maybe ExecutionUnits
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1478"></span><span>          </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyErrorAutoBalance era
 -&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era))
-&gt; TxBodyErrorAutoBalance era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
-&gt; Map ScriptWitnessIndex ExecutionUnits
-&gt; TxBodyErrorAutoBalance era
forall era.
ScriptWitnessIndex
-&gt; Map ScriptWitnessIndex ExecutionUnits
-&gt; TxBodyErrorAutoBalance era
</span><a href="Cardano.Api.Fees.html#TxBodyErrorScriptWitnessIndexMissingFromExecUnitsMap"><span class="hs-identifier hs-var">TxBodyErrorScriptWitnessIndexMissingFromExecUnitsMap</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621681702756"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptWitnessIndex ExecutionUnits
</span><a href="#local-6989586621681702727"><span class="hs-identifier hs-var">exUnitsMap</span></a></span><span>
</span><span id="line-1479"></span><span>        </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681702764"><span class="annot"><span class="annottext">ExecutionUnits
</span><a href="#local-6989586621681702764"><span class="hs-identifier hs-var">exunits</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1480"></span><span>          </span><span class="annot"><span class="annottext">ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness witctx era
 -&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era))
-&gt; ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1481"></span><span>            </span><span class="annot"><span class="annottext">ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; ScriptRedeemer
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; ScriptRedeemer
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
</span><a href="Cardano.Api.Script.html#PlutusScriptWitness"><span class="hs-identifier hs-var">PlutusScriptWitness</span></a></span><span>
</span><span id="line-1482"></span><span>              </span><span class="annot"><span class="annottext">ScriptLanguageInEra lang era
</span><a href="#local-6989586621681702759"><span class="hs-identifier hs-var">langInEra</span></a></span><span>
</span><span id="line-1483"></span><span>              </span><span class="annot"><span class="annottext">PlutusScriptVersion lang
</span><a href="#local-6989586621681702760"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-1484"></span><span>              </span><span class="annot"><span class="annottext">PlutusScriptOrReferenceInput lang
</span><a href="#local-6989586621681702761"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-1485"></span><span>              </span><span class="annot"><span class="annottext">ScriptDatum witctx
</span><a href="#local-6989586621681702762"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-1486"></span><span>              </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621681702763"><span class="hs-identifier hs-var">redeemer</span></a></span><span>
</span><span id="line-1487"></span><span>              </span><span class="annot"><span class="annottext">ExecutionUnits
</span><a href="#local-6989586621681702764"><span class="hs-identifier hs-var">exunits</span></a></span><span>
</span><span id="line-1488"></span><span>
</span><span id="line-1489"></span><span>    </span><span class="annot"><a href="#local-6989586621681702736"><span class="hs-identifier hs-type">mapScriptWitnessesTxIns</span></a></span><span>
</span><span id="line-1490"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#WitCtxTxIn"><span class="hs-identifier hs-type">WitCtxTxIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1491"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#WitCtxTxIn"><span class="hs-identifier hs-type">WitCtxTxIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1492"></span><span>    </span><span id="local-6989586621681702736"><span class="annot"><span class="annottext">mapScriptWitnessesTxIns :: TxIns BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxIns BuildTx era)
</span><a href="#local-6989586621681702736"><span class="hs-identifier hs-var hs-var">mapScriptWitnessesTxIns</span></a></span></span><span> </span><span id="local-6989586621681702765"><span class="annot"><span class="annottext">TxIns BuildTx era
</span><a href="#local-6989586621681702765"><span class="hs-identifier hs-var">txins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1493"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681702766"><span class="hs-identifier hs-type">mappedScriptWitnesses</span></a></span><span>
</span><span id="line-1494"></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Api.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span>
</span><span id="line-1495"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#WitCtxTxIn"><span class="hs-identifier hs-type">WitCtxTxIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1496"></span><span>                 </span><span class="hs-special">)</span><span>
</span><span id="line-1497"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-1498"></span><span>          </span><span id="local-6989586621681702766"><span class="annot"><span class="annottext">mappedScriptWitnesses :: [(TxIn,
  Either
    (TxBodyErrorAutoBalance era)
    (BuildTxWith BuildTx (Witness WitCtxTxIn era)))]
</span><a href="#local-6989586621681702766"><span class="hs-identifier hs-var hs-var">mappedScriptWitnesses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1499"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681702767"><span class="hs-identifier hs-var">txin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-var">BuildTxWith</span></a></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn era))
-&gt; Either (TxBodyErrorAutoBalance era) (Witness WitCtxTxIn era)
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (BuildTxWith BuildTx (Witness WitCtxTxIn era))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (Witness WitCtxTxIn era)
</span><a href="#local-6989586621681702770"><span class="hs-identifier hs-var">wit'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1500"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- The tx ins are indexed in the map order by txid</span><span>
</span><span id="line-1501"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681702771"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681702771"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681702767"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681702767"><span class="hs-identifier hs-var">txin</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span id="local-6989586621681702774"><span class="annot"><span class="annottext">Witness WitCtxTxIn era
</span><a href="#local-6989586621681702774"><span class="hs-identifier hs-var">wit</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Word32]
-&gt; TxIns BuildTx era
-&gt; [(Word32, (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era)))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIns BuildTx era -&gt; TxIns BuildTx era
forall v. [(TxIn, v)] -&gt; [(TxIn, v)]
</span><a href="Cardano.Api.Tx.Body.html#orderTxIns"><span class="hs-identifier hs-var">orderTxIns</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx era
</span><a href="#local-6989586621681702765"><span class="hs-identifier hs-var">txins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1502"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702770"><span class="annot"><span class="annottext">wit' :: Either (TxBodyErrorAutoBalance era) (Witness WitCtxTxIn era)
</span><a href="#local-6989586621681702770"><span class="hs-identifier hs-var hs-var">wit'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn era
</span><a href="#local-6989586621681702774"><span class="hs-identifier hs-var">wit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1503"></span><span>                    </span><span class="annot"><a href="Cardano.Api.Script.html#KeyWitness"><span class="hs-identifier hs-type">KeyWitness</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn era
-&gt; Either (TxBodyErrorAutoBalance era) (Witness WitCtxTxIn era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn era
</span><a href="#local-6989586621681702774"><span class="hs-identifier hs-var">wit</span></a></span><span>
</span><span id="line-1504"></span><span>                    </span><span class="annot"><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-type">ScriptWitness</span></a></span><span> </span><span id="local-6989586621681702777"><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
</span><a href="#local-6989586621681702777"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621681702778"><span class="annot"><span class="annottext">ScriptWitness WitCtxTxIn era
</span><a href="#local-6989586621681702778"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn era -&gt; Witness WitCtxTxIn era
forall witctx era.
ScriptWitnessInCtx witctx
-&gt; ScriptWitness witctx era -&gt; Witness witctx era
</span><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-var">ScriptWitness</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
</span><a href="#local-6989586621681702777"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn era -&gt; Witness WitCtxTxIn era)
-&gt; Either
     (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxTxIn era)
-&gt; Either (TxBodyErrorAutoBalance era) (Witness WitCtxTxIn era)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxTxIn era)
</span><a href="#local-6989586621681702779"><span class="hs-identifier hs-var">witness'</span></a></span><span>
</span><span id="line-1505"></span><span>                     </span><span class="hs-keyword">where</span><span>
</span><span id="line-1506"></span><span>                      </span><span id="local-6989586621681702779"><span class="annot"><span class="annottext">witness' :: Either (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxTxIn era)
</span><a href="#local-6989586621681702779"><span class="hs-identifier hs-var hs-var">witness'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
-&gt; ScriptWitness WitCtxTxIn era
-&gt; Either
     (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxTxIn era)
forall witctx.
ScriptWitnessIndex
-&gt; ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
</span><a href="#local-6989586621681702753"><span class="hs-identifier hs-var">substituteExecUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; ScriptWitnessIndex
</span><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndexTxIn"><span class="hs-identifier hs-var">ScriptWitnessIndexTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681702771"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptWitness WitCtxTxIn era
</span><a href="#local-6989586621681702778"><span class="hs-identifier hs-var">witness</span></a></span><span>
</span><span id="line-1507"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1508"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">((TxIn,
  Either
    (TxBodyErrorAutoBalance era)
    (BuildTxWith BuildTx (Witness WitCtxTxIn era)))
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era)))
-&gt; [(TxIn,
     Either
       (TxBodyErrorAutoBalance era)
       (BuildTxWith BuildTx (Witness WitCtxTxIn era)))]
-&gt; Either (TxBodyErrorAutoBalance era) (TxIns BuildTx era)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span>
</span><span id="line-1509"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681702782"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681702782"><span class="hs-identifier hs-var">txIn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702783"><span class="annot"><span class="annottext">Either
  (TxBodyErrorAutoBalance era)
  (BuildTxWith BuildTx (Witness WitCtxTxIn era))
</span><a href="#local-6989586621681702783"><span class="hs-identifier hs-var">eWitness</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1510"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  (TxBodyErrorAutoBalance era)
  (BuildTxWith BuildTx (Witness WitCtxTxIn era))
</span><a href="#local-6989586621681702783"><span class="hs-identifier hs-var">eWitness</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1511"></span><span>                  </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681702784"><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681702784"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era))
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681702784"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1512"></span><span>                  </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681702785"><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn era)
</span><a href="#local-6989586621681702785"><span class="hs-identifier hs-var">wit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era))
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621681702782"><span class="hs-identifier hs-var">txIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn era)
</span><a href="#local-6989586621681702785"><span class="hs-identifier hs-var">wit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1513"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1514"></span><span>            </span><span class="annot"><span class="annottext">[(TxIn,
  Either
    (TxBodyErrorAutoBalance era)
    (BuildTxWith BuildTx (Witness WitCtxTxIn era)))]
</span><a href="#local-6989586621681702766"><span class="hs-identifier hs-var">mappedScriptWitnesses</span></a></span><span>
</span><span id="line-1515"></span><span>
</span><span id="line-1516"></span><span>    </span><span class="annot"><a href="#local-6989586621681702738"><span class="hs-identifier hs-type">mapScriptWitnessesWithdrawals</span></a></span><span>
</span><span id="line-1517"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxWithdrawals"><span class="hs-identifier hs-type">TxWithdrawals</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1518"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxWithdrawals"><span class="hs-identifier hs-type">TxWithdrawals</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1519"></span><span>    </span><span id="local-6989586621681702738"><span class="annot"><span class="annottext">mapScriptWitnessesWithdrawals :: TxWithdrawals BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxWithdrawals BuildTx era)
</span><a href="#local-6989586621681702738"><span class="hs-identifier hs-var hs-var">mapScriptWitnessesWithdrawals</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
</span><a href="Cardano.Api.Tx.Body.html#TxWithdrawalsNone"><span class="hs-identifier hs-var">TxWithdrawalsNone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxWithdrawals BuildTx era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">TxWithdrawals BuildTx era
forall build era. TxWithdrawals build era
</span><a href="Cardano.Api.Tx.Body.html#TxWithdrawalsNone"><span class="hs-identifier hs-var">TxWithdrawalsNone</span></a></span><span>
</span><span id="line-1520"></span><span>    </span><span class="annot"><a href="#local-6989586621681702738"><span class="hs-identifier hs-var">mapScriptWitnessesWithdrawals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxWithdrawals"><span class="hs-identifier hs-type">TxWithdrawals</span></a></span><span> </span><span id="local-6989586621681702787"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702787"><span class="hs-identifier hs-var">supported</span></a></span></span><span> </span><span id="local-6989586621681702788"><span class="annot"><span class="annottext">[(StakeAddress, Coin,
  BuildTxWith BuildTx (Witness WitCtxStake era))]
</span><a href="#local-6989586621681702788"><span class="hs-identifier hs-var">withdrawals</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1521"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681702789"><span class="hs-identifier hs-type">mappedWithdrawals</span></a></span><span>
</span><span id="line-1522"></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Api.Address.html#StakeAddress"><span class="hs-identifier hs-type">StakeAddress</span></a></span><span>
</span><span id="line-1523"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span><span>
</span><span id="line-1524"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#WitCtxStake"><span class="hs-identifier hs-type">WitCtxStake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1525"></span><span>                 </span><span class="hs-special">)</span><span>
</span><span id="line-1526"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-1527"></span><span>          </span><span id="local-6989586621681702789"><span class="annot"><span class="annottext">mappedWithdrawals :: [(StakeAddress, Coin,
  Either
    (TxBodyErrorAutoBalance era)
    (BuildTxWith BuildTx (Witness WitCtxStake era)))]
</span><a href="#local-6989586621681702789"><span class="hs-identifier hs-var hs-var">mappedWithdrawals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1528"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakeAddress
</span><a href="#local-6989586621681702790"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702791"><span class="hs-identifier hs-var">withdrawal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxStake era
-&gt; BuildTxWith BuildTx (Witness WitCtxStake era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-var">BuildTxWith</span></a></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxStake era
 -&gt; BuildTxWith BuildTx (Witness WitCtxStake era))
-&gt; Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era)
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (BuildTxWith BuildTx (Witness WitCtxStake era))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era)
</span><a href="#local-6989586621681702793"><span class="hs-identifier hs-var">mappedWitness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1529"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- The withdrawals are indexed in the map order by stake credential</span><span>
</span><span id="line-1530"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681702794"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681702794"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681702790"><span class="annot"><span class="annottext">StakeAddress
</span><a href="#local-6989586621681702790"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702791"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702791"><span class="hs-identifier hs-var">withdrawal</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span id="local-6989586621681702796"><span class="annot"><span class="annottext">Witness WitCtxStake era
</span><a href="#local-6989586621681702796"><span class="hs-identifier hs-var">wit</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Word32]
-&gt; [(StakeAddress, Coin,
     BuildTxWith BuildTx (Witness WitCtxStake era))]
-&gt; [(Word32,
     (StakeAddress, Coin,
      BuildTxWith BuildTx (Witness WitCtxStake era)))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(StakeAddress, Coin,
  BuildTxWith BuildTx (Witness WitCtxStake era))]
-&gt; [(StakeAddress, Coin,
     BuildTxWith BuildTx (Witness WitCtxStake era))]
forall x v. [(StakeAddress, x, v)] -&gt; [(StakeAddress, x, v)]
</span><a href="Cardano.Api.Tx.Body.html#orderStakeAddrs"><span class="hs-identifier hs-var">orderStakeAddrs</span></a></span><span> </span><span class="annot"><span class="annottext">[(StakeAddress, Coin,
  BuildTxWith BuildTx (Witness WitCtxStake era))]
</span><a href="#local-6989586621681702788"><span class="hs-identifier hs-var">withdrawals</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1531"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702793"><span class="annot"><span class="annottext">mappedWitness :: Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era)
</span><a href="#local-6989586621681702793"><span class="hs-identifier hs-var hs-var">mappedWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxStake era
 -&gt; Either
      (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era))
-&gt; Witness WitCtxStake era
-&gt; Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era)
forall witctx.
(ScriptWitness witctx era
 -&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era))
-&gt; Witness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (Witness witctx era)
</span><a href="#local-6989586621681702798"><span class="hs-identifier hs-var">adjustWitness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptWitnessIndex
-&gt; ScriptWitness WitCtxStake era
-&gt; Either
     (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
forall witctx.
ScriptWitnessIndex
-&gt; ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
</span><a href="#local-6989586621681702753"><span class="hs-identifier hs-var">substituteExecUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; ScriptWitnessIndex
</span><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndexWithdrawal"><span class="hs-identifier hs-var">ScriptWitnessIndexWithdrawal</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681702794"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxStake era
</span><a href="#local-6989586621681702796"><span class="hs-identifier hs-var">wit</span></a></span><span>
</span><span id="line-1532"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1533"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; [(StakeAddress, Coin,
     BuildTxWith BuildTx (Witness WitCtxStake era))]
-&gt; TxWithdrawals BuildTx era
forall era build.
ShelleyBasedEra era
-&gt; [(StakeAddress, Coin,
     BuildTxWith build (Witness WitCtxStake era))]
-&gt; TxWithdrawals build era
</span><a href="Cardano.Api.Tx.Body.html#TxWithdrawals"><span class="hs-identifier hs-var">TxWithdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702787"><span class="hs-identifier hs-var">supported</span></a></span><span>
</span><span id="line-1534"></span><span>            </span><span class="annot"><span class="annottext">([(StakeAddress, Coin,
   BuildTxWith BuildTx (Witness WitCtxStake era))]
 -&gt; TxWithdrawals BuildTx era)
-&gt; Either
     (TxBodyErrorAutoBalance era)
     [(StakeAddress, Coin,
       BuildTxWith BuildTx (Witness WitCtxStake era))]
-&gt; Either (TxBodyErrorAutoBalance era) (TxWithdrawals BuildTx era)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((StakeAddress, Coin,
  Either
    (TxBodyErrorAutoBalance era)
    (BuildTxWith BuildTx (Witness WitCtxStake era)))
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (StakeAddress, Coin,
       BuildTxWith BuildTx (Witness WitCtxStake era)))
-&gt; [(StakeAddress, Coin,
     Either
       (TxBodyErrorAutoBalance era)
       (BuildTxWith BuildTx (Witness WitCtxStake era)))]
-&gt; Either
     (TxBodyErrorAutoBalance era)
     [(StakeAddress, Coin,
       BuildTxWith BuildTx (Witness WitCtxStake era))]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span>
</span><span id="line-1535"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681702800"><span class="annot"><span class="annottext">StakeAddress
</span><a href="#local-6989586621681702800"><span class="hs-identifier hs-var">sAddr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702801"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702801"><span class="hs-identifier hs-var">ll</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702802"><span class="annot"><span class="annottext">Either
  (TxBodyErrorAutoBalance era)
  (BuildTxWith BuildTx (Witness WitCtxStake era))
</span><a href="#local-6989586621681702802"><span class="hs-identifier hs-var">eWitness</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1536"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  (TxBodyErrorAutoBalance era)
  (BuildTxWith BuildTx (Witness WitCtxStake era))
</span><a href="#local-6989586621681702802"><span class="hs-identifier hs-var">eWitness</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1537"></span><span>                    </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681702803"><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681702803"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (StakeAddress, Coin, BuildTxWith BuildTx (Witness WitCtxStake era))
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681702803"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1538"></span><span>                    </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681702804"><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxStake era)
</span><a href="#local-6989586621681702804"><span class="hs-identifier hs-var">wit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(StakeAddress, Coin, BuildTxWith BuildTx (Witness WitCtxStake era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (StakeAddress, Coin, BuildTxWith BuildTx (Witness WitCtxStake era))
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakeAddress
</span><a href="#local-6989586621681702800"><span class="hs-identifier hs-var">sAddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621681702801"><span class="hs-identifier hs-var">ll</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxStake era)
</span><a href="#local-6989586621681702804"><span class="hs-identifier hs-var">wit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1539"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-1540"></span><span>              </span><span class="annot"><span class="annottext">[(StakeAddress, Coin,
  Either
    (TxBodyErrorAutoBalance era)
    (BuildTxWith BuildTx (Witness WitCtxStake era)))]
</span><a href="#local-6989586621681702789"><span class="hs-identifier hs-var">mappedWithdrawals</span></a></span><span>
</span><span id="line-1541"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-1542"></span><span>      </span><span id="local-6989586621681701301"><span class="annot"><a href="#local-6989586621681702798"><span class="hs-identifier hs-type">adjustWitness</span></a></span><span>
</span><span id="line-1543"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-type">ScriptWitness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701301"><span class="hs-identifier hs-type">witctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-type">ScriptWitness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701301"><span class="hs-identifier hs-type">witctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1544"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701301"><span class="hs-identifier hs-type">witctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1545"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701301"><span class="hs-identifier hs-type">witctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1546"></span><span>      </span><span id="local-6989586621681702798"><span class="annot"><span class="annottext">adjustWitness :: forall witctx.
(ScriptWitness witctx era
 -&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era))
-&gt; Witness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (Witness witctx era)
</span><a href="#local-6989586621681702798"><span class="hs-identifier hs-var hs-var">adjustWitness</span></a></span></span><span> </span><span class="annot"><span class="annottext">ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#KeyWitness"><span class="hs-identifier hs-type">KeyWitness</span></a></span><span> </span><span id="local-6989586621681702806"><span class="annot"><span class="annottext">KeyWitnessInCtx witctx
</span><a href="#local-6989586621681702806"><span class="hs-identifier hs-var">ctx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Witness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (Witness witctx era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(Witness witctx era
 -&gt; Either (TxBodyErrorAutoBalance era) (Witness witctx era))
-&gt; Witness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (Witness witctx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">KeyWitnessInCtx witctx -&gt; Witness witctx era
forall witctx era. KeyWitnessInCtx witctx -&gt; Witness witctx era
</span><a href="Cardano.Api.Script.html#KeyWitness"><span class="hs-identifier hs-var">KeyWitness</span></a></span><span> </span><span class="annot"><span class="annottext">KeyWitnessInCtx witctx
</span><a href="#local-6989586621681702806"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1547"></span><span>      </span><span class="annot"><a href="#local-6989586621681702798"><span class="hs-identifier hs-var">adjustWitness</span></a></span><span> </span><span id="local-6989586621681702807"><span class="annot"><span class="annottext">ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
</span><a href="#local-6989586621681702807"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-type">ScriptWitness</span></a></span><span> </span><span id="local-6989586621681702808"><span class="annot"><span class="annottext">ScriptWitnessInCtx witctx
</span><a href="#local-6989586621681702808"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621681702809"><span class="annot"><span class="annottext">ScriptWitness witctx era
</span><a href="#local-6989586621681702809"><span class="hs-identifier hs-var">witness'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx witctx
-&gt; ScriptWitness witctx era -&gt; Witness witctx era
forall witctx era.
ScriptWitnessInCtx witctx
-&gt; ScriptWitness witctx era -&gt; Witness witctx era
</span><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-var">ScriptWitness</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx witctx
</span><a href="#local-6989586621681702808"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness witctx era -&gt; Witness witctx era)
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
-&gt; Either (TxBodyErrorAutoBalance era) (Witness witctx era)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
</span><a href="#local-6989586621681702807"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitness witctx era
</span><a href="#local-6989586621681702809"><span class="hs-identifier hs-var">witness'</span></a></span><span>
</span><span id="line-1548"></span><span>
</span><span id="line-1549"></span><span>    </span><span class="annot"><a href="#local-6989586621681702742"><span class="hs-identifier hs-type">mapScriptWitnessesCertificates</span></a></span><span>
</span><span id="line-1550"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxCertificates"><span class="hs-identifier hs-type">TxCertificates</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1551"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxCertificates"><span class="hs-identifier hs-type">TxCertificates</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1552"></span><span>    </span><span id="local-6989586621681702742"><span class="annot"><span class="annottext">mapScriptWitnessesCertificates :: TxCertificates BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxCertificates BuildTx era)
</span><a href="#local-6989586621681702742"><span class="hs-identifier hs-var hs-var">mapScriptWitnessesCertificates</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxCertificates BuildTx era
</span><a href="Cardano.Api.Tx.Body.html#TxCertificatesNone"><span class="hs-identifier hs-var">TxCertificatesNone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxCertificates BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxCertificates BuildTx era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">TxCertificates BuildTx era
forall build era. TxCertificates build era
</span><a href="Cardano.Api.Tx.Body.html#TxCertificatesNone"><span class="hs-identifier hs-var">TxCertificatesNone</span></a></span><span>
</span><span id="line-1553"></span><span>    </span><span class="annot"><a href="#local-6989586621681702742"><span class="hs-identifier hs-var">mapScriptWitnessesCertificates</span></a></span><span>
</span><span id="line-1554"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxCertificates"><span class="hs-identifier hs-type">TxCertificates</span></a></span><span>
</span><span id="line-1555"></span><span>          </span><span id="local-6989586621681702810"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702810"><span class="hs-identifier hs-var">supported</span></a></span></span><span>
</span><span id="line-1556"></span><span>          </span><span id="local-6989586621681702811"><span class="annot"><span class="annottext">[Certificate era]
</span><a href="#local-6989586621681702811"><span class="hs-identifier hs-var">certs</span></a></span></span><span>
</span><span id="line-1557"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span id="local-6989586621681702821"><span class="annot"><span class="annottext">[(StakeCredential, Witness WitCtxStake era)]
</span><a href="#local-6989586621681702821"><span class="hs-identifier hs-var">witnesses</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1558"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1559"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681702822"><span class="hs-identifier hs-type">mappedScriptWitnesses</span></a></span><span>
</span><span id="line-1560"></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Address.html#StakeCredential"><span class="hs-identifier hs-type">StakeCredential</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#WitCtxStake"><span class="hs-identifier hs-type">WitCtxStake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1561"></span><span>            </span><span id="local-6989586621681702822"><span class="annot"><span class="annottext">mappedScriptWitnesses :: [(StakeCredential,
  Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era))]
</span><a href="#local-6989586621681702822"><span class="hs-identifier hs-var hs-var">mappedScriptWitnesses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1562"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakeCredential
</span><a href="#local-6989586621681702823"><span class="hs-identifier hs-var">stakecred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxStake
-&gt; ScriptWitness WitCtxStake era -&gt; Witness WitCtxStake era
forall witctx era.
ScriptWitnessInCtx witctx
-&gt; ScriptWitness witctx era -&gt; Witness witctx era
</span><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-var">ScriptWitness</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxStake
</span><a href="#local-6989586621681702824"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxStake era -&gt; Witness WitCtxStake era)
-&gt; Either
     (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
-&gt; Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
</span><a href="#local-6989586621681702825"><span class="hs-identifier hs-var">witness'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1563"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- The certs are indexed in list order</span><span>
</span><span id="line-1564"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621681702826"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681702826"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702827"><span class="annot"><span class="annottext">Certificate era
</span><a href="#local-6989586621681702827"><span class="hs-identifier hs-var">cert</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Word32] -&gt; [Certificate era] -&gt; [(Word32, Certificate era)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Certificate era]
</span><a href="#local-6989586621681702811"><span class="hs-identifier hs-var">certs</span></a></span><span>
</span><span id="line-1565"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702823"><span class="annot"><span class="annottext">StakeCredential
</span><a href="#local-6989586621681702823"><span class="hs-identifier hs-var">stakecred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe StakeCredential -&gt; [StakeCredential]
forall a. Maybe a -&gt; [a]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html#maybeToList"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate era -&gt; Maybe StakeCredential
forall era. Certificate era -&gt; Maybe StakeCredential
</span><a href="Cardano.Api.Certificate.html#selectStakeCredentialWitness"><span class="hs-identifier hs-var">selectStakeCredentialWitness</span></a></span><span> </span><span class="annot"><span class="annottext">Certificate era
</span><a href="#local-6989586621681702827"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1566"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-type">ScriptWitness</span></a></span><span> </span><span id="local-6989586621681702824"><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxStake
</span><a href="#local-6989586621681702824"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621681702830"><span class="annot"><span class="annottext">ScriptWitness WitCtxStake era
</span><a href="#local-6989586621681702830"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1567"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (Witness WitCtxStake era) -&gt; [Witness WitCtxStake era]
forall a. Maybe a -&gt; [a]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html#maybeToList"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakeCredential
-&gt; [(StakeCredential, Witness WitCtxStake era)]
-&gt; Maybe (Witness WitCtxStake era)
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">List.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">StakeCredential
</span><a href="#local-6989586621681702823"><span class="hs-identifier hs-var">stakecred</span></a></span><span> </span><span class="annot"><span class="annottext">[(StakeCredential, Witness WitCtxStake era)]
</span><a href="#local-6989586621681702821"><span class="hs-identifier hs-var">witnesses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1568"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702825"><span class="annot"><span class="annottext">witness' :: Either (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
</span><a href="#local-6989586621681702825"><span class="hs-identifier hs-var hs-var">witness'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
-&gt; ScriptWitness WitCtxStake era
-&gt; Either
     (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
forall witctx.
ScriptWitnessIndex
-&gt; ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
</span><a href="#local-6989586621681702753"><span class="hs-identifier hs-var">substituteExecUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; ScriptWitnessIndex
</span><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndexCertificate"><span class="hs-identifier hs-var">ScriptWitnessIndexCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681702826"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptWitness WitCtxStake era
</span><a href="#local-6989586621681702830"><span class="hs-identifier hs-var">witness</span></a></span><span>
</span><span id="line-1569"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-1570"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; [Certificate era]
-&gt; BuildTxWith BuildTx [(StakeCredential, Witness WitCtxStake era)]
-&gt; TxCertificates BuildTx era
forall era build.
ShelleyBasedEra era
-&gt; [Certificate era]
-&gt; BuildTxWith build [(StakeCredential, Witness WitCtxStake era)]
-&gt; TxCertificates build era
</span><a href="Cardano.Api.Tx.Body.html#TxCertificates"><span class="hs-identifier hs-var">TxCertificates</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702810"><span class="hs-identifier hs-var">supported</span></a></span><span> </span><span class="annot"><span class="annottext">[Certificate era]
</span><a href="#local-6989586621681702811"><span class="hs-identifier hs-var">certs</span></a></span><span> </span><span class="annot"><span class="annottext">(BuildTxWith BuildTx [(StakeCredential, Witness WitCtxStake era)]
 -&gt; TxCertificates BuildTx era)
-&gt; ([(StakeCredential, Witness WitCtxStake era)]
    -&gt; BuildTxWith
         BuildTx [(StakeCredential, Witness WitCtxStake era)])
-&gt; [(StakeCredential, Witness WitCtxStake era)]
-&gt; TxCertificates BuildTx era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[(StakeCredential, Witness WitCtxStake era)]
-&gt; BuildTxWith BuildTx [(StakeCredential, Witness WitCtxStake era)]
forall a. a -&gt; BuildTxWith BuildTx a
</span><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-var">BuildTxWith</span></a></span><span>
</span><span id="line-1571"></span><span>              </span><span class="annot"><span class="annottext">([(StakeCredential, Witness WitCtxStake era)]
 -&gt; TxCertificates BuildTx era)
-&gt; Either
     (TxBodyErrorAutoBalance era)
     [(StakeCredential, Witness WitCtxStake era)]
-&gt; Either (TxBodyErrorAutoBalance era) (TxCertificates BuildTx era)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((StakeCredential,
  Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era))
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (StakeCredential, Witness WitCtxStake era))
-&gt; [(StakeCredential,
     Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era))]
-&gt; Either
     (TxBodyErrorAutoBalance era)
     [(StakeCredential, Witness WitCtxStake era)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span>
</span><span id="line-1572"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681702833"><span class="annot"><span class="annottext">StakeCredential
</span><a href="#local-6989586621681702833"><span class="hs-identifier hs-var">sCred</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702834"><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era)
</span><a href="#local-6989586621681702834"><span class="hs-identifier hs-var">eScriptWitness</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1573"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era)
</span><a href="#local-6989586621681702834"><span class="hs-identifier hs-var">eScriptWitness</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1574"></span><span>                      </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681702835"><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681702835"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (StakeCredential, Witness WitCtxStake era)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyErrorAutoBalance era
</span><a href="#local-6989586621681702835"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1575"></span><span>                      </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681702836"><span class="annot"><span class="annottext">Witness WitCtxStake era
</span><a href="#local-6989586621681702836"><span class="hs-identifier hs-var">wit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(StakeCredential, Witness WitCtxStake era)
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (StakeCredential, Witness WitCtxStake era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakeCredential
</span><a href="#local-6989586621681702833"><span class="hs-identifier hs-var">sCred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxStake era
</span><a href="#local-6989586621681702836"><span class="hs-identifier hs-var">wit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1576"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1577"></span><span>                </span><span class="annot"><span class="annottext">[(StakeCredential,
  Either (TxBodyErrorAutoBalance era) (Witness WitCtxStake era))]
</span><a href="#local-6989586621681702822"><span class="hs-identifier hs-var">mappedScriptWitnesses</span></a></span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span>    </span><span id="local-6989586621681701260"><span class="annot"><a href="#local-6989586621681702744"><span class="hs-identifier hs-type">mapScriptWitnessesVotes</span></a></span><span>
</span><span id="line-1580"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-type">Featured</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ConwayEraOnwards.html#ConwayEraOnwards"><span class="hs-identifier hs-type">ConwayEraOnwards</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxVotingProcedures"><span class="hs-identifier hs-type">TxVotingProcedures</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701260"><span class="hs-identifier hs-type">build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1581"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span>
</span><span id="line-1582"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1583"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-type">Featured</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ConwayEraOnwards.html#ConwayEraOnwards"><span class="hs-identifier hs-type">ConwayEraOnwards</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxVotingProcedures"><span class="hs-identifier hs-type">TxVotingProcedures</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701260"><span class="hs-identifier hs-type">build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1584"></span><span>    </span><span id="local-6989586621681702744"><span class="annot"><span class="annottext">mapScriptWitnessesVotes :: forall build.
Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxVotingProcedures build era)))
</span><a href="#local-6989586621681702744"><span class="hs-identifier hs-var hs-var">mapScriptWitnessesVotes</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxVotingProcedures build era)))
forall a. a -&gt; Either (TxBodyErrorAutoBalance era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
forall a. Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1585"></span><span>    </span><span class="annot"><a href="#local-6989586621681702744"><span class="hs-identifier hs-var">mapScriptWitnessesVotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-type">Featured</span></a></span><span> </span><span class="annot"><span class="annottext">ConwayEraOnwards era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxVotingProcedures build era
</span><a href="Cardano.Api.Tx.Body.html#TxVotingProceduresNone"><span class="hs-identifier hs-var">TxVotingProceduresNone</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxVotingProcedures build era)))
forall a. a -&gt; Either (TxBodyErrorAutoBalance era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
forall a. Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1586"></span><span>    </span><span class="annot"><a href="#local-6989586621681702744"><span class="hs-identifier hs-var">mapScriptWitnessesVotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-type">Featured</span></a></span><span> </span><span class="annot"><span class="annottext">ConwayEraOnwards era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxVotingProcedures"><span class="hs-identifier hs-type">TxVotingProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">VotingProcedures (ShelleyLedgerEra era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BuildTxWith
  build
  (Map
     (Voter (EraCrypto (ShelleyLedgerEra era)))
     (ScriptWitness WitCtxStake era))
</span><a href="Cardano.Api.Tx.Body.html#ViewTx"><span class="hs-identifier hs-var">ViewTx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxVotingProcedures build era)))
forall a. a -&gt; Either (TxBodyErrorAutoBalance era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
forall a. Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1587"></span><span>    </span><span class="annot"><a href="#local-6989586621681702744"><span class="hs-identifier hs-var">mapScriptWitnessesVotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-type">Featured</span></a></span><span> </span><span id="local-6989586621681702845"><span class="annot"><span class="annottext">ConwayEraOnwards era
</span><a href="#local-6989586621681702845"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxVotingProcedures"><span class="hs-identifier hs-type">TxVotingProcedures</span></a></span><span> </span><span id="local-6989586621681702846"><span class="annot"><span class="annottext">VotingProcedures (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702846"><span class="hs-identifier hs-var">vProcedures</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span id="local-6989586621681702857"><span class="annot"><span class="annottext">Map
  (Voter (EraCrypto (ShelleyLedgerEra era)))
  (ScriptWitness WitCtxStake era)
</span><a href="#local-6989586621681702857"><span class="hs-identifier hs-var">sWitMap</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1588"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702858"><span class="annot"><span class="annottext">eSubstitutedExecutionUnits :: [(Voter (EraCrypto (ShelleyLedgerEra era)),
  Either
    (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era))]
</span><a href="#local-6989586621681702858"><span class="hs-identifier hs-var hs-var">eSubstitutedExecutionUnits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1589"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Voter (EraCrypto (ShelleyLedgerEra era))
</span><a href="#local-6989586621681702859"><span class="hs-identifier hs-var">vote</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
</span><a href="#local-6989586621681702860"><span class="hs-identifier hs-var">updatedWitness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1590"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702861"><span class="annot"><span class="annottext">allVoteMap :: Map
  (Voter (EraCrypto (ShelleyLedgerEra era)))
  (Map
     (GovActionId (EraCrypto (ShelleyLedgerEra era)))
     (VotingProcedure (ShelleyLedgerEra era)))
</span><a href="#local-6989586621681702861"><span class="hs-identifier hs-var hs-var">allVoteMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VotingProcedures (ShelleyLedgerEra era)
-&gt; Map
     (Voter (EraCrypto (ShelleyLedgerEra era)))
     (Map
        (GovActionId (EraCrypto (ShelleyLedgerEra era)))
        (VotingProcedure (ShelleyLedgerEra era)))
forall era.
VotingProcedures era
-&gt; Map
     (Voter (EraCrypto era))
     (Map (GovActionId (EraCrypto era)) (VotingProcedure era))
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-conway-1.16.0.0-1b52c433b0ad649d47773d184a3283a14eb81aa0d4a1b9ccb86693153e8b2daa/share/doc/html/src/Cardano.Ledger.Conway.Governance.Procedures.html#unVotingProcedures"><span class="hs-identifier hs-var">L.unVotingProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">VotingProcedures (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702846"><span class="hs-identifier hs-var">vProcedures</span></a></span><span>
</span><span id="line-1591"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681702859"><span class="annot"><span class="annottext">Voter (EraCrypto (ShelleyLedgerEra era))
</span><a href="#local-6989586621681702859"><span class="hs-identifier hs-var">vote</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702863"><span class="annot"><span class="annottext">ScriptWitness WitCtxStake era
</span><a href="#local-6989586621681702863"><span class="hs-identifier hs-var">scriptWitness</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map
  (Voter (EraCrypto (ShelleyLedgerEra era)))
  (ScriptWitness WitCtxStake era)
-&gt; [Item
      (Map
         (Voter (EraCrypto (ShelleyLedgerEra era)))
         (ScriptWitness WitCtxStake era))]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  (Voter (EraCrypto (ShelleyLedgerEra era)))
  (ScriptWitness WitCtxStake era)
</span><a href="#local-6989586621681702857"><span class="hs-identifier hs-var">sWitMap</span></a></span><span>
</span><span id="line-1592"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702864"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681702864"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; [Int]
forall a. Maybe a -&gt; [a]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html#maybeToList"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; [Int]) -&gt; Maybe Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Voter (EraCrypto (ShelleyLedgerEra era))
-&gt; Map
     (Voter (EraCrypto (ShelleyLedgerEra era)))
     (Map
        (GovActionId (EraCrypto (ShelleyLedgerEra era)))
        (VotingProcedure (ShelleyLedgerEra era)))
-&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe Int
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#lookupIndex"><span class="hs-identifier hs-var">Map.lookupIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Voter (EraCrypto (ShelleyLedgerEra era))
</span><a href="#local-6989586621681702859"><span class="hs-identifier hs-var">vote</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  (Voter (EraCrypto (ShelleyLedgerEra era)))
  (Map
     (GovActionId (EraCrypto (ShelleyLedgerEra era)))
     (VotingProcedure (ShelleyLedgerEra era)))
</span><a href="#local-6989586621681702861"><span class="hs-identifier hs-var">allVoteMap</span></a></span><span>
</span><span id="line-1593"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702860"><span class="annot"><span class="annottext">updatedWitness :: Either (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
</span><a href="#local-6989586621681702860"><span class="hs-identifier hs-var hs-var">updatedWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
-&gt; ScriptWitness WitCtxStake era
-&gt; Either
     (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
forall witctx.
ScriptWitnessIndex
-&gt; ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
</span><a href="#local-6989586621681702753"><span class="hs-identifier hs-var">substituteExecUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; ScriptWitnessIndex
</span><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndexVoting"><span class="hs-identifier hs-var">ScriptWitnessIndexVoting</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; ScriptWitnessIndex) -&gt; Word32 -&gt; ScriptWitnessIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681702864"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptWitness WitCtxStake era
</span><a href="#local-6989586621681702863"><span class="hs-identifier hs-var">scriptWitness</span></a></span><span>
</span><span id="line-1594"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span>      </span><span id="local-6989586621681702867"><span class="annot"><span class="annottext">[(Voter (EraCrypto (ShelleyLedgerEra era)),
  ScriptWitness WitCtxStake era)]
</span><a href="#local-6989586621681702867"><span class="hs-identifier hs-var">substitutedExecutionUnits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Voter (EraCrypto (ShelleyLedgerEra era)),
  Either
    (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era))]
-&gt; Either
     (TxBodyErrorAutoBalance era)
     [(Voter (EraCrypto (ShelleyLedgerEra era)),
       ScriptWitness WitCtxStake era)]
forall a era ctx.
[(a, Either (TxBodyErrorAutoBalance era) (ScriptWitness ctx era))]
-&gt; Either (TxBodyErrorAutoBalance era) [(a, ScriptWitness ctx era)]
</span><a href="Cardano.Api.Fees.html#traverseScriptWitnesses"><span class="hs-identifier hs-var">traverseScriptWitnesses</span></a></span><span> </span><span class="annot"><span class="annottext">[(Voter (EraCrypto (ShelleyLedgerEra era)),
  Either
    (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era))]
</span><a href="#local-6989586621681702858"><span class="hs-identifier hs-var">eSubstitutedExecutionUnits</span></a></span><span>
</span><span id="line-1597"></span><span>
</span><span id="line-1598"></span><span>      </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxVotingProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxVotingProcedures build era)))
forall a. a -&gt; Either (TxBodyErrorAutoBalance era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe
   (Featured ConwayEraOnwards era (TxVotingProcedures build era))
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (Maybe
         (Featured ConwayEraOnwards era (TxVotingProcedures build era))))
-&gt; Maybe
     (Featured ConwayEraOnwards era (TxVotingProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxVotingProcedures build era)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1599"></span><span>        </span><span class="annot"><span class="annottext">Featured ConwayEraOnwards era (TxVotingProcedures build era)
-&gt; Maybe
     (Featured ConwayEraOnwards era (TxVotingProcedures build era))
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span>
</span><span id="line-1600"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConwayEraOnwards era
-&gt; TxVotingProcedures build era
-&gt; Featured ConwayEraOnwards era (TxVotingProcedures build era)
forall (eon :: * -&gt; *) era a. eon era -&gt; a -&gt; Featured eon era a
</span><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-var">Featured</span></a></span><span> </span><span class="annot"><span class="annottext">ConwayEraOnwards era
</span><a href="#local-6989586621681702845"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VotingProcedures (ShelleyLedgerEra era)
-&gt; BuildTxWith
     build
     (Map
        (Voter (EraCrypto (ShelleyLedgerEra era)))
        (ScriptWitness WitCtxStake era))
-&gt; TxVotingProcedures build era
forall era build.
VotingProcedures (ShelleyLedgerEra era)
-&gt; BuildTxWith
     build
     (Map
        (Voter (EraCrypto (ShelleyLedgerEra era)))
        (ScriptWitness WitCtxStake era))
-&gt; TxVotingProcedures build era
</span><a href="Cardano.Api.Tx.Body.html#TxVotingProcedures"><span class="hs-identifier hs-var">TxVotingProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">VotingProcedures (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702846"><span class="hs-identifier hs-var">vProcedures</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map
  (Voter (EraCrypto (ShelleyLedgerEra era)))
  (ScriptWitness WitCtxStake era)
-&gt; BuildTxWith
     BuildTx
     (Map
        (Voter (EraCrypto (ShelleyLedgerEra era)))
        (ScriptWitness WitCtxStake era))
forall a. a -&gt; BuildTxWith BuildTx a
</span><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-var">BuildTxWith</span></a></span><span> </span><span class="annot"><span class="annottext">(Map
   (Voter (EraCrypto (ShelleyLedgerEra era)))
   (ScriptWitness WitCtxStake era)
 -&gt; BuildTxWith
      BuildTx
      (Map
         (Voter (EraCrypto (ShelleyLedgerEra era)))
         (ScriptWitness WitCtxStake era)))
-&gt; Map
     (Voter (EraCrypto (ShelleyLedgerEra era)))
     (ScriptWitness WitCtxStake era)
-&gt; BuildTxWith
     BuildTx
     (Map
        (Voter (EraCrypto (ShelleyLedgerEra era)))
        (ScriptWitness WitCtxStake era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Item
   (Map
      (Voter (EraCrypto (ShelleyLedgerEra era)))
      (ScriptWitness WitCtxStake era))]
-&gt; Map
     (Voter (EraCrypto (ShelleyLedgerEra era)))
     (ScriptWitness WitCtxStake era)
forall l. IsList l =&gt; [Item l] -&gt; l
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Voter (EraCrypto (ShelleyLedgerEra era)),
  ScriptWitness WitCtxStake era)]
[Item
   (Map
      (Voter (EraCrypto (ShelleyLedgerEra era)))
      (ScriptWitness WitCtxStake era))]
</span><a href="#local-6989586621681702867"><span class="hs-identifier hs-var">substitutedExecutionUnits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1601"></span><span>
</span><span id="line-1602"></span><span>    </span><span id="local-6989586621681701261"><span class="annot"><a href="#local-6989586621681702746"><span class="hs-identifier hs-type">mapScriptWitnessesProposals</span></a></span><span>
</span><span id="line-1603"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-type">Featured</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ConwayEraOnwards.html#ConwayEraOnwards"><span class="hs-identifier hs-type">ConwayEraOnwards</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxProposalProcedures"><span class="hs-identifier hs-type">TxProposalProcedures</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701261"><span class="hs-identifier hs-type">build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1604"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span>
</span><span id="line-1605"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1606"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-type">Featured</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ConwayEraOnwards.html#ConwayEraOnwards"><span class="hs-identifier hs-type">ConwayEraOnwards</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxProposalProcedures"><span class="hs-identifier hs-type">TxProposalProcedures</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701261"><span class="hs-identifier hs-type">build</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1607"></span><span>    </span><span id="local-6989586621681702746"><span class="annot"><span class="annottext">mapScriptWitnessesProposals :: forall build.
Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxProposalProcedures build era)))
</span><a href="#local-6989586621681702746"><span class="hs-identifier hs-var hs-var">mapScriptWitnessesProposals</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxProposalProcedures build era)))
forall a. a -&gt; Either (TxBodyErrorAutoBalance era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
forall a. Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1608"></span><span>    </span><span class="annot"><a href="#local-6989586621681702746"><span class="hs-identifier hs-var">mapScriptWitnessesProposals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-type">Featured</span></a></span><span> </span><span class="annot"><span class="annottext">ConwayEraOnwards era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxProposalProcedures build era
</span><a href="Cardano.Api.Tx.Body.html#TxProposalProceduresNone"><span class="hs-identifier hs-var">TxProposalProceduresNone</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxProposalProcedures build era)))
forall a. a -&gt; Either (TxBodyErrorAutoBalance era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
forall a. Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1609"></span><span>    </span><span class="annot"><a href="#local-6989586621681702746"><span class="hs-identifier hs-var">mapScriptWitnessesProposals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-type">Featured</span></a></span><span> </span><span class="annot"><span class="annottext">ConwayEraOnwards era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxProposalProcedures"><span class="hs-identifier hs-type">TxProposalProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">OSet (ProposalProcedure (ShelleyLedgerEra era))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BuildTxWith
  build
  (Map
     (ProposalProcedure (ShelleyLedgerEra era))
     (ScriptWitness WitCtxStake era))
</span><a href="Cardano.Api.Tx.Body.html#ViewTx"><span class="hs-identifier hs-var">ViewTx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxProposalProcedures build era)))
forall a. a -&gt; Either (TxBodyErrorAutoBalance era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
forall a. Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1610"></span><span>    </span><span class="annot"><a href="#local-6989586621681702746"><span class="hs-identifier hs-var">mapScriptWitnessesProposals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-type">Featured</span></a></span><span> </span><span id="local-6989586621681702876"><span class="annot"><span class="annottext">ConwayEraOnwards era
</span><a href="#local-6989586621681702876"><span class="hs-identifier hs-var">era</span></a></span></span><span> </span><span id="local-6989586621681702877"><span class="annot"><span class="annottext">txpp :: TxProposalProcedures build era
</span><a href="#local-6989586621681702877"><span class="hs-identifier hs-var">txpp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxProposalProcedures"><span class="hs-identifier hs-type">TxProposalProcedures</span></a></span><span> </span><span id="local-6989586621681702879"><span class="annot"><span class="annottext">OSet (ProposalProcedure (ShelleyLedgerEra era))
</span><a href="#local-6989586621681702879"><span class="hs-identifier hs-var">osetProposalProcedures</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span id="local-6989586621681702892"><span class="annot"><span class="annottext">Map
  (ProposalProcedure (ShelleyLedgerEra era))
  (ScriptWitness WitCtxStake era)
</span><a href="#local-6989586621681702892"><span class="hs-identifier hs-var">sWitMap</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1611"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702893"><span class="annot"><span class="annottext">allProposalsList :: [Item (OSet (ProposalProcedure (ShelleyLedgerEra era)))]
</span><a href="#local-6989586621681702893"><span class="hs-identifier hs-var hs-var">allProposalsList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OSet (ProposalProcedure (ShelleyLedgerEra era))
-&gt; [Item (OSet (ProposalProcedure (ShelleyLedgerEra era)))]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(OSet (ProposalProcedure (ShelleyLedgerEra era))
 -&gt; [Item (OSet (ProposalProcedure (ShelleyLedgerEra era)))])
-&gt; OSet (ProposalProcedure (ShelleyLedgerEra era))
-&gt; [Item (OSet (ProposalProcedure (ShelleyLedgerEra era)))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxProposalProcedures build era
-&gt; OSet (ProposalProcedure (ShelleyLedgerEra era))
forall build era.
TxProposalProcedures build era
-&gt; OSet (ProposalProcedure (ShelleyLedgerEra era))
</span><a href="Cardano.Api.Tx.Body.html#convProposalProcedures"><span class="hs-identifier hs-var">convProposalProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">TxProposalProcedures build era
</span><a href="#local-6989586621681702877"><span class="hs-identifier hs-var">txpp</span></a></span><span>
</span><span id="line-1612"></span><span>          </span><span id="local-6989586621681702894"><span class="annot"><span class="annottext">eSubstitutedExecutionUnits :: [(ProposalProcedure (ShelleyLedgerEra era),
  Either
    (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era))]
</span><a href="#local-6989586621681702894"><span class="hs-identifier hs-var hs-var">eSubstitutedExecutionUnits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1613"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProposalProcedure (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702895"><span class="hs-identifier hs-var">proposal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
</span><a href="#local-6989586621681702896"><span class="hs-identifier hs-var">updatedWitness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1614"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681702895"><span class="annot"><span class="annottext">ProposalProcedure (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702895"><span class="hs-identifier hs-var">proposal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702897"><span class="annot"><span class="annottext">ScriptWitness WitCtxStake era
</span><a href="#local-6989586621681702897"><span class="hs-identifier hs-var">scriptWitness</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map
  (ProposalProcedure (ShelleyLedgerEra era))
  (ScriptWitness WitCtxStake era)
-&gt; [Item
      (Map
         (ProposalProcedure (ShelleyLedgerEra era))
         (ScriptWitness WitCtxStake era))]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  (ProposalProcedure (ShelleyLedgerEra era))
  (ScriptWitness WitCtxStake era)
</span><a href="#local-6989586621681702892"><span class="hs-identifier hs-var">sWitMap</span></a></span><span>
</span><span id="line-1615"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702898"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681702898"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; [Int]
forall a. Maybe a -&gt; [a]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html#maybeToList"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; [Int]) -&gt; Maybe Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalProcedure (ShelleyLedgerEra era)
-&gt; [ProposalProcedure (ShelleyLedgerEra era)] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.OldList.html#elemIndex"><span class="hs-identifier hs-var">List.elemIndex</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalProcedure (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702895"><span class="hs-identifier hs-var">proposal</span></a></span><span> </span><span class="annot"><span class="annottext">[Item (OSet (ProposalProcedure (ShelleyLedgerEra era)))]
[ProposalProcedure (ShelleyLedgerEra era)]
</span><a href="#local-6989586621681702893"><span class="hs-identifier hs-var">allProposalsList</span></a></span><span>
</span><span id="line-1616"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702896"><span class="annot"><span class="annottext">updatedWitness :: Either (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
</span><a href="#local-6989586621681702896"><span class="hs-identifier hs-var hs-var">updatedWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
-&gt; ScriptWitness WitCtxStake era
-&gt; Either
     (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era)
forall witctx.
ScriptWitnessIndex
-&gt; ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
</span><a href="#local-6989586621681702753"><span class="hs-identifier hs-var">substituteExecUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; ScriptWitnessIndex
</span><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndexProposing"><span class="hs-identifier hs-var">ScriptWitnessIndexProposing</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; ScriptWitnessIndex) -&gt; Word32 -&gt; ScriptWitnessIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681702898"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptWitness WitCtxStake era
</span><a href="#local-6989586621681702897"><span class="hs-identifier hs-var">scriptWitness</span></a></span><span>
</span><span id="line-1617"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1618"></span><span>
</span><span id="line-1619"></span><span>      </span><span id="local-6989586621681702901"><span class="annot"><span class="annottext">[(ProposalProcedure (ShelleyLedgerEra era),
  ScriptWitness WitCtxStake era)]
</span><a href="#local-6989586621681702901"><span class="hs-identifier hs-var">substitutedExecutionUnits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ProposalProcedure (ShelleyLedgerEra era),
  Either
    (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era))]
-&gt; Either
     (TxBodyErrorAutoBalance era)
     [(ProposalProcedure (ShelleyLedgerEra era),
       ScriptWitness WitCtxStake era)]
forall a era ctx.
[(a, Either (TxBodyErrorAutoBalance era) (ScriptWitness ctx era))]
-&gt; Either (TxBodyErrorAutoBalance era) [(a, ScriptWitness ctx era)]
</span><a href="Cardano.Api.Fees.html#traverseScriptWitnesses"><span class="hs-identifier hs-var">traverseScriptWitnesses</span></a></span><span> </span><span class="annot"><span class="annottext">[(ProposalProcedure (ShelleyLedgerEra era),
  Either
    (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxStake era))]
</span><a href="#local-6989586621681702894"><span class="hs-identifier hs-var">eSubstitutedExecutionUnits</span></a></span><span>
</span><span id="line-1620"></span><span>
</span><span id="line-1621"></span><span>      </span><span class="annot"><span class="annottext">Maybe
  (Featured ConwayEraOnwards era (TxProposalProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxProposalProcedures build era)))
forall a. a -&gt; Either (TxBodyErrorAutoBalance era) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe
   (Featured ConwayEraOnwards era (TxProposalProcedures build era))
 -&gt; Either
      (TxBodyErrorAutoBalance era)
      (Maybe
         (Featured ConwayEraOnwards era (TxProposalProcedures build era))))
-&gt; Maybe
     (Featured ConwayEraOnwards era (TxProposalProcedures build era))
-&gt; Either
     (TxBodyErrorAutoBalance era)
     (Maybe
        (Featured ConwayEraOnwards era (TxProposalProcedures build era)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1622"></span><span>        </span><span class="annot"><span class="annottext">Featured ConwayEraOnwards era (TxProposalProcedures build era)
-&gt; Maybe
     (Featured ConwayEraOnwards era (TxProposalProcedures build era))
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span>
</span><span id="line-1623"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ConwayEraOnwards era
-&gt; TxProposalProcedures build era
-&gt; Featured ConwayEraOnwards era (TxProposalProcedures build era)
forall (eon :: * -&gt; *) era a. eon era -&gt; a -&gt; Featured eon era a
</span><a href="Cardano.Api.Feature.html#Featured"><span class="hs-identifier hs-var">Featured</span></a></span><span>
</span><span id="line-1624"></span><span>              </span><span class="annot"><span class="annottext">ConwayEraOnwards era
</span><a href="#local-6989586621681702876"><span class="hs-identifier hs-var">era</span></a></span><span>
</span><span id="line-1625"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OSet (ProposalProcedure (ShelleyLedgerEra era))
-&gt; BuildTxWith
     build
     (Map
        (ProposalProcedure (ShelleyLedgerEra era))
        (ScriptWitness WitCtxStake era))
-&gt; TxProposalProcedures build era
forall era build.
EraPParams (ShelleyLedgerEra era) =&gt;
OSet (ProposalProcedure (ShelleyLedgerEra era))
-&gt; BuildTxWith
     build
     (Map
        (ProposalProcedure (ShelleyLedgerEra era))
        (ScriptWitness WitCtxStake era))
-&gt; TxProposalProcedures build era
</span><a href="Cardano.Api.Tx.Body.html#TxProposalProcedures"><span class="hs-identifier hs-var">TxProposalProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">OSet (ProposalProcedure (ShelleyLedgerEra era))
</span><a href="#local-6989586621681702879"><span class="hs-identifier hs-var">osetProposalProcedures</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map
  (ProposalProcedure (ShelleyLedgerEra era))
  (ScriptWitness WitCtxStake era)
-&gt; BuildTxWith
     BuildTx
     (Map
        (ProposalProcedure (ShelleyLedgerEra era))
        (ScriptWitness WitCtxStake era))
forall a. a -&gt; BuildTxWith BuildTx a
</span><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-var">BuildTxWith</span></a></span><span> </span><span class="annot"><span class="annottext">(Map
   (ProposalProcedure (ShelleyLedgerEra era))
   (ScriptWitness WitCtxStake era)
 -&gt; BuildTxWith
      BuildTx
      (Map
         (ProposalProcedure (ShelleyLedgerEra era))
         (ScriptWitness WitCtxStake era)))
-&gt; Map
     (ProposalProcedure (ShelleyLedgerEra era))
     (ScriptWitness WitCtxStake era)
-&gt; BuildTxWith
     BuildTx
     (Map
        (ProposalProcedure (ShelleyLedgerEra era))
        (ScriptWitness WitCtxStake era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Item
   (Map
      (ProposalProcedure (ShelleyLedgerEra era))
      (ScriptWitness WitCtxStake era))]
-&gt; Map
     (ProposalProcedure (ShelleyLedgerEra era))
     (ScriptWitness WitCtxStake era)
forall l. IsList l =&gt; [Item l] -&gt; l
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(ProposalProcedure (ShelleyLedgerEra era),
  ScriptWitness WitCtxStake era)]
[Item
   (Map
      (ProposalProcedure (ShelleyLedgerEra era))
      (ScriptWitness WitCtxStake era))]
</span><a href="#local-6989586621681702901"><span class="hs-identifier hs-var">substitutedExecutionUnits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1626"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-1627"></span><span>
</span><span id="line-1628"></span><span>    </span><span class="annot"><a href="#local-6989586621681702740"><span class="hs-identifier hs-type">mapScriptWitnessesMinting</span></a></span><span>
</span><span id="line-1629"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxMintValue"><span class="hs-identifier hs-type">TxMintValue</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1630"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxMintValue"><span class="hs-identifier hs-type">TxMintValue</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTx"><span class="hs-identifier hs-type">BuildTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1631"></span><span>    </span><span id="local-6989586621681702740"><span class="annot"><span class="annottext">mapScriptWitnessesMinting :: TxMintValue BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxMintValue BuildTx era)
</span><a href="#local-6989586621681702740"><span class="hs-identifier hs-var hs-var">mapScriptWitnessesMinting</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx era
</span><a href="Cardano.Api.Tx.Body.html#TxMintNone"><span class="hs-identifier hs-var">TxMintNone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxMintValue BuildTx era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx era
forall build era. TxMintValue build era
</span><a href="Cardano.Api.Tx.Body.html#TxMintNone"><span class="hs-identifier hs-var">TxMintNone</span></a></span><span>
</span><span id="line-1632"></span><span>    </span><span class="annot"><a href="#local-6989586621681702740"><span class="hs-identifier hs-var">mapScriptWitnessesMinting</span></a></span><span>
</span><span id="line-1633"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxMintValue"><span class="hs-identifier hs-type">TxMintValue</span></a></span><span>
</span><span id="line-1634"></span><span>          </span><span id="local-6989586621681702902"><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681702902"><span class="hs-identifier hs-var">supported</span></a></span></span><span>
</span><span id="line-1635"></span><span>          </span><span id="local-6989586621681702903"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702903"><span class="hs-identifier hs-var">value</span></a></span></span><span>
</span><span id="line-1636"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-type">BuildTxWith</span></a></span><span> </span><span id="local-6989586621681702911"><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint era)
</span><a href="#local-6989586621681702911"><span class="hs-identifier hs-var">witnesses</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1637"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1638"></span><span>        </span><span class="hs-comment">-- TxMintValue supported value $ BuildTxWith $ fromList</span><span>
</span><span id="line-1639"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681702912"><span class="hs-identifier hs-type">mappedScriptWitnesses</span></a></span><span>
</span><span id="line-1640"></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Value.html#PolicyId"><span class="hs-identifier hs-type">PolicyId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-type">ScriptWitness</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#WitCtxMint"><span class="hs-identifier hs-type">WitCtxMint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681700793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1641"></span><span>            </span><span id="local-6989586621681702912"><span class="annot"><span class="annottext">mappedScriptWitnesses :: [(PolicyId,
  Either
    (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxMint era))]
</span><a href="#local-6989586621681702912"><span class="hs-identifier hs-var hs-var">mappedScriptWitnesses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1642"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621681702913"><span class="hs-identifier hs-var">policyid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxMint era)
</span><a href="#local-6989586621681702914"><span class="hs-identifier hs-var">witness'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1643"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- The minting policies are indexed in policy id order in the value</span><span>
</span><span id="line-1644"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Cardano.Api.Value.html#ValueNestedRep"><span class="hs-identifier hs-type">ValueNestedRep</span></a></span><span> </span><span id="local-6989586621681702916"><span class="annot"><span class="annottext">[ValueNestedBundle]
</span><a href="#local-6989586621681702916"><span class="hs-identifier hs-var">bundle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ValueNestedRep
</span><a href="Cardano.Api.Value.html#valueToNestedRep"><span class="hs-identifier hs-var">valueToNestedRep</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702903"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-1645"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681702918"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681702918"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Value.html#ValueNestedBundle"><span class="hs-identifier hs-type">ValueNestedBundle</span></a></span><span> </span><span id="local-6989586621681702913"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621681702913"><span class="hs-identifier hs-var">policyid</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Quantity
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Word32] -&gt; [ValueNestedBundle] -&gt; [(Word32, ValueNestedBundle)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[ValueNestedBundle]
</span><a href="#local-6989586621681702916"><span class="hs-identifier hs-var">bundle</span></a></span><span>
</span><span id="line-1646"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702920"><span class="annot"><span class="annottext">ScriptWitness WitCtxMint era
</span><a href="#local-6989586621681702920"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (ScriptWitness WitCtxMint era)
-&gt; [ScriptWitness WitCtxMint era]
forall a. Maybe a -&gt; [a]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Maybe.html#maybeToList"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId
-&gt; Map PolicyId (ScriptWitness WitCtxMint era)
-&gt; Maybe (ScriptWitness WitCtxMint era)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/containers-0.6.8-inplace/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621681702913"><span class="hs-identifier hs-var">policyid</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint era)
</span><a href="#local-6989586621681702911"><span class="hs-identifier hs-var">witnesses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1647"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702914"><span class="annot"><span class="annottext">witness' :: Either (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxMint era)
</span><a href="#local-6989586621681702914"><span class="hs-identifier hs-var hs-var">witness'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
-&gt; ScriptWitness WitCtxMint era
-&gt; Either
     (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxMint era)
forall witctx.
ScriptWitnessIndex
-&gt; ScriptWitness witctx era
-&gt; Either (TxBodyErrorAutoBalance era) (ScriptWitness witctx era)
</span><a href="#local-6989586621681702753"><span class="hs-identifier hs-var">substituteExecUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; ScriptWitnessIndex
</span><a href="Cardano.Api.Tx.Body.html#ScriptWitnessIndexMint"><span class="hs-identifier hs-var">ScriptWitnessIndexMint</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681702918"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptWitness WitCtxMint era
</span><a href="#local-6989586621681702920"><span class="hs-identifier hs-var">witness</span></a></span><span>
</span><span id="line-1648"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-1649"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1650"></span><span>              </span><span id="local-6989586621681702922"><span class="annot"><span class="annottext">[(PolicyId, ScriptWitness WitCtxMint era)]
</span><a href="#local-6989586621681702922"><span class="hs-identifier hs-var">final</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(PolicyId,
  Either
    (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxMint era))]
-&gt; Either
     (TxBodyErrorAutoBalance era)
     [(PolicyId, ScriptWitness WitCtxMint era)]
forall a era ctx.
[(a, Either (TxBodyErrorAutoBalance era) (ScriptWitness ctx era))]
-&gt; Either (TxBodyErrorAutoBalance era) [(a, ScriptWitness ctx era)]
</span><a href="Cardano.Api.Fees.html#traverseScriptWitnesses"><span class="hs-identifier hs-var">traverseScriptWitnesses</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyId,
  Either
    (TxBodyErrorAutoBalance era) (ScriptWitness WitCtxMint era))]
</span><a href="#local-6989586621681702912"><span class="hs-identifier hs-var">mappedScriptWitnesses</span></a></span><span>
</span><span id="line-1651"></span><span>              </span><span class="annot"><span class="annottext">TxMintValue BuildTx era
-&gt; Either (TxBodyErrorAutoBalance era) (TxMintValue BuildTx era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMintValue BuildTx era
 -&gt; Either (TxBodyErrorAutoBalance era) (TxMintValue BuildTx era))
-&gt; (Map PolicyId (ScriptWitness WitCtxMint era)
    -&gt; TxMintValue BuildTx era)
-&gt; Map PolicyId (ScriptWitness WitCtxMint era)
-&gt; Either (TxBodyErrorAutoBalance era) (TxMintValue BuildTx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
-&gt; Value
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint era))
-&gt; TxMintValue BuildTx era
forall era build.
MaryEraOnwards era
-&gt; Value
-&gt; BuildTxWith build (Map PolicyId (ScriptWitness WitCtxMint era))
-&gt; TxMintValue build era
</span><a href="Cardano.Api.Tx.Body.html#TxMintValue"><span class="hs-identifier hs-var">TxMintValue</span></a></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards era
</span><a href="#local-6989586621681702902"><span class="hs-identifier hs-var">supported</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621681702903"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">(BuildTxWith BuildTx (Map PolicyId (ScriptWitness WitCtxMint era))
 -&gt; TxMintValue BuildTx era)
-&gt; (Map PolicyId (ScriptWitness WitCtxMint era)
    -&gt; BuildTxWith
         BuildTx (Map PolicyId (ScriptWitness WitCtxMint era)))
-&gt; Map PolicyId (ScriptWitness WitCtxMint era)
-&gt; TxMintValue BuildTx era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint era)
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint era))
forall a. a -&gt; BuildTxWith BuildTx a
</span><a href="Cardano.Api.Tx.Body.html#BuildTxWith"><span class="hs-identifier hs-var">BuildTxWith</span></a></span><span> </span><span class="annot"><span class="annottext">(Map PolicyId (ScriptWitness WitCtxMint era)
 -&gt; Either (TxBodyErrorAutoBalance era) (TxMintValue BuildTx era))
-&gt; Map PolicyId (ScriptWitness WitCtxMint era)
-&gt; Either (TxBodyErrorAutoBalance era) (TxMintValue BuildTx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1652"></span><span>                </span><span class="annot"><span class="annottext">[Item (Map PolicyId (ScriptWitness WitCtxMint era))]
-&gt; Map PolicyId (ScriptWitness WitCtxMint era)
forall l. IsList l =&gt; [Item l] -&gt; l
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.IsList.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyId, ScriptWitness WitCtxMint era)]
[Item (Map PolicyId (ScriptWitness WitCtxMint era))]
</span><a href="#local-6989586621681702922"><span class="hs-identifier hs-var">final</span></a></span><span>
</span><span id="line-1653"></span><span>
</span><span id="line-1654"></span><span id="local-6989586621681701320"><span id="local-6989586621681701321"><span id="local-6989586621681701322"><span class="annot"><a href="Cardano.Api.Fees.html#traverseScriptWitnesses"><span class="hs-identifier hs-type">traverseScriptWitnesses</span></a></span><span>
</span><span id="line-1655"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681701320"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701321"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-type">ScriptWitness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701322"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701321"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1656"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Fees.html#TxBodyErrorAutoBalance"><span class="hs-identifier hs-type">TxBodyErrorAutoBalance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701321"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681701320"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Api.Script.html#ScriptWitness"><span class="hs-identifier hs-type">ScriptWitness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701322"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701321"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-1657"></span><span id="traverseScriptWitnesses"><span class="annot"><span class="annottext">traverseScriptWitnesses :: forall a era ctx.
[(a, Either (TxBodyErrorAutoBalance era) (ScriptWitness ctx era))]
-&gt; Either (TxBodyErrorAutoBalance era) [(a, ScriptWitness ctx era)]
</span><a href="Cardano.Api.Fees.html#traverseScriptWitnesses"><span class="hs-identifier hs-var hs-var">traverseScriptWitnesses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1658"></span><span>  </span><span class="annot"><span class="annottext">((a, Either (TxBodyErrorAutoBalance era) (ScriptWitness ctx era))
 -&gt; Either (TxBodyErrorAutoBalance era) (a, ScriptWitness ctx era))
-&gt; [(a,
     Either (TxBodyErrorAutoBalance era) (ScriptWitness ctx era))]
-&gt; Either (TxBodyErrorAutoBalance era) [(a, ScriptWitness ctx era)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681702926"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681702926"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681702927"><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (ScriptWitness ctx era)
</span><a href="#local-6989586621681702927"><span class="hs-identifier hs-var">eScriptWitness</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (ScriptWitness ctx era)
</span><a href="#local-6989586621681702927"><span class="hs-identifier hs-var">eScriptWitness</span></a></span><span> </span><span class="annot"><span class="annottext">Either (TxBodyErrorAutoBalance era) (ScriptWitness ctx era)
-&gt; (ScriptWitness ctx era
    -&gt; Either (TxBodyErrorAutoBalance era) (a, ScriptWitness ctx era))
-&gt; Either (TxBodyErrorAutoBalance era) (a, ScriptWitness ctx era)
forall a b.
Either (TxBodyErrorAutoBalance era) a
-&gt; (a -&gt; Either (TxBodyErrorAutoBalance era) b)
-&gt; Either (TxBodyErrorAutoBalance era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681702928"><span class="annot"><span class="annottext">ScriptWitness ctx era
</span><a href="#local-6989586621681702928"><span class="hs-identifier hs-var">sWit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, ScriptWitness ctx era)
-&gt; Either (TxBodyErrorAutoBalance era) (a, ScriptWitness ctx era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681702926"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptWitness ctx era
</span><a href="#local-6989586621681702928"><span class="hs-identifier hs-var">sWit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1659"></span><span>
</span><span id="line-1660"></span><span id="local-6989586621681701210"><span class="annot"><a href="Cardano.Api.Fees.html#calculateMinimumUTxO"><span class="hs-identifier hs-type">calculateMinimumUTxO</span></a></span><span>
</span><span id="line-1661"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyBasedEra"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701210"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1662"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="Cardano.Api.Tx.Body.html#CtxTx"><span class="hs-identifier hs-type">CtxTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701210"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1663"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">Ledger.PParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Api.Eon.ShelleyBasedEra.html#ShelleyLedgerEra"><span class="hs-identifier hs-type">ShelleyLedgerEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681701210"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1664"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">L.Coin</span></a></span></span><span>
</span><span id="line-1665"></span><span id="calculateMinimumUTxO"><span class="annot"><span class="annottext">calculateMinimumUTxO :: forall era.
ShelleyBasedEra era
-&gt; TxOut CtxTx era -&gt; PParams (ShelleyLedgerEra era) -&gt; Coin
</span><a href="Cardano.Api.Fees.html#calculateMinimumUTxO"><span class="hs-identifier hs-var hs-var">calculateMinimumUTxO</span></a></span></span><span> </span><span id="local-6989586621681702929"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702929"><span class="hs-identifier hs-var">sbe</span></a></span></span><span> </span><span id="local-6989586621681702930"><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621681702930"><span class="hs-identifier hs-var">txout</span></a></span></span><span> </span><span id="local-6989586621681702931"><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702931"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1666"></span><span>  </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; (ShelleyBasedEraConstraints era =&gt; Coin) -&gt; Coin
forall era a.
ShelleyBasedEra era -&gt; (ShelleyBasedEraConstraints era =&gt; a) -&gt; a
</span><a href="Cardano.Api.Eon.ShelleyBasedEra.html#shelleyBasedEraConstraints"><span class="hs-identifier hs-var">shelleyBasedEraConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702929"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyBasedEraConstraints era =&gt; Coin) -&gt; Coin)
-&gt; (ShelleyBasedEraConstraints era =&gt; Coin) -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/fky69z1cbalcvmp04la05zsdsgkb65g9-ghc-9.8.2-doc/share/doc/ghc-9.8.2/html/libraries/base-4.19.1.0-inplace/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1667"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681702940"><span class="annot"><span class="annottext">txOutWithMinCoin :: TxOut (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702940"><span class="hs-identifier hs-var hs-var">txOutWithMinCoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
-&gt; TxOut (ShelleyLedgerEra era) -&gt; TxOut (ShelleyLedgerEra era)
forall era. EraTxOut era =&gt; PParams era -&gt; TxOut era -&gt; TxOut era
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Tools.html#setMinCoinTxOut"><span class="hs-identifier hs-var">L.setMinCoinTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702931"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxOut CtxTx era -&gt; TxOut (ShelleyLedgerEra era)
forall ctx era ledgerera.
(ShelleyLedgerEra era ~ ledgerera) =&gt;
ShelleyBasedEra era -&gt; TxOut ctx era -&gt; TxOut ledgerera
</span><a href="Cardano.Api.Tx.Body.html#toShelleyTxOutAny"><span class="hs-identifier hs-var">toShelleyTxOutAny</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621681702929"><span class="hs-identifier hs-var">sbe</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621681702930"><span class="hs-identifier hs-var">txout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1668"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TxOut (ShelleyLedgerEra era)
</span><a href="#local-6989586621681702940"><span class="hs-identifier hs-var">txOutWithMinCoin</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut (ShelleyLedgerEra era)
-&gt; Getting Coin (TxOut (ShelleyLedgerEra era)) Coin -&gt; Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Coin (TxOut (ShelleyLedgerEra era)) Coin
forall era. (HasCallStack, EraTxOut era) =&gt; Lens' (TxOut era) Coin
Lens' (TxOut (ShelleyLedgerEra era)) Coin
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.8.2-inplace/cardano-ledger-core-1.13.2.0-d84e8e4eba72461c5eba3b9781a87e0453f410955867a9c415df23d2e68b3eab/share/doc/html/src/Cardano.Ledger.Core.html#coinTxOutL"><span class="hs-identifier hs-var">L.coinTxOutL</span></a></span><span>
</span><span id="line-1669"></span></pre></body></html>